<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>User Guide to Restcomm jDiameter 1.7.0-SNAPSHOT</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>User Guide to Restcomm jDiameter 1.7.0-SNAPSHOT</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preface">Preface</a></li>
<li><a href="#document-conventions">Document Conventions</a>
<ul class="sectlevel2">
<li><a href="#typographic-conventions">Typographic Conventions</a></li>
<li><a href="#pull-quote-conventions">Pull-quote Conventions</a></li>
<li><a href="#notes-and-warnings">Notes and Warnings</a></li>
</ul>
</li>
<li><a href="#provide-feedback-to-the-authors">Provide feedback to the authors!</a></li>
<li><a href="#_introduction">1. Introduction to Restcomm  Diameter</a>
<ul class="sectlevel2">
<li><a href="#_mf_message_format">1.1. Message Format</a></li>
<li><a href="#_introduction_contents">1.2. Contents</a></li>
</ul>
</li>
<li><a href="#_jdiameter">2. Restcomm  Diameter Stack</a>
<ul class="sectlevel2">
<li><a href="#_jdiameter_design">2.1. Diameter Stack Design</a></li>
<li><a href="#_jdiameter_setup">2.2. Restcomm  Diameter Stack Setup</a></li>
<li><a href="#_jdiameter_configuration">2.3. Diameter Stack Configuration</a></li>
<li><a href="#_jdiameter_source_overview">2.4. Diameter Stack Source overview</a></li>
<li><a href="#_jdiameter_validator">2.5. Diameter Stack Validator</a></li>
</ul>
</li>
<li><a href="#_mux">3. Multiplexer (MUX)</a>
<ul class="sectlevel2">
<li><a href="#_mux_design">3.1. Diameter Multiplexer (MUX) Design</a></li>
<li><a href="#_mux_setup">3.2. Diameter Multiplexer (MUX) Setup</a></li>
<li><a href="#_mux_configuration">3.3. Diameter Multiplexer (MUX) Configuration</a></li>
<li><a href="#_mux_source_overview">3.4. Diameter MUX Source Overview</a></li>
<li><a href="#_mux_dictionary">3.5. Diameter Multiplexer (MUX) Dictionary</a></li>
</ul>
</li>
<li><a href="#revision-history">Appendix A: Revision History</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a>Preface</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="document-conventions"><a class="anchor" href="#document-conventions"></a>Document Conventions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.</p>
</div>
<div class="paragraph">
<p>In PDF and paper editions, this manual uses typefaces drawn from the <a href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set.
The Liberation Fonts set is also used in HTML editions if the set is installed on your system.
If not, alternative but equivalent typefaces are displayed.
Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.</p>
</div>
<div class="sect2">
<h3 id="typographic-conventions"><a class="anchor" href="#typographic-conventions"></a>Typographic Conventions</h3>
<div class="paragraph">
<p>Four typographic conventions are used to call attention to specific words and phrases.
These conventions, and the circumstances they apply to, are as follows.</p>
</div>
<div class="paragraph">
<p><code>Mono-spaced Bold</code></p>
</div>
<div class="paragraph">
<p>Used to highlight system input, including shell commands, file names and paths.
Also used to highlight key caps and key-combinations.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
To see the contents of the file <em class="path">my_next_bestselling_novel</em> in your current working directory, enter the <code>cat my_next_bestselling_novel</code> command at the shell prompt and press <kbd>Enter</kbd> to execute the command.
</blockquote>
</div>
<div class="paragraph">
<p>The above includes a file name, a shell command and a key cap, all presented in Mono-spaced Bold and all distinguishable thanks to context.</p>
</div>
<div class="paragraph">
<p>Key-combinations can be distinguished from key caps by the hyphen connecting each part of a key-combination.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Press <kbd>Enter</kbd> to execute the command.</p>
</div>
<div class="paragraph">
<p>Press  to switch to the first virtual terminal.
Press  to return to your X-Windows session.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The first sentence highlights the particular key cap to press.
The second highlights two sets of three key caps, each set pressed simultaneously.</p>
</div>
<div class="paragraph">
<p>If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code>Mono-spaced Bold</code>.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
File-related classes include <code class="class">filesystem</code> for file systems, <code class="class">file</code> for files, and <code class="class">dir</code> for directories.
Each class has its own associated set of permissions.
</blockquote>
</div>
<div class="paragraph">
<p><code class="app">Proportional Bold</code></p>
</div>
<div class="paragraph">
<p>This denotes words or phrases encountered on a system, including application names; dialogue box text; labelled buttons; check-box and radio button labels; menu titles and sub-menu titles.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Choose <span class="menu">System &gt; Preferences &gt; Mouse</span> from the main menu bar to launch <code class="app">Mouse Preferences</code>.
In the <span class="label">Buttons</span> tab, click the <span class="label">Left-handed mouse</span> check box and click <b class="button">Close</b> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).</p>
</div>
<div class="paragraph">
<p>To insert a special character into a <code class="app">gedit</code> file, choose <span class="menu">Applications &gt; Accessories &gt; Character Map</span> from the main menu bar.
Next, choose <span class="menu">Search &gt; Find</span> from the <code class="app">Character Map</code> menu bar, type the name of the character in the <span class="label">Search</span> field and click <b class="button">Next</b>.
The character you sought will be highlighted in the <span class="label">Character Table</span>.
Double-click this highlighted character to place it in the <span class="label">Text to copy</span> field and then click the <b class="button">Copy</b> button.
Now switch back to your document and choose <span class="menu">Edit &gt; Paste</span> from the <code class="app">gedit</code> menu bar.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in Proportional Bold and all distinguishable by context.</p>
</div>
<div class="paragraph">
<p>Note the menu:&gt;[] shorthand used to indicate traversal through a menu and its sub-menus.
This is to avoid the difficult-to-follow 'Select  from the <span class="menuseq"><span class="menu">Preferences</span>&#160;&#9656; <span class="menuitem">] sub-menu in the menu:System[</span></span> menu of the main menu bar' approach.</p>
</div>
<div class="paragraph">
<p><code>Mono-spaced Bold Italic</code> or <code class="app">Proportional Bold Italic</code></p>
</div>
<div class="paragraph">
<p>Whether Mono-spaced Bold or Proportional Bold, the addition of Italics indicates replaceable or variable text.
Italics denotes text you do not input literally or displayed text that changes depending on circumstance.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>To connect to a remote machine using ssh, type <code>ssh <a href="mailto:username@domain.name">username@domain.name</a></code> at a shell prompt.
If the remote machine is <em class="path">example.com</em> and your username on that machine is john, type <code>ssh <a href="mailto:john@example.com">john@example.com</a></code>.</p>
</div>
<div class="paragraph">
<p>The <code>mount -o remount file-system</code> command remounts the named file system.
For example, to remount the <em class="path">/home</em> file system, the command is <code>mount -o remount /home</code>.</p>
</div>
<div class="paragraph">
<p>To see the version of a currently installed package, use the <code>rpm -q package</code> command.
It will return a result as follows: <code>package-version-release</code>.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Note the words in bold italics above &mdash;username, domain.name, file-system, package, version and release.
Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.</p>
</div>
<div class="paragraph">
<p>Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
When the Apache HTTP Server accepts requests, it dispatches child processes or threads to handle them.
This group of child processes or threads is known as a <em class="term">server-pool</em>.
Under Apache HTTP Server 2.0, the responsibility for creating and maintaining these server-pools has been abstracted to a group of modules called <em class="term">Multi-Processing Modules</em> (<em class="term">MPMs</em>). Unlike other modules, only one module from the MPM group can be loaded by the Apache HTTP Server.
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="pull-quote-conventions"><a class="anchor" href="#pull-quote-conventions"></a>Pull-quote Conventions</h3>
<div class="paragraph">
<p>Two, commonly multi-line, data types are set off visually from the surrounding text.</p>
</div>
<div class="paragraph">
<p>Output sent to a terminal is set in <code>Mono-spaced Roman</code> and presented thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>books        Desktop   documentation  drafts  mss    photos   stuff  svn
books_tests  Desktop1  downloads      images  notes  scripts  svgs</pre>
</div>
</div>
<div class="paragraph">
<p>Source-code listings are also set in <code>Mono-spaced Roman</code> but are presented and highlighted as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.jboss.book.jca.ex1;

import javax.naming.InitialContext;

public class ExClient
{
   public static void main(String args[])
       throws Exception
   {
      InitialContext iniCtx = new InitialContext();
      Object         ref    = iniCtx.lookup("EchoBean");
      EchoHome       home   = (EchoHome) ref;
      Echo           echo   = home.create();

      System.out.println("Created Echo");

      System.out.println("Echo.echo('Hello') = " + echo.echo("Hello"));
   }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="notes-and-warnings"><a class="anchor" href="#notes-and-warnings"></a>Notes and Warnings</h3>
<div class="paragraph">
<p>Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>A note is a tip or shortcut or alternative approach to the task at hand.
Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Important</div>
<div class="paragraph">
<p>Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply.
Ignoring Important boxes won&#8217;t cause data loss but may cause irritation and frustration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Warning</div>
<div class="paragraph">
<p>A Warning should not be ignored.
Ignoring warnings will most likely cause data loss.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="provide-feedback-to-the-authors"><a class="anchor" href="#provide-feedback-to-the-authors"></a>Provide feedback to the authors!</h2>
<div class="sectionbody">
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>If you find a typographical error in this manual, or if you have thought of a way to make this manual better, we would love to hear from you! Please submit a report in the the {this-issue.tracker.ur}, against the product Restcomm jDiameter`   `, or contact the authors.</p>
</div>
<div class="paragraph">
<p>When submitting a bug report, be sure to mention the manual&#8217;s identifier: Restcomm jDiameter</p>
</div>
<div class="paragraph">
<p>If you have a suggestion for improving the documentation, try to be as specific as possible when describing it.
If you have found an error, please include the section number and some of the surrounding text so we can find it easily.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction to Restcomm  Diameter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Diameter is a computer networking protocol for Authentication, Authorization and Accounting (), as defined in RFC3588.
It is a successor to RADIUS, and has been designed to overcome certain RADIUS limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>No transport reliability and flexibility (Diameter uses TCP/SCTP instead of UDP).</p>
</li>
<li>
<p>No security within protocol (Diameter supports IPSec (mandatory) and TLS (optional)).</p>
</li>
<li>
<p>Limited address space for AVPs (Diameter uses 32-bit address space instead of 8-bit).</p>
</li>
<li>
<p>Only stateless mode is possible (Diameter supports both stateful and stateless modes).</p>
</li>
<li>
<p>Static peers (Diameter offers dynamic discovery, using DNS, SRV and NAPTR).</p>
</li>
<li>
<p>No peer alignment capabilities (Diameter introduces capabilities negotiation).</p>
</li>
<li>
<p>No support for transport layer failover.
Diameter follows <a href="http://tools.ietf.org/html/rfc3539">RFC3539</a>, which introduces correct procedures.</p>
</li>
<li>
<p>Limited support for roaming (Diameter introduces mechanisms for secure and scalable roaming).</p>
</li>
<li>
<p>No extension possible (Diameter allows extension - new commands and AVPs to be defined).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Diameter offers all of the capabilities of the RADIUS protocol, and is compatible with RADIUS.
It can also define extensions, or "Applications".</p>
</div>
<div class="paragraph">
<p>Each application may introduce new types of messages, AVP codes, and state machines.
The Message and AVP codes are assigned by the .
Each application has its own Application ID and Vendor ID that is used to distinguish between applications.
Application code is used to signal to other peers which operations are supported by the connecting peer (Capabilities Exchange / Negotiation).</p>
</div>
<div class="sect2">
<h3 id="_mf_message_format"><a class="anchor" href="#_mf_message_format"></a>1.1. Message Format</h3>
<div class="paragraph">
<p>Diameter is a byte based protocol.
Each message has a fixed structure, which consists of two parts: header and payload.</p>
</div>
<div class="paragraph">
<p>The message header structure is common for every message.
The content is fixed, as is the length.
Message header content includes the code, application and certain bit flags, which helps identify the message in Diameter scope.</p>
</div>
<div class="paragraph">
<p>The message payload is built up of AVPs.
Its content differs for each command and application, though they all define the Session-ID AVP as mandatory.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/dia-Introduction-dia-DiameterPacketFormat.png" alt="dia Introduction dia DiameterPacketFormat">
</div>
<div class="title">Figure 1. Diameter Message Structure</div>
</div>
<div class="paragraph">
<p>The header has the following fields:</p>
</div>
<div class="dlist">
<div class="title">Message Headers</div>
<dl>
<dt class="hdlist1">Version</dt>
<dd>
<p>Indicates the Diameter protocol version.
This value is always set to <code>1</code>.</p>
</dd>
<dt class="hdlist1">Message Length</dt>
<dd>
<p>Indicates the Diameter message length, including the header fields.</p>
</dd>
<dt class="hdlist1">Flags</dt>
<dd>
<p>Composed by eight bits, to provide information regarding the message.
The first four bits in the flags octet have the following meaning:</p>
<div class="ulist">
<ul>
<li>
<p>R = The message is a request (1) or an answer (0).</p>
</li>
<li>
<p>P = The message is proxiable (1) and may be proxied, relayed or redirected, or it must be processed locally (0).</p>
</li>
<li>
<p>E = The message is an error message (1) or a regular message (0).</p>
</li>
<li>
<p>T = The message is potentially being re-transmitted (1) or being sent for the first time (0).</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The last four bits are reserved for future use, and should be set to 0.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Command Code</dt>
<dd>
<p>Indicates the command associated with the message.</p>
</dd>
<dt class="hdlist1">Application-ID</dt>
<dd>
<p>Identifies the application to which the message is applicable for.
The application is an authentication, accounting, or vendor specific application.
The <code>application-id</code> in the header must be the same as what is contained in any relevant AVPs in the message.</p>
</dd>
<dt class="hdlist1">Hop-by-Hop ID</dt>
<dd>
<p>A unique ID that is used to match requests and answers.
The header field of the answer message must contain the same value present in the corresponding request.
This is how answers are routed back to the peer that sent the message.</p>
</dd>
<dt class="hdlist1">End-to-End ID</dt>
<dd>
<p>A time-limited unique ID that is used to to detect duplicate messages.
The ID must be unique for at least four minutes.
The answer message originator must ensure that this header contains the same value present in the corresponding request.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The message payload is built up from AVPs.
Each AVP has a similar structure: a header, and encoded data.
Data can be simple (eg, integer, long) or complex (another encoded AVP).</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/dia-Introduction-dia-DiameterAVPLayout.png" alt="dia Introduction dia DiameterAVPLayout">
</div>
<div class="title">Figure 2. Payload Structure</div>
</div>
<div class="dlist">
<div class="title">Payload AVPs</div>
<dl>
<dt class="hdlist1">AVP Code</dt>
<dd>
<p>Uniquely identifies the attribute, by combining the specified code with the value contained within the Vendor-ID header field.
AVP numbers 1 to 255 are reserved for RADIUS backwards compatibility, and do not require the Vendor-ID header field. AVP numbers 256 and above are used exclusively for the Diameter protocol, and are allocated by IANA.</p>
</dd>
<dt class="hdlist1">Flags</dt>
<dd>
<p>Bit flags that specify how each attribute must be handled.
Flags octets have the following structure: V M P r r r r r.
A full description is available in <a href="http://tools.ietf.org/html/rfc3588#section-4.1">Section 4.1 of RFC3588</a>.
The first three bits have the following meaning:</p>
<div class="ulist">
<ul>
<li>
<p>V If set, indicates that optional octets (Vendor-ID) is present in AVP header.</p>
</li>
<li>
<p>M If set, it indicates that receiveing peer must understand this AVP or send error answer.</p>
</li>
<li>
<p>P If set, it indicates the need for encryption for end-to-end security.</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The last 5 bits are reserved for future use, and should be set to 0.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AVP Length</dt>
<dd>
<p>Indicates the number of octets in the AVP, including the following information:</p>
<div class="ulist">
<ul>
<li>
<p>AVP Code</p>
</li>
<li>
<p>AVP Length</p>
</li>
<li>
<p>AVP Flags</p>
</li>
<li>
<p>Vendor-ID field (if present)</p>
</li>
<li>
<p>AVP Data</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Vendor-ID</dt>
<dd>
<p>An optional octet that identifies the AVP in application space.
AVP code and AVP Vendor-ID create a unique identifier for the AVP.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_introduction_contents"><a class="anchor" href="#_introduction_contents"></a>1.2. Contents</h3>
<div class="paragraph">
<p>Restcomm Diameter core is built on top of three basic components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Stack</dt>
<dd>
<p>Extensible Diameter Stack.
It provides basic session support along with application specific sessions.</p>
</dd>
<dt class="hdlist1">Multiplexer (MUX)</dt>
<dd>
<p>Diameter Stack multiplexer.
Allows different listeners to share the same stack instance.</p>
</dd>
<dt class="hdlist1">Dictionary</dt>
<dd>
<p>Diameter Message and AVP Dictionary.
Provides an API to access information about AVPs.
Dictionary is embeded in the MUX.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_jdiameter"><a class="anchor" href="#_jdiameter"></a>2. Restcomm  Diameter Stack</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Diameter Stack is the core component of the presented Diameter solution.
It performs all necessary tasks to allow user interaction with the Diameter network.
It manages the state of diameter peers and allows to route messages between them.
For more details, refer to <a href="http://tools.ietf.org/html/rfc3588">RFC 3588</a>.</p>
</div>
<div class="paragraph">
<p>The Diameter Stack currently supports the following application sessions:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Base</p>
</li>
<li>
<p>Credit Control Application (CCA)</p>
</li>
<li>
<p>Sh</p>
</li>
<li>
<p>Ro</p>
</li>
<li>
<p>Rf</p>
</li>
<li>
<p>Cx/Dx</p>
</li>
<li>
<p>Gx</p>
</li>
<li>
<p>Gq'</p>
</li>
<li>
<p>Rx</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_jdiameter_design"><a class="anchor" href="#_jdiameter_design"></a>2.1. Diameter Stack Design</h3>
<div class="sect3">
<h4 id="_jdiameter_design_extensibility"><a class="anchor" href="#_jdiameter_design_extensibility"></a>2.1.1. Diameter Stack Extensibility</h4>
<div class="paragraph">
<p>Diameter Stack has been designed to be extensible.
In order to achieve that, two set of APIs are defined by the stack - one that defines basic contracts between the user application and the stack, and one that defines contracts allowing the instance to inject custom objects into the stack to perform certain tasks (for example, <code class="class">SessionFactory</code>). <code class="class">ISessionFactory</code> declares additional methods that allow the developer to declare custom behaviour (for example, custom application sessions). Please refer to <a href="#_jdiameter_source_overview_session_factory">Session Factory</a> for more detailed information.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/DIA_2_x_JD_DESIGN.png" alt="DIA 2 x JD DESIGN">
</div>
<div class="title">Figure 3. Diameter Stack Extensibility Visualization</div>
</div>
<div class="paragraph">
<p>The general pattern for interface declaration is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The interface <code>ComponentInterface</code> declares the minimal set of methods for a component to perform its task.</p>
</li>
<li>
<p>The interface <code>IComponentInterface</code> provides additional behavior methods.
Please refer to the java doc for a list of interfaces and descriptions of method contracts.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_jdiameter_design_model"><a class="anchor" href="#_jdiameter_design_model"></a>2.1.2. Diameter Stack Model</h4>
<div class="paragraph">
<p>Diameter Stack performs the following tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Manages connections to remote peers.</p>
</li>
<li>
<p>Manages session objects.</p>
</li>
<li>
<p>Routes messages on behalf of sessions.</p>
</li>
<li>
<p>Receives and delivers messages to assigned listeners (usually a session object).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Sessions use the stack and the services it provides to communicate with remote peers.
The application is the only place that holds references to sessions.
It can be seen as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/DIA_2_x_JD_stack_model.png" alt="DIA 2 x JD stack model">
</div>
<div class="title">Figure 4. Diameter Application and Stack Model</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdiameter_app_session_factories"><a class="anchor" href="#_jdiameter_app_session_factories"></a>2.1.3. Application Session Factories</h4>
<div class="paragraph">
<p>Application session factories perform two tasks:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>server stack as factory for sessions.</p>
</li>
<li>
<p>server session objects as holders for session related resources, like state change listener, event listeners and context.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The figure below shows the relationship between Application Session Factories and User Applications:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/DIA_2_x_JD_stack_appsession_1.png" alt="DIA 2 x JD stack appsession 1">
</div>
<div class="title">Figure 5. Application Session Factory and User Application</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Session context is a callback interface defined by some sessions.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="session-replication"><a class="anchor" href="#session-replication"></a>2.1.4. Session Replication</h4>
<div class="paragraph">
<p>Diameter Stack supports replication of session data and state.
Clustered stack instances can perform operations on session regardless of physical location.
Imagine the logically clustered stack as follows:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/DIA_2_x_JD_stack_cluster_1.png" alt="DIA 2 x JD stack cluster 1">
</div>
<div class="title">Figure 6. Diameter Cluster</div>
</div>
<div class="paragraph">
<p>Stack only replicates non simple sessions.
This is because simple sessions do not hold state and can be simply recreated by the application.
Simple sessions include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RawSessions</p>
</li>
<li>
<p>Sessions</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Diameter Cluster replicates the full state of sessions.
However, it does not replicate resources that are entirely local to the stack instance, like session listeners.
Local resource references are recreated once the session is being prepared to be used in the stack instance.
Listeners (state and events) are fetched from the respective session factory instance.
See <a href="#_jdiameter_app_session_factories">Application Session Factories</a> for more details.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdiameter_setup"><a class="anchor" href="#_jdiameter_setup"></a>2.2. Restcomm  Diameter Stack Setup</h3>
<div class="sect3">
<h4 id="_jdiameter_preinstall_requirements_and_prerequisites"><a class="anchor" href="#_jdiameter_preinstall_requirements_and_prerequisites"></a>2.2.1. Pre-Install Requirements and Prerequisites</h4>
<div class="paragraph">
<p>Ensure that the following requirements have been met before continuing with the install.</p>
</div>
<div class="sect4">
<h5 id="_jdiameter_hardware_requirements"><a class="anchor" href="#_jdiameter_hardware_requirements"></a>Hardware Requirements</h5>
<div class="paragraph">
<p>Restcomm Diameter Stack does not have any hardware requirements.</p>
</div>
</div>
<div class="sect4">
<h5 id="_jdiameter_software_prerequisites"><a class="anchor" href="#_jdiameter_software_prerequisites"></a>Software Prerequisites</h5>
<div class="paragraph">
<p>Restcomm Diameter Stack has the following software dependencies:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Pico Container</p>
</li>
<li>
<p>slf4j</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Clustered setup also requires following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>JDiameter HA</p>
</li>
<li>
<p>JBoss Cache</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdiameter_source_code"><a class="anchor" href="#_jdiameter_source_code"></a>2.2.2. Source Code</h4>
<div class="paragraph">
<p>This section provides instructions on how to obtain and build the Restcomm Diameter Stack from source code.</p>
</div>
<div class="sect4">
<h5 id="_jdiameter_release_source_building"><a class="anchor" href="#_jdiameter_release_source_building"></a>Release Source Code Building</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Downloading the source code</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Subversion is used to manage its source code.
Instructions for using Subversion, including install, can be found at <a href="http://svnbook.red-bean.com" class="bare">http://svnbook.red-bean.com</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use SVN to checkout a specific release source, the base URL is <a href="https://github.com/Restcomm/jdiameter" class="bare">https://github.com/Restcomm/jdiameter</a> , then add the specific release version, lets consider &amp;THIS.VERSION;.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[usr]$ git clone git@github.com:RestComm/jss7.git</code></pre>
</div>
</div>
</li>
<li>
<p>Building the source code</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Maven 3.2.5 (or higher) is used to build the release.
Instructions for using Maven2, including install, can be found at <a href="http://maven.apache.org" class="bare">http://maven.apache.org</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use Maven to build the deployable unit binary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>						[usr]$ cd -
						[usr]$ mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the process finishes you should have the  files deployed in maven archive.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_jdiameter_trunk_source_building"><a class="anchor" href="#_jdiameter_trunk_source_building"></a>Development Trunk Source Building</h5>
<div class="paragraph">
<p>Follow the process in <a href="#_jdiameter_release_source_building">Release Source Code Building</a>, replacing the SVN source code URL with <a href="https://github.com/Restcomm/jdiameter" class="bare">https://github.com/Restcomm/jdiameter</a> .</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdiameter_configuration"><a class="anchor" href="#_jdiameter_configuration"></a>2.3. Diameter Stack Configuration</h3>
<div class="paragraph">
<p>The stack is initially configured by parsing an XML file.
The top level structure of the file is described below.
Further explanation of each child element, and the applicable attributes, is provided later in this section.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Configuration xmlns="http://www.jdiameter.org/jdiameter-server"&gt;

	&lt;LocalPeer&gt;&lt;/LocalPeer&gt;
	&lt;Parameters&gt;&lt;/Parameters&gt;
	&lt;Network&gt;&lt;/Network&gt;
	&lt;Extensions&gt;&lt;/Extensions&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;LocalPeer&gt;
	&lt;URI value="aaa://localhost:3868"/&gt;
	&lt;IPAddresses&gt;
		&lt;IPAddress value="127.0.0.1"/&gt;
	&lt;/IPAddresses&gt;

	&lt;Realm value="mobicents.org"/&gt;
	&lt;VendorID value="193"/&gt;
	&lt;ProductName value="jDiameter"/&gt;
	&lt;FirmwareRevision value="1"/&gt;

	&lt;OverloadMonitor&gt;
		&lt;Entry index="1" lowThreshold="0.5" highThreshold="0.6"&gt;
			&lt;ApplicationID&gt;
				&lt;VendorId value="193"/&gt;
				&lt;AuthApplId value="0"/&gt;
				&lt;AcctApplId value="19302"/&gt;
			&lt;/ApplicationID&gt;
		&lt;/Entry&gt;
	&lt;/OverloadMonitor&gt;
	&lt;Applications&gt;
		&lt;ApplicationID&gt;
			&lt;VendorId value="193"/&gt;
			&lt;AuthApplId value="0"/&gt;
			&lt;AcctApplId value="19302"/&gt;
		&lt;/ApplicationID&gt;
	&lt;/Applications&gt;
&lt;/LocalPeer&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &lt;LocalPeer&gt; element contains parameters that affect the local Diameter peer.
The available elements and attributes are listed for reference.</p>
</div>
<div class="dlist">
<div class="title">&lt;LocalPeer&gt; Elements and Attributes</div>
<dl>
<dt class="hdlist1">&lt;URI&gt;</dt>
<dd>
<p>Specifies the URI for the local peer.
The URI has the following format: "aaa://FQDN:port".</p>
</dd>
<dt class="hdlist1">&lt;IPAddresses&gt;</dt>
<dd>
<p>Contains one or more child &lt;IPAddress&gt; element, which contain a single, valid IP address for the local peer, stored in the <code class="parameter">value</code> attribute of the IPAddress.</p>
</dd>
<dt class="hdlist1">&lt;Realm&gt;</dt>
<dd>
<p>Specifies the realm of the local peer, using the <code class="parameter">value</code> attribute.</p>
</dd>
<dt class="hdlist1">&lt;VendorID&gt;</dt>
<dd>
<p>Specifies a numeric identifier that corresponds to the vendor ID allocated by IANA.</p>
</dd>
<dt class="hdlist1">&lt;ProductName&gt;</dt>
<dd>
<p>Specifies the name of the local peer product.</p>
</dd>
<dt class="hdlist1">&lt;FirmwareRevision&gt;</dt>
<dd>
<p>Specifies the version of the firmware.</p>
</dd>
<dt class="hdlist1">&lt;OverloadMonitor&gt;</dt>
<dd>
<p>Optional parent element containing child elements that specify settings relating to the Overload Monitor.</p>
</dd>
<dt class="hdlist1">&lt;Entry&gt;</dt>
<dd>
<p>Supports &lt;ApplicationID&gt; child elements that specify the ID of the tracked application(s). It also supports the following properties:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>index
  Defines the index of this overload monitor, so priorities/orders can be specified.</p>
</div>
<div class="paragraph">
<p>lowThreshold
  The low threshold for activation of the overload monitor.</p>
</div>
<div class="paragraph">
<p>highThreshold
  The high threshold for activation of the overload monitor.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;ApplicationID&gt;</dt>
<dd>
<p>Parent element containing child elements that specify information about the application.
The child elements create a unique application identifier.
The child elements are:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>&lt;VendorId&gt;
Specifies the vendor ID for application definition. It supports a single property: "value".</p>
</div>
<div class="paragraph">
<p>&lt;AuthAppId&gt;
The Authentication Application ID for application definition. It supports a single property: "value".</p>
</div>
<div class="paragraph">
<p>&lt;AcctAplId&gt;
The Account Application ID for application definition. It supports a single property: "value".</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;Applications&gt;</dt>
<dd>
<p>Contains a child element &lt;ApplicationID&gt;, which defines the list of default supported applications.
It is used for the server side, when the stack is configured to accept incoming calls and there is an empty list of preconfigured peers (server is configured to accept any connection).</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Parameters&gt;

	&lt;AcceptUndefinedPeer value="true"/&gt;
	&lt;DuplicateProtection value="true"/&gt;
  &lt;DuplicateTimer value="240000"/&gt;
  &lt;DuplicateSize value="5000"/&gt;
	&lt;UseUriAsFqdn value="true"/&gt; &lt;!-- Needed for Ericsson SDK Emulator --&gt;
	&lt;QueueSize value="10000"/&gt;
	&lt;MessageTimeOut value="60000"/&gt;
	&lt;StopTimeOut value="10000"/&gt;
	&lt;CeaTimeOut value="10000"/&gt;
	&lt;IacTimeOut value="30000"/&gt;
	&lt;DwaTimeOut value="10000"/&gt;
	&lt;DpaTimeOut value="5000"/&gt;
	&lt;RecTimeOut value="10000"/&gt;

	&lt;!-- Peer FSM Thread Count Configuration --&gt;
	&lt;PeerFSMThreadCount value="3" /&gt;

	&lt;Concurrent&gt;
		&lt;Entity name="ThreadGroup" size="64"/&gt;
		&lt;Entity name="ProcessingMessageTimer" size="1"/&gt;
		&lt;Entity name="DuplicationMessageTimer" size="1"/&gt;
		&lt;Entity name="RedirectMessageTimer" size="1"/&gt;
		&lt;Entity name="PeerOverloadTimer" size="1"/&gt;
		&lt;Entity name="ConnectionTimer" size="1"/&gt;
		&lt;Entity name="StatisticTimer" size="1"/&gt;
		&lt;Entity name="ApplicationSession" size="16"/&gt;
	&lt;/Concurrent&gt;

&lt;/Parameters&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &lt;Parameters&gt; element contains elements that specify parameters for the Diameter stack.
The available elements and attributes are listed for reference.
If not specified otherwise, each tag supports a single property - "value", which indicates the value of the tag.</p>
</div>
<div class="dlist">
<div class="title">&lt;Parameters&gt; Elements and Attributes</div>
<dl>
<dt class="hdlist1">&lt;AcceptUndefinedPeer&gt;</dt>
<dd>
<p>Specifies whether the stack will accept connections from undefined peers.
The default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">&lt;DuplicateProtection&gt;</dt>
<dd>
<p>Specifies whether duplicate message protection is enabled.
The default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">&lt;DuplicateTimer&gt;</dt>
<dd>
<p>Specifies the time each duplicate message is valid for (in extreme cases, it can live up to 2 * DuplicateTimer - 1 milliseconds). The default, minimum value is <code>240000</code> (4 minutes in milliseconds).</p>
</dd>
<dt class="hdlist1">&lt;DuplicateSize&gt;</dt>
<dd>
<p>Specifies the number of requests stored for duplicate protection.
The default value is <code>5000</code>.</p>
</dd>
<dt class="hdlist1">&lt;UseUriAsFqdn&gt;</dt>
<dd>
<p>Determines whether the URI should be used as FQDN.
If it is set to <code>true</code>, the stack expects the destination/origin host to be in the format of "aaa://isdn.domain.com:3868" rather than the normal "isdn.domain.com". The default value is <code>false</code>.</p>
</dd>
<dt class="hdlist1">&lt;QueueSize&gt;</dt>
<dd>
<p>Determines how many tasks the peer state machine can have before rejecting the next task.
This queue contains FSM events and messaging.</p>
</dd>
<dt class="hdlist1">&lt;MessageTimeOut&gt;</dt>
<dd>
<p>Determines the timeout for messages other than protocol FSM messages.
The delay is in milliseconds.</p>
</dd>
<dt class="hdlist1">&lt;StopTimeOut&gt;</dt>
<dd>
<p>Determines how long the stack waits for all resources to stop.
The delays are in milliseconds.</p>
</dd>
<dt class="hdlist1">&lt;CeaTimeOut&gt;</dt>
<dd>
<p>Determines how long it takes for CER/CEA exchanges to timeout if there is no response.
The delays are in milliseconds.</p>
</dd>
<dt class="hdlist1">&lt;IacTimeOut&gt;</dt>
<dd>
<p>Determines how long the stack waits to retry the communication with a peer that has stopped answering DWR messages.
The delay is in milliseconds.</p>
</dd>
<dt class="hdlist1">&lt;DwaTimeOut&gt;</dt>
<dd>
<p>Determines how long it takes for a DWR/DWA exchange to timeout if there is no response.
The delay is in milliseconds.</p>
</dd>
<dt class="hdlist1">&lt;DpaTimeOut&gt;</dt>
<dd>
<p>Determines how long it takes for a DPR/DPA exchange to timeout if there is no response.
The delay is in milliseconds.</p>
</dd>
<dt class="hdlist1">&lt;RecTimeOut&gt;</dt>
<dd>
<p>Determines how long it takes for the reconnection procedure to timeout.
The delay is in milliseconds.</p>
</dd>
<dt class="hdlist1">&lt;PeerFSMThreadCount&gt;</dt>
<dd>
<p>Determines the number of threads for handling events in the Peer FSM.</p>
</dd>
<dt class="hdlist1">&lt;Concurrent /&gt;</dt>
<dd>
<p>Controls the thread pool sizes for different aspects of the stack.
It supports multiple <code class="parameter">Entity</code> child elements. <code class="parameter">Entity</code> elements configure thread groups.
These elements support the following properties:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>name
Specifies the name of the entity.</p>
</div>
<div class="paragraph">
<p>size
Specifies the thread pool size of the entity.</p>
</div>
<div class="paragraph">
<p>The default supported entities are:</p>
</div>
<div class="paragraph">
<p>ThreadGroup
Determines the maximum thread count in other entities.</p>
</div>
<div class="paragraph">
<p>ProcessingMessageTimer
Determines the thread count for message processing tasks.</p>
</div>
<div class="paragraph">
<p>DuplicationMessageTimer
Specifies the thread pool for identifying duplicate messages.</p>
</div>
<div class="paragraph">
<p>RedirectMessageTimer
Specifies the thread pool for redirecting messages that do not need any further processing.</p>
</div>
<div class="paragraph">
<p>PeerOverloadTimer
Determines the thread pool for managing the overload monitor.</p>
</div>
<div class="paragraph">
<p>ConnectionTimer
Determines the thread pool for managing tasks regarding peer connection FSM.</p>
</div>
<div class="paragraph">
<p>StatisticTimer
Determines the thread pool for statistic gathering tasks.</p>
</div>
<div class="paragraph">
<p>ApplicationSession
Determines the thread pool for managing the invocation of application session FSMs, which will invoke listeners.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;Network&gt;

	&lt;Peers&gt;
		&lt;!-- This peer is a server, if it's a client attempt_connect should be set to false --&gt;
		&lt;Peer name="aaa://127.0.0.1:3868" attempt_connect="true" rating="1"/&gt;
	&lt;/Peers&gt;

	&lt;Realms&gt;
		&lt;Realm name="mobicents.org" peers="127.0.0.1" local_action="LOCAL" dynamic="false" exp_time="1"&gt;
			&lt;ApplicationID&gt;
				&lt;VendorId value="193"/&gt;
				&lt;AuthApplId value="0"/&gt;
				&lt;AcctApplId value="19302"/&gt;
			&lt;/ApplicationID&gt;
		&lt;/Realm&gt;
	&lt;/Realms&gt;

&lt;/Network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The &lt;Network&gt; element contains elements that specify parameters for external peers.
The available elements and attributes are listed for reference.</p>
</div>
<div class="dlist">
<div class="title">&lt;Network&gt; Elements and Attributes</div>
<dl>
<dt class="hdlist1">&lt;Peers&gt;</dt>
<dd>
<p>Parent element containing the child element &lt;Peer&gt;, which specifies external peers and the way they connect.
&lt;Peer&gt; specifies the name of external peers, whether they should be treated as a server or client, and what rating the peer has externally.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>&lt;Peer&gt; supports the following properties:</p>
</div>
<div class="paragraph">
<p>name
Specifies the name of the peer in the form of a URI. The structure is "aaa://[fqdn|ip]:port" (for example, "aaa://192.168.1.1:3868").</p>
</div>
<div class="paragraph">
<p>attempt_connect
Determines if the stack should try to connect to this peer. This property accepts boolean values.</p>
</div>
<div class="paragraph">
<p>rating
Specifies the rating of this peer in order to achieve peer priorities/sorting.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;Realms&gt;</dt>
<dd>
<p>Parent element containing the child element &lt;Realm&gt;, which specifies all realms that connect into the Diameter network.
&lt;Realm&gt; contains attributes and elements that describe different realms configured for the Core.
It supports &lt;ApplicationID&gt; child elements, which define the applications supported.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>&lt;Realm&gt; supports the following parameters:</p>
</div>
<div class="paragraph">
<p>peers
Comma separated list of peers. Each peer is represented by an IP Address or FQDN.</p>
</div>
<div class="paragraph">
<p>local_action
Determines the action the Local Peer will play on the specified realm: Act as a LOCAL peer.</p>
</div>
<div class="paragraph">
<p>dynamic
Specifies if this realm is dynamic. That is, peers that connect to peers with this realm name will be added to the realm peer list if not present already.</p>
</div>
<div class="paragraph">
<p>exp_time
The time before a peer belonging to this realm is removed if no connection is available.</p>
</div>
<div class="paragraph">
<p>Below is an example configuration file for a server supporting the CCA, Sh and Ro Applications:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0"?&gt;
&lt;Configuration xmlns="http://www.jdiameter.org/jdiameter-server"&gt;

	&lt;LocalPeer&gt;
		&lt;URI value="aaa://127.0.0.1:3868" /&gt;
		&lt;Realm value="mobicents.org" /&gt;
		&lt;VendorID value="193" /&gt;
		&lt;ProductName value="jDiameter" /&gt;
		&lt;FirmwareRevision value="1" /&gt;
		&lt;OverloadMonitor&gt;
			&lt;Entry index="1" lowThreshold="0.5" highThreshold="0.6"&gt;
				&lt;ApplicationID&gt;
					&lt;VendorId value="193" /&gt;
					&lt;AuthApplId value="0" /&gt;
					&lt;AcctApplId value="19302" /&gt;
				&lt;/ApplicationID&gt;
			&lt;/Entry&gt;
		&lt;/OverloadMonitor&gt;
	&lt;/LocalPeer&gt;

	&lt;Parameters&gt;
		&lt;AcceptUndefinedPeer value="true" /&gt;
		&lt;DuplicateProtection value="true" /&gt;
    &lt;DuplicateTimer value="240000" /&gt;
    &lt;DuplicateSize value="5000" /&gt;
		&lt;UseUriAsFqdn value="false" /&gt; &lt;!-- Needed for Ericsson Emulator (set to true) --&gt;
		&lt;QueueSize value="10000" /&gt;
		&lt;MessageTimeOut value="60000" /&gt;
		&lt;StopTimeOut value="10000" /&gt;
		&lt;CeaTimeOut value="10000" /&gt;
		&lt;IacTimeOut value="30000" /&gt;
		&lt;DwaTimeOut value="10000" /&gt;
		&lt;DpaTimeOut value="5000" /&gt;
		&lt;RecTimeOut value="10000" /&gt;

		&lt;PeerFSMThreadCount value="3" /&gt;

		&lt;Concurrent&gt;
			 &lt;Entity name="ThreadGroup" size="64"/&gt;
			 &lt;Entity name="ProcessingMessageTimer" size="1"/&gt;
			 &lt;Entity name="DuplicationMessageTimer" size="1"/&gt;
			 &lt;Entity name="RedirectMessageTimer" size="1"/&gt;
			 &lt;Entity name="PeerOverloadTimer" size="1"/&gt;
			 &lt;Entity name="ConnectionTimer" size="1"/&gt;
			 &lt;Entity name="StatisticTimer" size="1"/&gt;
			 &lt;Entity name="ApplicationSession" size="16"/&gt;
		&lt;/Concurrent&gt;
	&lt;/Parameters&gt;

	&lt;Network&gt;
		&lt;Peers&gt;
			&lt;Peer name="aaa://127.0.0.1:1218" attempt_connect="false" rating="1" /&gt;
		&lt;/Peers&gt;
		&lt;Realms&gt;
			&lt;!-- CCA --&gt;
			&lt;Realm name="mobicents.org" peers="127.0.0.1" local_action="LOCAL"
				dynamic="false" exp_time="1"&gt;
				&lt;ApplicationID&gt;
					&lt;VendorId value="0" /&gt;
					&lt;AuthApplId value="4" /&gt;
					&lt;AcctApplId value="0" /&gt;
				&lt;/ApplicationID&gt;
			&lt;/Realm&gt;

			&lt;!-- Sh --&gt;
			&lt;Realm name="mobicents.org" peers="127.0.0.1" local_action="LOCAL"
				dynamic="false" exp_time="1"&gt;
				&lt;ApplicationID&gt;
					&lt;VendorId value="10415" /&gt;
					&lt;AuthApplId value="16777217" /&gt;
					&lt;AcctApplId value="0" /&gt;
				&lt;/ApplicationID&gt;
			&lt;/Realm&gt;

			&lt;!-- Ro --&gt;
			&lt;Realm name="mobicents.org" peers="127.0.0.1" local_action="LOCAL"
				dynamic="false" exp_time="1"&gt;
				&lt;ApplicationID&gt;
					&lt;VendorId value="10415" /&gt;
					&lt;AuthApplId value="4" /&gt;
					&lt;AcctApplId value="0" /&gt;
				&lt;/ApplicationID&gt;
			&lt;/Realm&gt;
		&lt;/Realms&gt;
	&lt;/Network&gt;

	&lt;Extensions /&gt;

&lt;/Configuration&gt;</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_jdiameter_cluster_configuration"><a class="anchor" href="#_jdiameter_cluster_configuration"></a>2.3.1. Cluster configuration</h4>
<div class="paragraph">
<p>The following list defines the requirements for enabling stack cluster mode</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Add the following entries to the <code>Parameters</code> section of <em class="path">jdiameter-config.xml</em>:</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;SessionDatasource&gt;org.mobicents.diameter.impl. ha.data.ReplicatedData&lt;/SessionDatasource&gt;
&lt;TimerFacility&gt;org.mobicents.diameter.impl.ha. timer.ReplicatedTimerFacilityImpl&lt;/TimerFacility&gt;</code></pre>
</div>
</div>
</li>
<li>
<p>A proper <code>JBoss Cache</code> configuration file: <em class="path">jdiameter-jbc.xml</em> (located in the <em class="path">config</em> directory).</p>
<div class="paragraph">
<p>The following content is sufficient for the JBoss Cache configuration file:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;jbosscache xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="urn:jboss:jbosscache-core:config:3.0"&gt;

	&lt;locking isolationLevel="REPEATABLE_READ"
		lockParentForChildInsertRemove="false" lockAcquisitionTimeout="20000"
		nodeLockingScheme="mvcc" writeSkewCheck="false" concurrencyLevel="500" /&gt;

	&lt;jmxStatistics enabled="false" /&gt;

	&lt;startup regionsInactiveOnStartup="false" /&gt;
	&lt;shutdown hookBehavior="DEFAULT" /&gt;
	&lt;listeners asyncPoolSize="1" asyncQueueSize="100000" /&gt;

	&lt;invocationBatching enabled="false" /&gt;

	&lt;serialization objectInputStreamPoolSize="12"
		objectOutputStreamPoolSize="14" version="3.0.0"
		marshallerClass="org.jboss.cache.marshall.CacheMarshaller300"
		useLazyDeserialization="false" useRegionBasedMarshalling="false" /&gt;

	&lt;clustering mode="replication" clusterName="DiameterCluster"&gt;

		&lt;async useReplQueue="true" replQueueInterval="1000"
			replQueueMaxElements="500" serializationExecutorPoolSize="20"
			serializationExecutorQueueSize="5000000"/&gt;

		&lt;jgroupsConfig&gt;
			&lt;UDP
				mcast_addr="${jgroups.udp.mcast_addr:228.10.10.10}"
				mcast_port="${jgroups.udp.mcast_port:18811}"
				discard_incompatible_packets="true"
				max_bundle_size="60000"
				max_bundle_timeout="30"
				ip_ttl="${jgroups.udp.ip_ttl:2}"
				enable_bundling="true"
				thread_pool.enabled="true"
				thread_pool.min_threads="1"
				thread_pool.max_threads="25"
				thread_pool.keep_alive_time="5000"
				thread_pool.queue_enabled="false"
				thread_pool.queue_max_size="100"
				thread_pool.rejection_policy="Run"
				oob_thread_pool.enabled="true"
				oob_thread_pool.min_threads="1"
				oob_thread_pool.max_threads="8"
				oob_thread_pool.keep_alive_time="5000"
				oob_thread_pool.queue_enabled="false"
				oob_thread_pool.queue_max_size="100"
				oob_thread_pool.rejection_policy="Run"/&gt;

			&lt;PING timeout="2000"
				num_initial_members="3"/&gt;
			&lt;MERGE2 max_interval="30000"
				min_interval="10000"/&gt;
			&lt;FD_SOCK/&gt;
			&lt;FD timeout="10000" max_tries="5" /&gt;
			&lt;VERIFY_SUSPECT timeout="1500"  /&gt;
			&lt;BARRIER /&gt;
			&lt;pbcast.NAKACK
				use_mcast_xmit="false" gc_lag="0"
				retransmit_timeout="300,600,1200,2400,4800"
				discard_delivered_msgs="true"/&gt;
			&lt;UNICAST timeout="300,600,1200,2400,3600"/&gt;
			&lt;pbcast.STABLE stability_delay="1000" desired_avg_gossip="50000"
				max_bytes="400000"/&gt;
			&lt;VIEW_SYNC avg_send_interval="60000"   /&gt;
			&lt;pbcast.GMS print_local_addr="true" join_timeout="3000"
				view_bundling="true"/&gt;
			&lt;FC max_credits="20000000"
				min_threshold="0.10"/&gt;
			&lt;FRAG2 frag_size="60000"  /&gt;
			&lt;pbcast.STATE_TRANSFER  /&gt;
		&lt;/jgroupsConfig&gt;
	&lt;/clustering&gt;

&lt;/jbosscache&gt;</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdiameter_source_overview"><a class="anchor" href="#_jdiameter_source_overview"></a>2.4. Diameter Stack Source overview</h3>
<div class="paragraph">
<p>Diameter stack is built with the following basic components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Session Factory</dt>
<dd>
<p>The Session Factory governs the creation of sessions - raw and specific application sessions.</p>
</dd>
<dt class="hdlist1">Raw and Application Sessions</dt>
<dd>
<p>Sessions govern stateful message routing between peers.
Specific application sessions consume different type of messages and act differently based on the data present.</p>
</dd>
<dt class="hdlist1">Stack</dt>
<dd>
<p>The Stack governs all necessary components, which are used to establish connection and communicate with remote peers.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more detailed information, please refer to the Javadoc or the simple examples that can be found here: <a href="https://github.com/RestComm/jdiameter/tree/master/testsuite/load">Git Testsuite HEAD</a>.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_jdiameter_source_overview_session_factory"><a class="anchor" href="#_jdiameter_source_overview_session_factory"></a>2.4.1. Session Factory</h4>
<div class="paragraph">
<p><code class="class">SessionFactory</code> provides the stack user with access to session objects.
It manages registered application session factories in order to allow for the creation of specific application sessions.
A Session Factory instance can be obtained from the stack using the <code class="method">getSessionFactory()</code> method.
The base <code class="class">SessionFactory</code> interface is defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.jdiameter.api;

import org.jdiameter.api.app.AppSession;

public interface SessionFactory {

	RawSession getNewRawSession() throws InternalException;

	Session getNewSession() throws InternalException;

	Session getNewSession(String sessionId) throws InternalException;

	&lt;T extends AppSession&gt; T getNewAppSession(ApplicationId applicationId,
		Class&lt;? extends AppSession&gt; userSession) throws InternalException;

	&lt;T extends AppSession&gt; T getNewAppSession(String sessionId, ApplicationId
		applicationId, Class&lt;? extends AppSession&gt; userSession) throws InternalException;
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>However, since the stack is extensible, it is safe to cast the <code class="class">SessionFactory</code> object to this interface:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.jdiameter.client.api;


public interface ISessionFactory extends SessionFactory {

	&lt;T extends AppSession&gt; T getNewAppSession(String sessionId,
		ApplicationId applicationId, java.lang.Class&lt;? extends AppSession&gt;
		aClass, Object... args) throws InternalException;

	void registerAppFacory(Class&lt;? extends AppSession&gt; sessionClass,
		IAppSessionFactory factory);

	void unRegisterAppFacory(Class&lt;? extends AppSession&gt; sessionClass);

	IConcurrentFactory getConcurrentFactory();

}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code class="method">RawSession getNewRawSession() throws InternalException;</code></dt>
<dd>
<p>This method creates a <code class="class">RawSession</code>.
Raw sessions are meant as handles for code performing part of the routing decision on the stack&#8217;s, such as rely agents for instance.</p>
</dd>
<dt class="hdlist1"><code class="method">Session getNewSession() throws InternalException;</code></dt>
<dd>
<p>This method creates a session that acts as the endpoint for peer communication (for a given session ID). It declares the method that works with the <code class="class">Request</code> and <code class="class">Answer</code> objects.
A session created with this method has an autogenerated ID.
It should be considered as a client session.</p>
</dd>
<dt class="hdlist1"><code class="method">Session getNewSession(String sessionId) throws InternalException;</code></dt>
<dd>
<p>As above.
However, the created session has an ID equal to that passsed as an argument.
This created session should be considered a server session.</p>
</dd>
<dt class="hdlist1"><code class="method">&lt;T extends AppSession&gt; T getNewAppSession(ApplicationId applicationId, Class&lt;? extends AppSession&gt; userSession) throws InternalException;</code></dt>
<dd>
<p>This method creates a new specific application session, identified by the application ID and class of the session passed.
The session ID is generated by implementation.
New application sessions should be considered as client sessions.
It is safe to type cast the return value to class passed as an argument.
This method delegates the call to a specific application session factory.</p>
</dd>
<dt class="hdlist1"><code class="method">&lt;T extends AppSession&gt; T getNewAppSession(String sessionId, ApplicationId applicationId, Class&lt;? extends AppSession&gt; userSession) throws InternalException;</code></dt>
<dd>
<p>As above.
However, the session Id is equal to the argument passed.
New sessions should be considered server sessions.</p>
</dd>
<dt class="hdlist1"><code class="method">&lt;T extends AppSession&gt; T getNewAppSession(String sessionId, ApplicationId applicationId, java.lang.Class&lt;? extends AppSession&gt; aClass, Object&#8230;&#8203; args) throws InternalException;</code></dt>
<dd>
<p>As above.
However, it allows the stack to pass some additional arguments.
Passed values are implementation specifc.</p>
</dd>
<dt class="hdlist1"><code class="method">void registerAppFacory(Class&lt;? extends AppSession&gt; sessionClass, IAppSessionFactory factory);</code></dt>
<dd>
<p>Registers the <code class="parameter">factory</code> for a certain <code class="parameter">sessionClass</code>.
This factory will receive a delegated call when ever the <code class="method">getNewAppSession</code> method is called with an application class matching one from the register method.</p>
</dd>
<dt class="hdlist1"><code class="method">void unRegisterAppFacory(Class&lt;? extends AppSession&gt; sessionClass);</code></dt>
<dd>
<p>Removes the application session factory registered for the <code class="parameter">sessionClass</code>.</p>
</dd>
</dl>
</div>
<div class="exampleblock">
<div class="title">Example 1. SessionFactory use example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class Test implements EventListener&lt;Request, Answer&gt;
{

....
public void test(){
	Stack stack = new StackImpl();
	XMLConfiguration config = new XMLConfiguration(new FileInputStream(new File(configFile));

	SessionFactory sessionFactory = stack.init(config);
	stack.start();
	//perferctly legal, both factories are the same.
	sessionFactor = stack.getSessionFactory();
	Session session = sessionFactory.getNewSession();
	session.setRequestListener(this);
	Request r = session.createRequest(308,ApplicationId.createByAuth(100L,10101L),
		"mobicents.org","aaa://uas.fancyapp.mobicents.org");

	//add avps specific for app
	session.send(r,this);
	}
}</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock">
<div class="title">Example 2. SessionFactory use example</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">class Test implements EventListener&lt;Request, Answer&gt;
{
	Stack stack = new StackImpl();
	XMLConfiguration config = new XMLConfiguration(new FileInputStream(new File(configFile));

	ISessionFactory sessionFactory = (ISessionFactory)stack.init(config);
	stack.start();
	//perferctly legal, both factories are the same.
	sessionFactor = (ISessionFactory)stack.getSessionFactory();
	sessionFactory.registerAppFacory(ClientShSession.class, new ShClientSessionFactory(this));

	//our implementation of factory does not require any parameters
	ClientShSession session = (ClientShSession) sessionFactory.getNewAppSession(null, null
		, ClientShSession.class, null);

	...
	session.sendUserDataRequest(udr);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdiameter_source_overview_session"><a class="anchor" href="#_jdiameter_source_overview_session"></a>2.4.2. Sessions</h4>
<div class="paragraph">
<p><code class="class">RawSessions</code>, <code class="class">Sessions</code> and <code class="class">ApplicationSessions</code> provide the means for dispatching and receiving messages.
Specific implementation of <code class="class">ApplicationSession</code> may provide non standard methods.</p>
</div>
<div class="paragraph">
<p>The <code class="class">RawSession</code> and the <code class="class">Session</code> life span is controlled entirely by the application.
However, the <code class="class">ApplicationSession</code> life time depends on the implemented state machine.</p>
</div>
<div class="paragraph">
<p><code class="class">RawSession</code> is defined as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface BaseSession extends Wrapper, Serializable {

	long getCreationTime();

	long getLastAccessedTime();

	boolean isValid();

	Future&lt;Message&gt; send(Message message) throws InternalException,
		IllegalDiameterStateException, RouteException, OverloadException;

	Future&lt;Message&gt; send(Message message, long timeOut, TimeUnit timeUnit)
		throws InternalException, IllegalDiameterStateException, RouteException, OverloadException;

	void release();
}

public interface RawSession extends BaseSession {

	Message createMessage(int commandCode, ApplicationId applicationId, Avp... avp);

	Message createMessage(int commandCode, ApplicationId applicationId,
		long hopByHopIdentifier, long endToEndIdentifier, Avp... avp);

	Message createMessage(Message message, boolean copyAvps);

	void send(Message message, EventListener&lt;Message, Message&gt; listener)
		throws InternalException, IllegalDiameterStateException, RouteException, OverloadException;

	void send(Message message, EventListener&lt;Message, Message&gt; listener,
		long timeOut, TimeUnit timeUnit) throws InternalException,
		IllegalDiameterStateException, RouteException, OverloadException;
}</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code class="method">long getCreationTime();</code></dt>
<dd>
<p>Returns the time stamp of this session creation.</p>
</dd>
<dt class="hdlist1"><code class="method">long getLastAccessedTime();</code></dt>
<dd>
<p>Returns the time stamp indicating the last sent or received operation.</p>
</dd>
<dt class="hdlist1"><code class="method">boolean isValid();</code></dt>
<dd>
<p>Returns <code>true</code> when this session is still valid (ie, <code class="method">release()</code> has not been called).</p>
</dd>
<dt class="hdlist1"><code class="method">void release();</code></dt>
<dd>
<p>Application calls this method to inform the user that the session should free any associated resource - it shall not be used anymore.</p>
</dd>
<dt class="hdlist1"><code class="method">Future&lt;Message&gt; send(Message message)</code></dt>
<dd>
<p>Sends a message in async mode.
The <code class="class">Future</code> reference provides the means of accessing the answer once it is received</p>
</dd>
<dt class="hdlist1"><code class="method">void send(Message message, EventListener&lt;Message, Message&gt; listener, long timeOut, TimeUnit timeUnit)</code></dt>
<dd>
<p>As above.
Allows to specify the time out value for send operations.</p>
</dd>
<dt class="hdlist1"><code class="method">Message createMessage(int commandCode, ApplicationId applicationId, Avp&#8230;&#8203; avp);</code></dt>
<dd>
<p>Creates a Diameter message.
It should be explicitly set either as a request or answer.
Passed parameters are used to build messages.</p>
</dd>
<dt class="hdlist1"><code class="method">Message createMessage(int commandCode, ApplicationId applicationId, long hopByHopIdentifier, long endToEndIdentifier, Avp&#8230;&#8203; avp);</code></dt>
<dd>
<p>As above.
However, it also allows for the Hop-by-Hop and End-to-End Identifiers in the message header to be set.
This method should be used to create answers.</p>
</dd>
<dt class="hdlist1"><code class="method">Message createMessage(Message message, boolean copyAvps);</code></dt>
<dd>
<p>Clones a message and returns the created object.
The copyAvps parameter defines whether basic AVPs (Session, Route and Proxy information) should be copied to the new object.</p>
</dd>
<dt class="hdlist1"><code class="method">void send(Message message, EventListener&lt;Message, Message&gt; listener)</code></dt>
<dd>
<p>Sends a message.
The answer will be delivered by the specified listener</p>
</dd>
<dt class="hdlist1"><code class="method">void send(Message message, EventListener&lt;Message, Message&gt; listener, long timeOut, TimeUnit timeUnit)</code></dt>
<dd>
<p>As above.
It also allows for the answer to be passed after timeout.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><code class="class">Session</code> defines similar methods, with exactly the same purpose:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public interface Session extends BaseSession {
	String getSessionId();

	void setRequestListener(NetworkReqListener listener);

	Request createRequest(int commandCode, ApplicationId appId, String destRealm);

	Request createRequest(int commandCode, ApplicationId appId, String destRealm, String destHost);

	Request createRequest(Request prevRequest);

	void send(Message message, EventListener&lt;Request, Answer&gt; listener)
		throws InternalException, IllegalDiameterStateException, RouteException, OverloadException;

	void send(Message message, EventListener&lt;Request, Answer&gt; listener, long timeOut,
		TimeUnit timeUnit) throws InternalException, IllegalDiameterStateException,
		RouteException, OverloadException;
}</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="application-session-factories"><a class="anchor" href="#application-session-factories"></a>2.4.3. Application Session Factories</h4>
<div class="paragraph">
<p>In the table below, you can find session factories provided by current implementation, along with a short description:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Application Factories</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Factory class</th>
<th class="tableblock halign-left valign-top">Application type &amp; id</th>
<th class="tableblock halign-left valign-top">Application</th>
<th class="tableblock halign-left valign-top">Reference</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.acc.AccSessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountingId[0:3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Acc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FC3588</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.auth.AuthSessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specific</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Auth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RFC3588</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.cca.CCASessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuthId[0:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">CCA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">RFC4006</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.sh.ShSessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuthId[10415:16777217]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sh</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TS.29328, TS.29329</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.cxdx.CxDxSessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuthId[13019:16777216]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TS.29228, TS.29229</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.cxdx.CxDxSessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuthId[10415:16777216]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TS.29228, TS.29229</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.acc.AccSessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AccountingId[10415:3]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Rf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">S.32240</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">org.jdiameter.common.impl.app.cca.CCASessionFactoryImpl</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AuthId[10415:4]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ro</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">TS.32240</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
There is no specific factory for Ro and Rf.
Those applications reuse the respective session and session factories.
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Application IDs contain two numbers - [VendorId:ApplicationId].
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Spaces have been introduced in the <code>Factory class</code> column values to correctly render the table.
Please remove them when using copy/paste.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_jdiameter_validator"><a class="anchor" href="#_jdiameter_validator"></a>2.5. Diameter Stack Validator</h3>
<div class="paragraph">
<p>Validator is one of the Stack features.
The primary purpose of the Validator is to detect malformed messages, such as an Answer message containing a Destination-Host Attribute Value Pair (AVP).</p>
</div>
<div class="paragraph">
<p>The Validator is capable of validating multi-leveled, grouped AVPs, excluding the following content types:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>URI, or Identifier types.</p>
</li>
<li>
<p>Enumerated types against defined values.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Validator is only capable of checking structural integrity, not the content of the message.</p>
</div>
<div class="paragraph">
<p>The Validator performs the following checks:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Index</dt>
<dd>
<p>Checks that the AVPs are in the correct place.
For example, <code>Session-Id</code> must always be encoded before any other AVP.</p>
</dd>
<dt class="hdlist1">Multiplicity</dt>
<dd>
<p>Checks that the message AVPs occur the proper number of times.
For example, the Session-ID should only be present once.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The <code>Validator</code> is called by the stack implementation.
It is invoked after the message is received, but before it is dispatched to a remote peer.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
This means that if the peer does not exist in the local peer table, the validator is not called, as the stack fails before calling it.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_jdiameter_validator_configuration"><a class="anchor" href="#_jdiameter_validator_configuration"></a>2.5.1. Validator Configuration</h4>
<div class="paragraph">
<p>The Validator is configured with a single XML file.
This file contains the structure definition for both messages and AVPs.</p>
</div>
<div class="paragraph">
<p>Upon creation of the Diameter Stack, the validator is initialized.
It performs the initialization by looking up the <em class="path">dictionary.xml</em> file in classpath.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The configuration file contains more data that <code>Validator</code> uses to build its data base.
This is because the <code>Dictionary</code> uses the same file to configure itself.
It reuses the AVP definitions, with some extra information like AVP type and flags.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The configuration file has the following structure:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dictonary&gt;
	&lt;validator enabled="true|false" sendLevel="OFF|MESSAGE|ALL" receiveLevel="OFF|MESSAGE|ALL" /&gt;
	&lt;vendor name="" vendor-id="" code=""/&gt;
	&lt;typedefn type-name="" type-parent=""/&gt;
	&lt;application id="" name=""&gt;
		&lt;avp ...&gt;
			&lt;type type-name=""/&gt;
			&lt;enum name="" code=""/&gt;
			&lt;grouped&gt;
				&lt;gavp name=""/&gt;
			&lt;grouped/&gt;
		&lt;avp/&gt;
		&lt;command name="" code="" request="true|false"/&gt;
		&lt;avp ...&gt;
			&lt;type type-name=""/&gt;
			&lt;enum name="" code=""/&gt;
			&lt;grouped&gt;
				&lt;gavp name=""/&gt;
			&lt;grouped/&gt;
		&lt;avp/&gt;
	&lt;application&gt;
&lt;dictionary/&gt;</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;dictionary&gt;</dt>
<dd>
<p>The root element that contains the child elements comprising the validator and dictionary components.
This element does not support any attributes.</p>
</dd>
<dt class="hdlist1">&lt;validator&gt;</dt>
<dd>
<p>Specifies whether message validation is activated for sent and received stack messages.
The element supports the following optional attributes:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>enabled
Specifies whether the validator is activated or deactivated. If not specified, the validator is deactivated.</p>
</div>
<div class="paragraph">
<p>sendLevel
Determines the validation level for messages sent by the stack instance. Values determine if sent messages are not validated at all (OFF), only message level AVPs are checked (MESSAGE) or all AVPs are checked (ALL).</p>
</div>
<div class="paragraph">
<p>receiveLevel
Determines the validation level for messages received by the stack instance. Values determine if sent messages are not validated at all (OFF), only message level AVPs are checked (MESSAGE) or all AVPs are checked (ALL).</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;vendor&gt;</dt>
<dd>
<p>Optional element that specifies the mapping between the vendor name, vendor ID, and vendor code.
The element supports the following required attributes:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>name
Specifies the vendor name. For example, "Hewlett Packard".</p>
</div>
<div class="paragraph">
<p>vendor-id
Specifies the unique ID associated with the vendor. For example, "HP".</p>
</div>
<div class="paragraph">
<p>code
Specifies the alpha-numeric code allocated to the vendor by IANA. For example, "11". The value must be unique for each &lt;vendor&gt; declaration.</p>
</div>
<div class="exampleblock">
<div class="title">Example 3. &lt;vendor&gt; XML Attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">...
&lt;vendor vendor-id="None" code="0" name="None" /&gt;
&lt;vendor vendor-id="HP" code="11" name="Hewlett Packard" /&gt;
&lt;vendor vendor-id="Merit" code="61" name="Merit Networks" /&gt;
&lt;vendor vendor-id="Sun" code="42" name="Sun Microsystems, Inc." /&gt;
&lt;vendor vendor-id="USR" code="429" name="US Robotics Corp." /&gt;
&lt;vendor vendor-id="3GPP2" code="5535" name="3GPP2" /&gt;
&lt;vendor vendor-id="TGPP" code="10415" name="3GPP" /&gt;
&lt;vendor vendor-id="TGPPCX" code="16777216" name="3GPP CX/DX" /&gt;
&lt;vendor vendor-id="TGPPSH" code="16777217" name="3GPP SH" /&gt;
&lt;vendor vendor-id="Ericsson" code="193" name="Ericsson" /&gt;
&lt;vendor vendor-id="ETSI" code="13019" name="ETSI" /&gt;
&lt;vendor vendor-id="Vodafone" code="12645" name="Vodafone" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;typedefn&gt;</dt>
<dd>
<p>Defines the simple Attribute Value Pair (AVP) types.
The element supports the following required attributes:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>type-name
Specifies a type name in accordance with the acceptable base types defined in RFC 3588. For example; "Enumerated", "OctetString", "Integer32".</p>
</div>
<div class="paragraph">
<p>type-parent
Specifies the parent type name used to define the base characteristics of the type. The values are restricted to defined &lt;typedefn&gt; elements. For example; "OctetString", "UTF8String", "IPAddress".</p>
</div>
<div class="exampleblock">
<div class="title">Example 4. &lt;typedefn&gt; XML Attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;!-- Primitive types, see http://tools.ietf.org/html/rfc3588#section-4.2 --&gt;
&lt;typedefn type-name="OctetString" /&gt;
&lt;typedefn type-name="Float64" /&gt;
&lt;typedefn type-name="Float32" /&gt;
&lt;typedefn type-name="Integer64" /&gt;
&lt;typedefn type-name="Integer32" /&gt;
&lt;typedefn type-name="Unsigned64" /&gt;
&lt;typedefn type-name="Unsigned32" /&gt;

&lt;!-- derived avp types, see http://tools.ietf.org/html/rfc3588#section-4.3 --&gt;
&lt;typedefn type-name="Address" type-parent="OctetString" /&gt;
&lt;typedefn type-name="Time" type-parent="OctetString" /&gt;
&lt;typedefn type-name="UTF8String" type-parent="OctetString" /&gt;
&lt;typedefn type-name="DiameterIdentity" type-parent="OctetString" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;application&gt;</dt>
<dd>
<p>Defines the specific applications used within the dictionary.
Two child elements are supported by &lt;application&gt;: &lt;avp&gt; and &lt;command&gt;.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The &lt;application&gt; element supports the following attributes:</p>
</div>
<div class="paragraph">
<p>id
Specifies the unique ID allocated to the application. The attribute is used in all messages and forms part of the message header.</p>
</div>
<div class="paragraph">
<p>name
Optional attribute that specifies the logical name of the application.</p>
</div>
<div class="paragraph">
<p>uri
Optional attribute that specifies a link to additional application information.</p>
</div>
<div class="exampleblock">
<div class="title">Example 5. &lt;application&gt; XML Attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;application id="16777216" name="3GPP Cx/Dx" uri="http://www.ietf.org/rfc/rfc3588.txt?number=3588"&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;avp&gt;</dt>
<dd>
<p>Element containing information necessary to configure the Attribute Value Pairs. <a href="#_table_avp_attributes">[_table_avp_attributes]</a> contains the complete list of supported attributes, and their available values (if applicable).
The &lt;avp&gt; element supports a number of child elements that are used to set finer parameters for the individual AVP. The supported elements are &lt;type&gt;, &lt;enum&gt;, and &lt;grouped&gt;.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Different sets of elements are supported by &lt;avp&gt; depending on its position in the dictionary.xml file.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 6. &lt;avp&gt; Child Elements and Attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;avp name="Server-Assignment-Type" code="614" mandatory="must" vendor-bit="must"
 vendor-id="TGPP" may-encrypt="no"&gt;
	 &lt;type type-name="Unsigned32" /&gt;
	 &lt;enum name="NO_ASSIGMENT" code="0" /&gt;
	 &lt;enum name="REGISTRATION" code="1" /&gt;
	 &lt;enum name="RE_REGISTRATION" code="2" /&gt;
	 &lt;enum name="UNREGISTERED_USER" code="3" /&gt;
	 &lt;grouped&gt;
		 &lt;gavp name="SIP-Item-Number" multiplicity="0-1"/&gt;
		 &lt;gavp name="SIP-Authentication-Scheme" multiplicity="0-1"/&gt;
		 &lt;gavp name="SIP-Authenticate" multiplicity="0-1"/&gt;
		 &lt;gavp name="Line-Identifier" multiplicity="0+"/&gt;
	 &lt;/grouped&gt;
&lt;/avp&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;type&gt;</dt>
<dd>
<p>Child element of &lt;avp&gt; that is used to match the AVP with the AVP type as defined in the &lt;typedefn&gt; element.
The element supports the following mandatory attribute:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>type-name
Specifies the type-name of the element. This is used to match the type-name value in the &lt;typedefn&gt; element.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
&lt;type&gt; is ignored if the &lt;avp&gt; element contains the &lt;grouped&gt; element.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;enum&gt;</dt>
<dd>
<p>Child element of &lt;avp&gt; that specifies the enumeration value for the specified AVP.
&lt;enum&gt; is used only when the type-name attribute of &lt;type&gt; is specified.
The element supports the following mandatory attributes:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>name
Specifies the name of a constant value that applies to the AVP.</p>
</div>
<div class="paragraph">
<p>code
Specifies the integer value associated with the name of the constant. The value is passed as a value of the AVP, and maps to the name attribute.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
&lt;enum&gt; is ignored if the &lt;avp&gt; element contains the &lt;grouped&gt; element.
</td>
</tr>
</table>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;grouped&gt;</dt>
<dd>
<p>Child element of &lt;avp&gt; that specifies the AVP is a grouped type.
A grouped AVP is one that has no &lt;typedefn&gt; element present.
The element does not support any attributes, however the &lt;gavp&gt; element is allowed as a child element.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The &lt;gavp&gt;, which specifies a reference to a grouped AVP, supports one mandatory attribute:</p>
</div>
<div class="paragraph">
<p>name
Specifies the name of the grouped AVP member. The value must match the defined AVP name.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. &lt;avp&gt; Attributes</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Attribute Name (optional in brackets)</th>
<th class="tableblock halign-left valign-top">Explicit Values (default in brackets)</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the name of the AVP. This is used to match the AVP definition to any grouped AVP references. For further information about grouped AVPs, refer to the element description in this section.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the integer code of the AVP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(vendor-id)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(none)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Used to match the vendor ID reference to the value defined in the &lt;vendor&gt; element.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">(multiplicity)</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the number of acceptable AVPs in a message using an explicit value.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An AVP must not be present in the message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(0+)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero or more instances of the AVP must be present in the message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0-1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zero, or one instance of the AVP may be present in the message. An error occurs if the message contains more than one instance of the AVP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">One instance of the AVP must be present in the message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1+</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">At least one instance of the AVP must be present in the message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">may-encrypt</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes | (No)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the AVP can be encrypted.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">protected</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">may | must | mustnot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines actual state of AVP that is expected, if it MUST be encrypted , may or MUST NOT.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vendor-bit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">must | mustnot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies whether the Vendor ID should be set.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">mandatory</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">may | must | mustnot</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines if support for this AVP is mandatory in order to consume/process message.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vendor</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Specifies the defined vendor code, which is used by the &lt;command&gt; child element</p></td>
</tr>
</tbody>
</table>
<div class="exampleblock">
<div class="title">Example 7. &lt;avp&gt; XML Attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;!-- MUST --&gt;
&lt;avp name="Session-Id" code="263" vendor="0" multiplicity="1" index="0" /&gt;
&lt;avp name="Auth-Session-State" code="277" vendor="0" multiplicity="1" index="-1" /&gt;

&lt;!-- MAY --&gt;
&lt;avp name="Destination-Host" code="293" vendor="0" multiplicity="0-1" index="-1" /&gt;
&lt;avp name="Supported-Features" code="628" vendor="10415" multiplicity="0+" index="-1" /&gt;

&lt;!-- FORBBIDEN --&gt;
&lt;avp name="Auth-Application-Id" code="258" vendor="0" multiplicity="0" index="-1" /&gt;
&lt;avp name="Error-Reporting-Host" code="294" vendor="0" multiplicity="0" index="-1" /&gt;</code></pre>
</div>
</div>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">&lt;command&gt;</dt>
<dd>
<p>Specifies the command for the application.
The element supports the &lt;avp&gt; element, which specifies the structure of the command.
The element supports the following attributes:</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>name
Optional parameter that specifies the message name for descriptive purposes.</p>
</div>
<div class="paragraph">
<p>code
Mandatory parameter that specifies the integer code of the message.</p>
</div>
<div class="paragraph">
<p>request
Mandatory parameter that specifies whether the declared command is a request or answer. The available values are "true" (request) or "false" (answer).</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If the &lt;avp&gt; element is specified in &lt;command&gt;, it does not support any child elements.
The &lt;avp&gt; element only refers to defined AVPs when used in this context.
</td>
</tr>
</table>
</div>
<div class="exampleblock">
<div class="title">Example 8. &lt;command&gt; Elements and Attributes</div>
<div class="content">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">&lt;command name="User-Authorization" code="300" vendor-id="TGPP" request="true"&gt;
	&lt;avp name="Server-Assignment-Type" code="614" mandatory="must" vendor-bit="must" vendor-id="TGPP" may-encrypt="no"/&gt;
&lt;/command&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jdiameter_validator_source_overview"><a class="anchor" href="#_jdiameter_validator_source_overview"></a>2.5.2. Validator Source Overview</h4>
<div class="paragraph">
<p>The Validator	API defines methods to access its database of AVPs and check if the AVP and message have the proper structure.</p>
</div>
<div class="paragraph">
<p>The Validator is currently message oriented.
This means that it declares methods that center on message consistency checks.
The class containing all validation logic is <code class="class">org.jdiameter.common.impl.validation.DiameterMessageValidator</code>.
It exposes the following methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">public boolean isOn();</dt>
<dd>
<p>Simple method to determine if the <code>Validator</code> is enabled.</p>
</dd>
<dt class="hdlist1">public ValidatorLevel getSendLevel();</dt>
<dd>
<p>Returns the validation level of outgoing messages.
It can have one of the following values: <code>OFF</code>, <code>MESSAGE</code>, <code>ALL</code>.</p>
</dd>
<dt class="hdlist1">public ValidatorLevel getReceiveLevel()</dt>
<dd>
<p>Returns the validation level of incoming messages.
It can have one of the following values: <code>OFF</code>, <code>MESSAGE</code>, <code>ALL</code>.</p>
</dd>
<dt class="hdlist1">public void validate(Message msg, boolean incoming) throws JAvpNotAllowedException</dt>
<dd>
<p>Performs validation on a message.
Based on the <code class="parameter">incoming</code> flag, the correct validation level is applied.
If validation fails, an exception with details is thrown.</p>
</dd>
<dt class="hdlist1">public void validate(Message msg, ValidatorLevel validatorLevel) throws JAvpNotAllowedException</dt>
<dd>
<p>Performs validation on messages with a specified level.
It is a programatical way to allow different levels of validation from those configured.
If validation fails, a <code class="class">JAvpNotAllowedException</code> with details is thrown.</p>
</dd>
</dl>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
The current implementation provides more methods, however those are out of scope for this documentation.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A simple example of a Validator use case is shown below:</p>
</div>
<div class="exampleblock">
<div class="title">Example 9. Validator Message Check Example</div>
<div class="content">
<div class="paragraph">
<p>The example below is pseudo-code.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">...
boolean isRequest = true;
boolean isIncoming = false;

DiameterMessageValidator messageValidator = DiameterMessageValidator.getInstance();
Message message = createMessage(UserDataRequest.MESSAGE_CODE, isRequest,
	applicationId);

//add AVPs
...
//perform check
try{
	messageValidator.validate(message, isIncoming);
}
catch(JAvpNotAllowedException e) {
	System.err.println("Failed to validate ..., avp code: " + e.getAvpCode() + " avp vendor:" + e.getVendorId() + ", message:" + e.getMessage());
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_mux"><a class="anchor" href="#_mux"></a>3. Multiplexer (MUX)</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Multiplexer (MUX) is designed as a stack wrapper.
It serves two purposes:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Expose Stack</dt>
<dd>
<p>It exposes the stack and allows it to be shared between multiple listeners.
The stack follows the life cycle of the MUX.
It is created and destroyed with MUX.</p>
</dd>
<dt class="hdlist1">Expose Management Operations</dt>
<dd>
<p>Exposes the management operations for  clients, one of them being the &amp;MANAGEMENT.PLATFORM; Console.
For specific information please refer to the Restcomm  Diameter Management Console User Guide.</p>
</dd>
</dl>
</div>
<div class="sect2">
<h3 id="_mux_design"><a class="anchor" href="#_mux_design"></a>3.1. Diameter Multiplexer (MUX) Design</h3>
<div class="paragraph">
<p>MUX is a simple service provided on behalf of the Stack.
Entities interested in receiving messages for certain diameter applications register in MUX.
Upon registration, the entity passes a set of application IDs.
Based on the message content and registered listeners, MUX either drops the message or passes it to the proper listener.
MUX checks application IDs present in the message to match the target listener.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/DIA_2_x_MUX_design.png" alt="DIA 2 x MUX design">
</div>
<div class="title">Figure 7. Diameter Multiplexer (MUX) Design Overview</div>
</div>
</div>
<div class="sect2">
<h3 id="_mux_setup"><a class="anchor" href="#_mux_setup"></a>3.2. Diameter Multiplexer (MUX) Setup</h3>
<div class="sect3">
<h4 id="_mux_preinstall_requirements_and_prerequisites"><a class="anchor" href="#_mux_preinstall_requirements_and_prerequisites"></a>3.2.1. Pre-Install Requirements and Prerequisites</h4>
<div class="paragraph">
<p>Ensure that the following requirements have been met before continuing with the installation process.</p>
</div>
<div class="sect4">
<h5 id="_mux_hardware_requirements"><a class="anchor" href="#_mux_hardware_requirements"></a>Hardware Requirements</h5>
<div class="paragraph">
<p>MUX does not have any hardware requirements.</p>
</div>
</div>
<div class="sect4">
<h5 id="_mux_software_prerequisites"><a class="anchor" href="#_mux_software_prerequisites"></a>Software Prerequisites</h5>
<div class="paragraph">
<p>MUX must be deployed either in {jee-version} v4.x or v5.x.
However it is possible to adapt configuration files and run in any JMX container.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_mux_source_code"><a class="anchor" href="#_mux_source_code"></a>3.2.2. Source Code</h4>
<div class="paragraph">
<p>This section provides instructions on how to obtain and build the Restcomm Diameter MUX from source code.</p>
</div>
<div class="sect4">
<h5 id="_mux_release_source_building"><a class="anchor" href="#_mux_release_source_building"></a>Release Source Code Building</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Downloading the source code</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Subversion is used to manage its source code.
Instructions for using Subversion, including installation, can be found at <a href="http://svnbook.red-bean.com" class="bare">http://svnbook.red-bean.com</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use SVN to checkout a specific release source.
The base URL is <a href="https://github.com/Restcomm/jdiameter" class="bare">https://github.com/Restcomm/jdiameter</a> .
Then add the specific release version, for example 1.7.0-SNAPSHOT .</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[usr]$ git clone git@github.com:RestComm/jdiameter.git</code></pre>
</div>
</div>
</li>
<li>
<p>Building the source code</p>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Maven 3.2.5 (or higher) is used to build the release.
Instructions for using Maven2, including installation, can be found at <a href="http://maven.apache.org" class="bare">http://maven.apache.org</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use Maven to build the deployable unit binary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>						[usr]$ cd -
						[usr]$ mvn install</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once the process finishes you should have the SAR built.
If the <code class="var">JBOSS_HOME</code> environment variable is set, the  will be deployed in the container after execution.</p>
</div>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
By default Restcomm Diameter MUX; deploys in the JBoss Application Server v5.x .
To change it, run <code class="app">maven</code> with the profile switch command: <code class="parameter">-Pjboss4</code>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect4">
<h5 id="_mux_trunk_source_building"><a class="anchor" href="#_mux_trunk_source_building"></a>Development Trunk Source Building</h5>
<div class="paragraph">
<p>Follow the <a href="#_mux_release_source_building">Release Source Code Building</a> procedure, replacing the SVN source code URL with <a href="https://github.com/Restcomm/jdiameter" class="bare">https://github.com/Restcomm/jdiameter</a> .</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mux_configuration"><a class="anchor" href="#_mux_configuration"></a>3.3. Diameter Multiplexer (MUX) Configuration</h3>
<div class="paragraph">
<p>MUX requires three configuration files:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><em class="path">jboss-service.xml</em></dt>
<dd>
<p>This file is specific to SAR.
Please refer to the <code class="app">` manual for explanation.
The file binds Diameter MUX under the following JMX object name by default: `diameter.mobicents:service=DiameterStackMultiplexer</code>.</p>
</dd>
<dt class="hdlist1"><em class="path">jdiameter-config.xml</em></dt>
<dd>
<p>This file configures the stack exposed by MUX.
Please refer to <a href="#_jdiameter_configuration">Diameter Stack Configuration</a> for details.
It is located in <em class="path">mobicents-diameter-mux-.sar/config</em>.</p>
</dd>
<dt class="hdlist1"><em class="path">dictionary.xml</em></dt>
<dd>
<p>This file configures the dictionary.
Its structure and content is identical to the file described in <a href="#_jdiameter_validator_configuration">Validator Configuration</a>.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_mux_source_overview"><a class="anchor" href="#_mux_source_overview"></a>3.4. Diameter MUX Source Overview</h3>
<div class="paragraph">
<p>The Diameter MUX capabilities are defined by the <code>MBean</code> interface <code>org.mobicents.diameter.stack.DiameterStackMultiplexerMBean</code>.
This interface defines two types of methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Management</dt>
<dd>
<p>Used by RHQ console.
These methods are outside the scope of this documentation.</p>
</dd>
<dt class="hdlist1">Stack Accessors</dt>
<dd>
<p>Methods that allow the user to retrieve and use a wrapped stack.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The methods below are of interest to a Diameter MUX user:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code class="method">public Stack getStack();</code></dt>
<dd>
<p>Returns a stack wrapped by the multiplexer.
It is present as a convenience method, and the stack should only be changed directly by expert users.</p>
</dd>
<dt class="hdlist1"><code class="method">public void registerListener(DiameterListener listener, ApplicationId[] appIds) throws IllegalStateException;</code></dt>
<dd>
<p>Registers a listener to be triggered when a message for a certain application ID is received.</p>
</dd>
<dt class="hdlist1"><code class="method">public void unregisterListener(DiameterListener listener);</code></dt>
<dd>
<p>Removes the message listener.</p>
</dd>
<dt class="hdlist1"><code class="method">public DiameterStackMultiplexerMBean getMultiplexerMBean();</code></dt>
<dd>
<p>Returns the actual instance of MUX.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The listener interface is defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.mobicents.diameter.stack;

import java.io.Serializable;

import org.jdiameter.api.Answer;
import org.jdiameter.api.EventListener;
import org.jdiameter.api.NetworkReqListener;
import org.jdiameter.api.Request;

public interface DiameterListener extends NetworkReqListener, Serializable,
	EventListener&lt;Request, Answer&gt;
{

}</code></pre>
</div>
</div>
<div class="paragraph">
<p>MUX can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class DiameterActor implements DiameterListener
{
	private ObjectName diameterMultiplexerObjectName = null;
	private DiameterStackMultiplexerMBean diameterMux = null;

	private synchronized void initStack() throws Exception {
		this.diameterMultiplexerObjectName =
			new ObjectName("diameter.mobicents:service=DiameterStackMultiplexer");

		Object[] params = new Object[]{};
		String[] signature = new String[]{};

		String operation = "getMultiplexerMBean";
		this.diameterMux=mbeanServer.invoke(this.diameterMultiplexerObjectName, operation,
			params, signature);

		long acctAppIds = new long[]{19312L};
		long acctVendorIds = new long[]{193L};
		long authAppIds = new long[]{4L};
		long authVendorIds = new long[]{0L};
		List&lt;ApplicationId&gt; appIds = new ArrayList&lt;ApplicationId&gt;();
		for(int index = 0;index&lt;acctAppIds.length;index++) {
			appIds.add(ApplicationId.createByAccAppId(acctVendorIds[index], acctAppIds[index]));
		}

		for(int index = 0;index&lt;authAppIds.length;index++) {
			appIds.add(ApplicationId.createByAuthAppId(authVendorIds[index], authAppIds[index]));
		}

		this.diameterMux.registerListener(this, appIds.toArray(new ApplicationId[appIds.size()]));
		this.stack = this.diameterMux.getStack();
		this.messageTimeout = stack.getMetaData().getConfiguration().getLongValue(
			MessageTimeOut.ordinal(), (Long) MessageTimeOut.defValue());
	}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mux_dictionary"><a class="anchor" href="#_mux_dictionary"></a>3.5. Diameter Multiplexer (MUX) Dictionary</h3>
<div class="paragraph">
<p>The Dictionary is part of the MUX package.
Its purpose is to provide unified access to information regarding AVP structure, content and definition.
It is configured with an XML file: <em class="path">dictionary.xml</em>.</p>
</div>
<div class="paragraph">
<p>Dictionary logic is contained in the <code>org.mobicents.diameter.dictionary.AvpDictionary</code> class.
It exposes the following methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code class="method">public AvpRepresentation getAvp(int code)</code></dt>
<dd>
<p>Return an <code class="class">AvpRepresentation</code> object representing the AVP with the given code (assuming vendor ID as 0 (zero)). If there is no AVP defined, it returns <code>null</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public AvpRepresentation getAvp(int code, long vendorId)</code></dt>
<dd>
<p>Returns an <code class="class">AvpRepresentation</code> object representing the AVP with the given code and vendor ID.
If there is no AVP defined, it returns <code>null</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public AvpRepresentation getAvp(String avpName)</code></dt>
<dd>
<p>Returns an <code class="class">AvpRepresentation</code> object representing the AVP with the given name.
If there is no AVP defined, it returns <code>null</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Dictionary uses a POJO class to provide access to stored information: <code>org.mobicents.diameter.dictionary.AvpRepresentation</code>.
It exposes the following methods:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code class="method">public int getCode()</code></dt>
<dd>
<p>Returns the code assigned to the represented AVP.</p>
</dd>
<dt class="hdlist1"><code class="method">public long getVendorId()</code></dt>
<dd>
<p>Returns the vendor ID assigned to the represented AVP.</p>
</dd>
<dt class="hdlist1"><code class="method">public String getName()</code></dt>
<dd>
<p>Returns name assigned to the represented AVP.
If no name is defined, it returns <code>null</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public boolean isGrouped()</code></dt>
<dd>
<p>Returns <code>true</code> if the AVP is of grouped type.</p>
</dd>
<dt class="hdlist1"><code class="method">public String getType()</code></dt>
<dd>
<p>Returns a <code class="type">String</code> with the name of the represented AVP type.
Return value is equal to one of defined types.
For example, <code class="type">OctetString</code> or <code class="type">Unsiged32</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public boolean isMayEncrypt()</code></dt>
<dd>
<p>Returns <code>true</code> if the AVP can be encrypted.</p>
</dd>
<dt class="hdlist1"><code class="method">public boolean isProtected()</code></dt>
<dd>
<p>Returns <code>true</code> if the AVP <em>must</em> be encrypted.
This occurs if <code class="method">public String getRuleProtected()</code> returns <code>must</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public boolean isMandatory()</code></dt>
<dd>
<p>Returns <code>true</code> if the AVP must be supported by an agent to properly consume the message.
It only returns <code>true</code> if <code class="method">public String getRuleMandatory()</code> returns <code>must</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public String getRuleMandatory()</code></dt>
<dd>
<p>Returns the mandatory rule value.
It can return one of the following values: <code>may</code>, <code>must</code> or <code>mustnot</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public String getRuleProtected()</code></dt>
<dd>
<p>Returns the protected rule value.
It can have one of the following values: <code>may</code>, <code>must</code> or <code>mustnot</code>.</p>
</dd>
<dt class="hdlist1"><code class="method">public String getRuleVendorBit()</code></dt>
<dd>
<p>Returns the vendor rule value.
It can have one of the following values: <code>must</code> or <code>mustnot</code>.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Diameter MUX Dictionary can be used as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public static void addAvp(Message msg, int avpCode, long vendorId, AvpSet set, Object avp) {
	AvpRepresentation avpRep = AvpDictionary.INSTANCE.getAvp(avpCode, vendorId);

	if(avpRep != null) {
		DiameterAvpType avpType = DiameterAvpType.fromString(avpRep.getType());

		boolean isMandatoryAvp = avpRep.isMandatory();
		boolean isProtectedAvp = avpRep.isProtected();

		if(avp instanceof byte[]) {
			setAvpAsRaw(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp, (byte[]) avp);
		}
		else
		{
			switch (avpType.getType()) {
			case DiameterAvpType._ADDRESS:
			case DiameterAvpType._DIAMETER_IDENTITY:
			case DiameterAvpType._DIAMETER_URI:
			case DiameterAvpType._IP_FILTER_RULE:
			case DiameterAvpType._OCTET_STRING:
			case DiameterAvpType._QOS_FILTER_RULE:
				setAvpAsOctetString(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					avp.toString());
				break;

			case DiameterAvpType._ENUMERATED:
			case DiameterAvpType._INTEGER_32:
				setAvpAsInteger32(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(Integer) avp);
				break;

			case DiameterAvpType._FLOAT_32:
				setAvpAsFloat32(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(Float) avp);
				break;

			case DiameterAvpType._FLOAT_64:
				setAvpAsFloat64(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(Float) avp);
				break;

			case DiameterAvpType._GROUPED:
				setAvpAsGrouped(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(DiameterAvp[]) avp);
				break;

			case DiameterAvpType._INTEGER_64:
				setAvpAsInteger64(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(Long) avp);
				break;

			case DiameterAvpType._TIME:
				setAvpAsTime(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(Date) avp);
				break;

			case DiameterAvpType._UNSIGNED_32:
				setAvpAsUnsigned32(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(Long) avp);
				break;

			case DiameterAvpType._UNSIGNED_64:
				setAvpAsUnsigned64(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(Long) avp);
				break;

			case DiameterAvpType._UTF8_STRING:
				setAvpAsUTF8String(msg, avpCode, vendorId, set, isMandatoryAvp, isProtectedAvp,
					(String) avp);
				break;
			}
		}
	}
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="revision-history"><a class="anchor" href="#revision-history"></a>Appendix A: Revision History</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-04-16 08:45:49 WEST
</div>
</div>
</body>
</html>
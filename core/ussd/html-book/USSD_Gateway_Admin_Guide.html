<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.4">
<title>User Guide to Restcomm USSD GATEWAY</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove comment around @import statement below when using as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
body{-webkit-font-smoothing:antialiased}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.spread{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
body{tab-size:4}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}
@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}
@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}
.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0;line-height:1.45}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;text-indent:-1.05em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">
</head>
<body class="book">
<div id="header">
<h1>User Guide to Restcomm USSD GATEWAY</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#preface">Preface</a></li>
<li><a href="#document-conventions">Document Conventions</a>
<ul class="sectlevel2">
<li><a href="#typographic-conventions">Typographic Conventions</a></li>
<li><a href="#pull-quote-conventions">Pull-quote Conventions</a></li>
<li><a href="#notes-and-warnings">Notes and Warnings</a></li>
</ul>
</li>
<li><a href="#provide-feedback-to-the-authors">Provide feedback to the authors!</a></li>
<li><a href="#_introduction">1. Introduction to Restcomm USSD GATEWAY</a></li>
<li><a href="#overview">2. Overview</a>
<ul class="sectlevel2">
<li><a href="#_ussd_overview">2.1. USSD</a></li>
<li><a href="#ussd-session">2.2. USSD Session</a></li>
<li><a href="#_ussd_shortcode">2.3. USSD Service number</a></li>
<li><a href="#map-message-flow">2.4. MAP Message Flow</a></li>
<li><a href="#_ussd_gateway_desc">2.5. USSD Gateway</a></li>
<li><a href="#_mobicents_ussd_overview">2.6. Restcomm USSD GATEWAY</a></li>
</ul>
</li>
<li><a href="#_design_overview">3. Architecture</a></li>
<li><a href="#_multi_tenancy">4. Multi-tenancy support</a></li>
<li><a href="#running">5. Running</a>
<ul class="sectlevel2">
<li><a href="#running-the-gateway">5.1. Running the Gateway</a></li>
<li><a href="#_running_the_gateway_simulator">5.2. Running the Gateway - Simulator Profile</a></li>
<li><a href="#_running_shell">5.3. Running the Shell</a></li>
<li><a href="#_using_gui">5.4. Running the Graphical User Interface</a></li>
</ul>
</li>
<li><a href="#configuring">6. Configuring</a>
<ul class="sectlevel2">
<li><a href="#memory-settings">6.1. Memory Settings</a></li>
<li><a href="#cdr-logging-settings">6.2. CDR Logging Settings</a></li>
<li><a href="#_http_client_ra">6.3. Configuring JSLEE http-client RA</a></li>
<li><a href="#_logging">6.4. Configuring log4j Logging Service</a></li>
<li><a href="#_configuring_ss7">6.5. Configuring the SS7 Stack</a></li>
<li><a href="#_configuring_ussd_gw">6.6. Configuring the USSD Gateway</a></li>
<li><a href="#_configuring_ussd_simulator_profile">6.7. Simulator Profile</a></li>
</ul>
</li>
<li><a href="#_http_architecture">7. HTTP Transfer Mechanism</a>
<ul class="sectlevel2">
<li><a href="#http_messages_ussd_pull">7.1. HTTP Message Structure - USSD Pull</a></li>
<li><a href="#_http_messages_ussd_push">7.2. HTTP Message Structure - USSD Push</a></li>
<li><a href="#http-payload">7.3. HTTP Payload</a></li>
</ul>
</li>
<li><a href="#_sip_architecture">8. SIP Transfer Mechanism</a>
<ul class="sectlevel2">
<li><a href="#_sip_messages_ussd_pull">8.1. SIP Message Structure - USSD Pull</a></li>
<li><a href="#_sip_messages_ussd_pull_notree">8.2. SIP Message Structure - USSD Pull - Without Tree Menu</a></li>
<li><a href="#_sip_messages_ussd_push_case3">8.3. SIP Message Structure - USSD Push - With Tree Menu</a></li>
<li><a href="#_sip_messages_ussd_push_case4">8.4. SIP Message Structure - USSD Push - Without Tree Menu</a></li>
</ul>
</li>
<li><a href="#_xml_parser">9. XML Parser API</a>
<ul class="sectlevel2">
<li><a href="#_mvn_dependency">9.1. Maven dependency</a></li>
<li><a href="#_simple_tree_based_example">9.2. Simple example - Tree based Menu</a></li>
<li><a href="#eventsserializefactory">9.3. EventsSerializeFactory</a></li>
<li><a href="#dialog">9.4. Dialog</a></li>
</ul>
</li>
<li><a href="#_logging_traces_and_alarms">10. Monitoring</a>
<ul class="sectlevel2">
<li><a href="#tracers">10.1. Tracers</a></li>
<li><a href="#statistics">10.2. Statistics</a></li>
</ul>
</li>
<li><a href="#_configuring_mysql">Appendix A: Configuring MySQL as datasource</a></li>
<li><a href="#revision-history">Appendix B: Revision History</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="preface"><a class="anchor" href="#preface"></a>Preface</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="document-conventions"><a class="anchor" href="#document-conventions"></a>Document Conventions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This manual uses several conventions to highlight certain words and phrases and draw attention to specific pieces of information.</p>
</div>
<div class="paragraph">
<p>In PDF and paper editions, this manual uses typefaces drawn from the <a href="https://fedorahosted.org/liberation-fonts/">Liberation Fonts</a> set.
The Liberation Fonts set is also used in HTML editions if the set is installed on your system.
If not, alternative but equivalent typefaces are displayed.
Note: Red Hat Enterprise Linux 5 and later includes the Liberation Fonts set by default.</p>
</div>
<div class="sect2">
<h3 id="typographic-conventions"><a class="anchor" href="#typographic-conventions"></a>Typographic Conventions</h3>
<div class="paragraph">
<p>Four typographic conventions are used to call attention to specific words and phrases.
These conventions, and the circumstances they apply to, are as follows.</p>
</div>
<div class="paragraph">
<p><code>Mono-spaced Bold</code></p>
</div>
<div class="paragraph">
<p>Used to highlight system input, including shell commands, file names and paths.
Also used to highlight key caps and key-combinations.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
To see the contents of the file <em class="path">my_next_bestselling_novel</em> in your current working directory, enter the <code>cat my_next_bestselling_novel</code> command at the shell prompt and press <kbd>Enter</kbd> to execute the command.
</blockquote>
</div>
<div class="paragraph">
<p>The above includes a file name, a shell command and a key cap, all presented in Mono-spaced Bold and all distinguishable thanks to context.</p>
</div>
<div class="paragraph">
<p>Key-combinations can be distinguished from key caps by the hyphen connecting each part of a key-combination.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Press <kbd>Enter</kbd> to execute the command.</p>
</div>
<div class="paragraph">
<p>Press  to switch to the first virtual terminal.
Press  to return to your X-Windows session.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The first sentence highlights the particular key cap to press.
The second highlights two sets of three key caps, each set pressed simultaneously.</p>
</div>
<div class="paragraph">
<p>If source code is discussed, class names, methods, functions, variable names and returned values mentioned within a paragraph will be presented as above, in <code>Mono-spaced Bold</code>.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
File-related classes include <code class="class">filesystem</code> for file systems, <code class="class">file</code> for files, and <code class="class">dir</code> for directories.
Each class has its own associated set of permissions.
</blockquote>
</div>
<div class="paragraph">
<p><code class="app">Proportional Bold</code></p>
</div>
<div class="paragraph">
<p>This denotes words or phrases encountered on a system, including application names; dialogue box text; labelled buttons; check-box and radio button labels; menu titles and sub-menu titles.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Choose <span class="menu">System &gt; Preferences &gt; Mouse</span> from the main menu bar to launch <code class="app">Mouse Preferences</code>.
In the <span class="label">Buttons</span> tab, click the <span class="label">Left-handed mouse</span> check box and click <b class="button">Close</b> to switch the primary mouse button from the left to the right (making the mouse suitable for use in the left hand).</p>
</div>
<div class="paragraph">
<p>To insert a special character into a <code class="app">gedit</code> file, choose <span class="menu">Applications &gt; Accessories &gt; Character Map</span> from the main menu bar.
Next, choose <span class="menu">Search &gt; Find</span> from the <code class="app">Character Map</code> menu bar, type the name of the character in the <span class="label">Search</span> field and click <b class="button">Next</b>.
The character you sought will be highlighted in the <span class="label">Character Table</span>.
Double-click this highlighted character to place it in the <span class="label">Text to copy</span> field and then click the <b class="button">Copy</b> button.
Now switch back to your document and choose <span class="menu">Edit &gt; Paste</span> from the <code class="app">gedit</code> menu bar.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>The above text includes application names; system-wide menu names and items; application-specific menu names; and buttons and text found within a GUI interface, all presented in Proportional Bold and all distinguishable by context.</p>
</div>
<div class="paragraph">
<p>Note the menu:&gt;[] shorthand used to indicate traversal through a menu and its sub-menus.
This is to avoid the difficult-to-follow 'Select  from the <span class="menuseq"><span class="menu">Preferences</span>&#160;&#9656; <span class="menuitem">] sub-menu in the menu:System[</span></span> menu of the main menu bar' approach.</p>
</div>
<div class="paragraph">
<p><code>Mono-spaced Bold Italic</code> or <code class="app">Proportional Bold Italic</code></p>
</div>
<div class="paragraph">
<p>Whether Mono-spaced Bold or Proportional Bold, the addition of Italics indicates replaceable or variable text.
Italics denotes text you do not input literally or displayed text that changes depending on circumstance.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>To connect to a remote machine using ssh, type <code>ssh <a href="mailto:username@domain.name">username@domain.name</a></code> at a shell prompt.
If the remote machine is <em class="path">example.com</em> and your username on that machine is john, type <code>ssh <a href="mailto:john@example.com">john@example.com</a></code>.</p>
</div>
<div class="paragraph">
<p>The <code>mount -o remount file-system</code> command remounts the named file system.
For example, to remount the <em class="path">/home</em> file system, the command is <code>mount -o remount /home</code>.</p>
</div>
<div class="paragraph">
<p>To see the version of a currently installed package, use the <code>rpm -q package</code> command.
It will return a result as follows: <code>package-version-release</code>.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>Note the words in bold italics above &mdash;username, domain.name, file-system, package, version and release.
Each word is a placeholder, either for text you enter when issuing a command or for text displayed by the system.</p>
</div>
<div class="paragraph">
<p>Aside from standard usage for presenting the title of a work, italics denotes the first use of a new and important term.
For example:</p>
</div>
<div class="quoteblock">
<blockquote>
When the Apache HTTP Server accepts requests, it dispatches child processes or threads to handle them.
This group of child processes or threads is known as a <em class="term">server-pool</em>.
Under Apache HTTP Server 2.0, the responsibility for creating and maintaining these server-pools has been abstracted to a group of modules called <em class="term">Multi-Processing Modules</em> (<em class="term">MPMs</em>). Unlike other modules, only one module from the MPM group can be loaded by the Apache HTTP Server.
</blockquote>
</div>
</div>
<div class="sect2">
<h3 id="pull-quote-conventions"><a class="anchor" href="#pull-quote-conventions"></a>Pull-quote Conventions</h3>
<div class="paragraph">
<p>Two, commonly multi-line, data types are set off visually from the surrounding text.</p>
</div>
<div class="paragraph">
<p>Output sent to a terminal is set in <code>Mono-spaced Roman</code> and presented thus:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>books        Desktop   documentation  drafts  mss    photos   stuff  svn
books_tests  Desktop1  downloads      images  notes  scripts  svgs</pre>
</div>
</div>
<div class="paragraph">
<p>Source-code listings are also set in <code>Mono-spaced Roman</code> but are presented and highlighted as follows:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">package org.jboss.book.jca.ex1;

import javax.naming.InitialContext;

public class ExClient
{
   public static void main(String args[])
       throws Exception
   {
      InitialContext iniCtx = new InitialContext();
      Object         ref    = iniCtx.lookup("EchoBean");
      EchoHome       home   = (EchoHome) ref;
      Echo           echo   = home.create();

      System.out.println("Created Echo");

      System.out.println("Echo.echo('Hello') = " + echo.echo("Hello"));
   }

}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="notes-and-warnings"><a class="anchor" href="#notes-and-warnings"></a>Notes and Warnings</h3>
<div class="paragraph">
<p>Finally, we use three visual styles to draw attention to information that might otherwise be overlooked.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>A note is a tip or shortcut or alternative approach to the task at hand.
Ignoring a note should have no negative consequences, but you might miss out on a trick that makes your life easier.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Important</div>
<div class="paragraph">
<p>Important boxes detail things that are easily missed: configuration changes that only apply to the current session, or services that need restarting before an update will apply.
Ignoring Important boxes won&#8217;t cause data loss but may cause irritation and frustration.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="title">Warning</div>
<div class="paragraph">
<p>A Warning should not be ignored.
Ignoring warnings will most likely cause data loss.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="provide-feedback-to-the-authors"><a class="anchor" href="#provide-feedback-to-the-authors"></a>Provide feedback to the authors!</h2>
<div class="sectionbody">
<div class="paragraph">
<p></p>
</div>
<div class="paragraph">
<p>If you find a typographical error in this manual, or if you have thought of a way to make this manual better, we would love to hear from you! Please submit a report in the the {this-issue.tracker.ur}, against the product Restcomm USSD GATEWAY`   `, or contact the authors.</p>
</div>
<div class="paragraph">
<p>When submitting a bug report, be sure to mention the manual&#8217;s identifier: Restcomm USSD GATEWAY</p>
</div>
<div class="paragraph">
<p>If you have a suggestion for improving the documentation, try to be as specific as possible when describing it.
If you have found an error, please include the section number and some of the surrounding text so we can find it easily.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction"><a class="anchor" href="#_introduction"></a>1. Introduction to Restcomm USSD GATEWAY</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Restcomm USSD GATEWAY is an Open Source Java based USSD Gateway Platform that routes USSD messages from the signaling network to service applications and the other way around.
It enables operators to offer real-time interactions to mobile subscribers and deliver interactive content to their mobile phones. Restcomm USSD GATEWAY strictly adheres to the standards and specifications defined by the International Telecommunications Union (ITU).</p>
</div>
<div class="paragraph">
<p>Restcomm USSD GATEWAY acts as an intermediary platform linking the service applications to the GSM network in a session oriented communication. The platform is easy-to-install and easy-to-deploy allowing you to have the Gateway set up and configured very quickly.</p>
</div>
<div class="paragraph">
<p>Restcomm USSD GATEWAY comes with an efficient Command Line Interface (CLI) tool allowing you to completely configure the Gateway at run-time and manage it using simple commands rather than do everything manually. Restcomm USSD GATEWAY also comes with a Graphical User Interface (GUI) that will allow you to configure, monitor and manage the Gateway through a convenient user-friendly interface.</p>
</div>
<div class="paragraph">
<p>The Open Source Software gives you the flexibility to understand the readily available source code and the freedom to customise the product to meet your Enterprise needs.</p>
</div>
<div class="paragraph">
<p>This guide provides details on configuring and using the platform and information regarding the supported protocols and compliant standards.
For installation instructions, please refer to the Installation Guide published along with this.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="overview"><a class="anchor" href="#overview"></a>2. Overview</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ussd_overview"><a class="anchor" href="#_ussd_overview"></a>2.1. USSD</h3>
<div class="paragraph">
<p>USSD stands for Unstructured Supplementary Services Data which is a protocol used by GSM mobile phones much like the Short Message Service (SMS) but used to communicate with the service provider&#8217;s  applications/services.
USSD is used by the service provider to offer the subscriber with operator services like prepaid callback service, location-based content services, menu-based information services,  mobile-money services and similar interactive services.</p>
</div>
<div class="paragraph">
<p>There is a difference between USSD and SMS handling.
Unlike SMS, which makes use of a <code>store and forward</code> method of message delivery,  USSD messages establish a real-time connection during a USSD session.
In the case of SMS, Short Message is first delivered to the sender&#8217;s Short Message Service Center (SMSc)  which then attempts to deliver the message to the intended recipient (s). So SMS does not guarantee that the message will be delivered instantly.</p>
</div>
</div>
<div class="sect2">
<h3 id="ussd-session"><a class="anchor" href="#ussd-session"></a>2.2. USSD Session</h3>
<div class="paragraph">
<p>USSD establishes a real time session between the mobile handset and the application handling the service and the information from the mobile handset is sent directly to the service.
The concept of a real time session is very useful for constructing an interactive menu driven application.
Refer to the figure below depicting the working of a real time session.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ussd-arch.png" alt="ussd arch">
</div>
</div>
<div class="paragraph">
<p>A user dialing an USSD service number (short code) initiates a dialog with the USSD handling application deployed on the Restcomm Platform as shown in the above figure.
The "Network Node" in the figure could be a MSC, HLR or VLR.
The Restcomm Platform integrates with the "Network Node" using the MAP protocol.</p>
</div>
</div>
<div class="sect2">
<h3 id="_ussd_shortcode"><a class="anchor" href="#_ussd_shortcode"></a>2.3. USSD Service number</h3>
<div class="paragraph">
<p>Short codes are special numbers (shorter than normal phone numbers) often associated with automated services and are unique to each operator.
A detailed description of the allowed MMIs (or short codes) which the user can dial is specified in <code>3GPP TS 22.090</code>.
In the user&#8217;s home network the following number range is defined for USSD services:
<strong>1, 2 or 3 digits from the set (</strong>\* <strong>, #) followed by 1X(Y), where X=any number 0-4, Y=any number 0-9, then, optionally "</strong>\* <strong>" followed by any number of any characters, and concluding with # SEND</strong></p>
</div>
<div class="paragraph">
<p>For example a user may dial *<mark>122</mark> to reach a specific USSD service which is deployed in the home network.
The application in its order may reply with a menu based on the dialed short code.
One of the biggest benefits is that this service is always available even when the user is roaming.</p>
</div>
</div>
<div class="sect2">
<h3 id="map-message-flow"><a class="anchor" href="#map-message-flow"></a>2.4. MAP Message Flow</h3>
<div class="paragraph">
<p>The diagram below depicts a typical MAP message flow for data transfer between the "Network Node" and the Restcomm platform to implement a menu driven application.
If you would like to read more about mobile-intiated (and network-initated) USSD operations and the use of MAP USSD services, please refer to [3GPPTS 24.090] in the references section.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ussd-map.png" alt="ussd map">
</div>
</div>
<div class="paragraph">
<p>Mobile initiated USSD service begins when the user dials a USSD string (*<mark>122</mark> in this example). The message flow involves the following steps:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Network sends a 'TCAP Begin' message with the Component 'MAP_PROCESS_UNSTRUCTURED_SS_REQUEST' to the Restcomm platform.
The Restcomm platform invokes USSD application logic.</p>
</li>
<li>
<p>The Application requests additional information from the user (action one or action two) via 'MAP_UNSTRUCTURED_SS_REQUEST' encapsulated in a 'TCAP Continue' message.
The 'TCAP Dialogue' starts now.</p>
</li>
<li>
<p>The Application receives the user&#8217;s selection of the action.</p>
</li>
<li>
<p>Based on the user&#8217;s menu selection, the application performs the predefined logic associated with the selection and sends a response back to the user.
This time the application does not require additional information from the user and it sends a response using the component 'MAP_PROCESS_UNSTRUCTURED_SS_REQUEST' and terminates the 'TCAP dialogue'.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_ussd_gateway_desc"><a class="anchor" href="#_ussd_gateway_desc"></a>2.5. USSD Gateway</h3>
<div class="paragraph">
<p>Existing MSC, VLR, and HLR network elements are proprietary and run on non-standard operating environments located in trusted operator&#8217;s zones that make it difficult to build and deploy new applications.
Also, these network elements do not provide the tools and interfaces needed to access and retrieve data from content providers over the Internet.
The USSD Gateway connects to the MSC, VLR, or HLR and enables the flow of USSD messages to be extended to an open, standards-based application server located in the IP network.
The AS also provides the tools and interfaces to enable access to the content providers through the Internet.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mobicents_ussd_overview"><a class="anchor" href="#_mobicents_ussd_overview"></a>2.6. Restcomm USSD GATEWAY</h3>
<div class="sect3">
<h4 id="_mobicents_ussd_overview_features"><a class="anchor" href="#_mobicents_ussd_overview_features"></a>2.6.1. Major Features</h4>
<div class="paragraph">
<p>Restcomm 's implementation of USSD Gateway is the first and only open source USSD Gateway with a host of rich features and advantages.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Java-based</dt>
<dd>
<p>Restcomm USSD GATEWAY is the only Java based USSD Gateway.
It is robust and reliable and can be installed on any Operating System that supports Java (JDK 7 and SCTP).</p>
</dd>
<dt class="hdlist1">Open Source</dt>
<dd>
<p>The Software is open-source, giving you the freedom to understand the code and customise it to your enterprise needs.
It is supported by a vibrant Open source community.</p>
</dd>
<dt class="hdlist1">Carrier Grade Performance</dt>
<dd>
<p>Restcomm USSD GATEWAY has been deployed at telecom operators around the world and is processing billions of USSD transactions each day.
A single Mobicents USSD node can process 1000&#8217;s of USSD/sec and can be adapted to the needs of telecom service providers of different sizes in any country reducing your CAPEX and OPEX costs.</p>
</dd>
<dt class="hdlist1">Load Balancing and Transparent Failover</dt>
<dd>
<p>Multiple Restcomm USSD GATEWAY nodes can be arranged in a cluster across one or more geographically distributed data centers to scale up throughput and provide various levels of redundancy, high availability and fault tolerance.</p>
</dd>
<dt class="hdlist1">Cloud Ready</dt>
<dd>
<p>Restcomm USSD GATEWAY is Cloud-ready.
It can be deployed on dedicated hardware, private cloud infrastructure or public IaaS such as AWS.</p>
</dd>
<dt class="hdlist1">Network Push</dt>
<dd>
<p>Restcomm USSD GATEWAY supports network/application/service initiated USSD request.
The request can be just Notification or menu based interaction (dialog).</p>
</dd>
<dt class="hdlist1">Multilingual</dt>
<dd>
<p>Restcomm USSD GATEWAY supports UCS2 encoding in addition to GSM 7 Bit.
Application can send/receive the request/response in UCS2 format and process at runtime.</p>
</dd>
<dt class="hdlist1">SS7 Hardware Cards</dt>
<dd>
<p>Restcomm USSD GATEWAY can be used with Intel family boards (Dialogic SS7 cards) or Zaptel/Dahdi compatible TDM devices (Digium, Sangoma).  For production its recommended to use Dialogic boards only.</p>
</dd>
<dt class="hdlist1">SIGTRAN (M3UA)</dt>
<dd>
<p>It also has in-built support for SIGTRAN (M3UA using SCTP).</p>
</dd>
<dt class="hdlist1">HTTP interface</dt>
<dd>
<p>HTTP interface is a commont interface that can be used for connection with service applications.</p>
</dd>
<dt class="hdlist1">SIP interface</dt>
<dd>
<p>SIP interface is another interface that can be used for connection with service applications (following 24.390 specification: "Unstructured Supplementary Service Data (USSD) using IP Multimedia (IM) Core Network (CN) subsystem IMS"). This interface is used for interconnecting with Restcomm.</p>
</dd>
<dt class="hdlist1">Easy Configuration and Management</dt>
<dd>
<p>Restcomm USSD GATEWAY comes with an efficient Command Line Interface (CLI) tool allowing you to completely configure the  Gateway at run-time and manage it using simple commands rather than do everything manually.
 Restcomm USSD GATEWAY also comes with a Graphical User Interface that will allow you to configure, monitor and manage the Gateway through a convenient user-friendly interface.</p>
<div class="ulist">
<ul>
<li>
<p>Restcomm USSD GATEWAY is easily scalable with a configurable load-balancing and high available architecture.</p>
</li>
<li>
<p>Restcomm USSD GATEWAY generates the CDR for every transaction, including the response of users to the menu provided.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">Multi Tenancy</dt>
<dd>
<p>Same instance of USSD Gateway can be connected to multiple different network each with its own origination or/and remote point codes and global titles.</p>
</dd>
<dt class="hdlist1">CDR</dt>
<dd>
<p>Generates CDR in database or plain text file as CSV.</p>
</dd>
<dt class="hdlist1">Audit</dt>
<dd>
<p>Provides mechanism to record every action of user configuring USSD for latter audit.</p>
</dd>
<dt class="hdlist1">Logging</dt>
<dd>
<p>Provides very powerful logging which can be configured at runtime to log only ERROR&#8217;s/WARNING for Production or DEBUG when trying to identify problems.</p>
</dd>
<dt class="hdlist1">Statistics</dt>
<dd>
<p>Provides in details statistics of number of requests/response per second, number of Dialog created successfully or failed.
If failed reason for failure etc.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_mobicents_ussd_overview_tech_spec"><a class="anchor" href="#_mobicents_ussd_overview_tech_spec"></a>2.6.2. Technical Specifications</h4>
<div class="paragraph">
<p>Restcomm USSD GATEWAY is not restricted by Transaction Per Second model.
The only restricting factor is memory + CPU capacity of the host servers, third-party applications or the underlying database service.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Restcomm USSD GATEWAY supports as many as 1073741823 incoming and 1073741823 outgoing concurrent sessions/dialogs.</p>
</li>
<li>
<p>Restcomm USSD GATEWAY supports unlimited E1 links and the only limiting factor is the underlying TDM board used.</p>
</li>
<li>
<p>Restcomm USSD GATEWAY SCTP supports as many associations as supported by the underlying Operating System.
Can be setup in multihome.</p>
</li>
<li>
<p>Restcomm USSD GATEWAY M3UA can be confgured to have as many ASP&#8217;s / IPSP&#8217;s as needed by the system.</p>
</li>
<li>
<p>Restcomm USSD GATEWAY SCCP can be confgured to have virtually unlimited Global Title Translation rules and also supports wild characters for partial matching of Global Title digits.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mobicents_ussd_overview_http"><a class="anchor" href="#_mobicents_ussd_overview_http"></a>2.6.3. HTTP Transfer Mechanism</h4>
<div class="paragraph">
<p>The Restcomm USSD Gateway makes use of HTTP protocol between the gateway and the third-party applications (or Value Added Service Modules). Restcomm USSD Gateway receives the USSD request from the subscriber&#8217;s handset/device via the GSM Signaling network and then translates these requests to HTTP depending on the rules configured in the Gateway to route to a corresponding Value Added Service (VAS) or third-party application. The HTTP callback mechanism allows the third-party Application to be agnostic to Operating System, Programming Language and Framework.
The third-party Application can be either of the following technologies on any Operating System:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Tomcat, JBoss AS, Oracle Application Server, IBM Websphere etc for JSP/Servlet on Java</p>
</li>
<li>
<p>PHP</p>
</li>
<li>
<p>Microsoft IIS for ASP</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_mobicents_ussd_overview_sip"><a class="anchor" href="#_mobicents_ussd_overview_sip"></a>2.6.4. SIP Transfer Mechanism</h4>
<div class="paragraph">
<p>The Restcomm USSD Gateway makes use of SIP protocol between the gateway and the third-party applications (or Value Added Service Modules). 24.390 specification "Unstructured Supplementary Service Data (USSD) using IP Multimedia (IM) Core Network (CN) subsystem IMS" is implemented.
SIP interface can be used for interconnection with Mobicents Restcomm application.</p>
</div>
<div class="paragraph">
<p>Restcomm USSD Gateway receives the USSD request from the subscriber&#8217;s handset/device via the GSM Signaling network and then translates these requests to SIP depending on the rules  configured in the Gateway to route to a corresponding SIP Phone or third-party application.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_design_overview"><a class="anchor" href="#_design_overview"></a>3. Architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Restcomm  USSD GATEWAY is based on robust and proven Restcomm  JAIN SLEE 1.1 Server and Restcomm  jSS7 Stack.</p>
</div>
<div class="paragraph">
<p>Restcomm  JAIN SLEE Server is a highly scalable event-driven application server with a robust component model and fault tolerant execution environment.
It provides a set of connectors to a variety of networks elements: SS7 MAP, TCAP, INAP, ISUP, SMPP, XMPP, SIP, MGCP, HTTP, XDM, XCAP, Diameter and many others.
It is fully compliant with JSR 240 (JSLEE 1.1).</p>
</div>
<div class="paragraph">
<p>Restcomm  jSS7 is a software based implementation of the SS7 protocol.
It provides implementation for Level 2 and above in the SS7 protocol Stack. Restcomm  jSS7 Stack User Guide is bundled within and you can refer to the guide for more details on the Stack.</p>
</div>
<div class="paragraph">
<p>The diagram below depicts top design overview:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/ussd-application-design-overview.png" alt="ussd application design overview">
</div>
</div>
<div class="paragraph">
<p>Restcomm  USSD GATEWAY provides Load Balancing and Fault Tolerance.
Two or more third-party Application Servers can be paired to provide Fault-Tolerance on the Gateway and GSM Network level.</p>
</div>
<div class="paragraph">
<p>Geographic Redundancy can be achieved as shown in the diagram below:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/MultipleGeoghraphicSite.png" alt="MultipleGeoghraphicSite">
</div>
</div>
<div class="paragraph">
<p>Below diagram shows how to achieve load-balancing by connecting to two STP&#8217;s from Operator side.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/Load-balanced-USSD-Topology.png" alt="Load balanced USSD Topology">
</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of now, the Gateway supports the following protocols for proxying:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP</p>
</li>
<li>
<p>SIP</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multi_tenancy"><a class="anchor" href="#_multi_tenancy"></a>4. Multi-tenancy support</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Restcomm USSD GATEWAY is able to work in multi-tenant mode by connecting to a set of different SS7 operators.
The procedure is based on dividing of USSD routing rules into several areas ("subnetworks").</p>
</div>
<div class="paragraph">
<p>Each area has its unique digital "netwokId" value.
You can assign a unique USSD Global Title for each netwokId.
Each SS7 SCCP service access point (SAP) and each  USSD Routing Rule belongs to one of the networks (to each of them a networkId value is assigned). Default netwokId value is "0". If a user does not specify a netwokId value when USSD Routing Rule or SAP rule creation, networkId=0 will be assigned.</p>
</div>
<div class="paragraph">
<p>When a PULL request comes from SS7 network, a networkId value from SAP will be assigned to a USSD dialog.
Then USSD Routing Rule with assigned networkId will be chosen for request routing to a proper HTTP or SIP application.</p>
</div>
<div class="paragraph">
<p>When a PUSH request comes from HTTP application, a networkId value from HTTP XML payload ("networkId" attribute)  is taken (or is assigned as 0 if "networkId" attribute is missed in the XML payload). Then SS7 SAP will be chosen when routing USSD request to SS7 network.</p>
</div>
<div class="paragraph">
<p>When a PUSH request comes from SIP application, a networkId value is always assigned as 0.
It is impossible now to use SIP App originated messages for multi-tenancy.</p>
</div>
<div class="paragraph">
<p>NetworkId are specified at different places:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>for JSS7 level SAPs and SCCP routing rules are configured for this.
See "7.4.5.
Create a new Service Access Point" and "7.4.17.
Create a new SCCP Rule" chapters of "JSS7 stack User Guide".</p>
</li>
<li>
<p>for USSD Routing Rule see the chapter <a href="#_setting_ussd_routing_rules_create">Create new USSD Rule</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For configuring of USSD Global Titles - see chapters <a href="#_setting_ussd_gt">USSD Global Title</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running"><a class="anchor" href="#running"></a>5. Running</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="running-the-gateway"><a class="anchor" href="#running-the-gateway"></a>5.1. Running the Gateway</h3>
<div class="olist arabic">
<div class="title">Procedure: Run Restcomm USSD GATEWAY</div>
<ol class="arabic">
<li>
<p>Pre-requisite:</p>
<div class="ulist">
<ul>
<li>
<p>You must have Restcomm USSD GATEWAY installed as explained in the Installation Guide.</p>
</li>
<li>
<p>If you are using the SS7 board on server, you must ensure that the <code>java.library.path</code> variable is set to point to the directory containing the native component.
Alternatively you can copy it to the JBoss native library path manually.</p>
</li>
</ul>
</div>
</li>
<li>
<p>All you have to do to start the Gateway is start the JBoss Application Server.
To start the JBoss Server you must execute the <em class="path">run.sh</em> (Unix) or <em class="path">run.bat</em> (Microsoft Windows) startup script in the installation directory <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/bin</em>.
Note that this will start the server in the default profile.
The "default" profile is a clean profile where you start from scratch and configure the entire SS7 Stack and USSD Gateway to suit your requirements.</p>
</li>
<li>
<p>Result: If the service started properly you should see the following last few output lines in the Unix terminal or Command Prompt depending on your environment:</p>
<div class="listingblock">
<div class="content">
<pre>22:23:11,583 INFO  [DeploymentMBeanImpl] (main) Installed DeployableUnitID[url=file:/home/vinu/mobicents-ussdgateway-&lt;version&gt;/jboss-5.1.0.GA/server/default/deploy/mobicents-ussd-gateway/services-DU-6.1.5.GA.jar/]
22:23:11,874 INFO  [ServiceManagementImpl] (main) Activated ServiceID[name=mobicents-ussdgateway-cdr,vendor=org.mobicents,version=1.0]
22:23:11,976 ERROR [STDERR] (pool-28-thread-1) QUERRY: 000000 CREATE TABLE USSD_GW_CDRS (ID VARCHAR(150) NOT NULL, L_SPC INT, L_SSN SMALLINT, L_RI SMALLINT, L_GT_I SMALLINT, L_GT_DIGITS VARCHAR(18), R_SPC INT, R_SSN SMALLINT, R_RI SMALLINT, R_GT_I SMALLINT, R_GT_DIGITS VARCHAR(18), SERVICE_CODE VARCHAR(10), OR_NATURE SMALLINT, OR_PLAN SMALLINT, OR_DIGITS VARCHAR(18), DE_NATURE SMALLINT, DE_PLAN SMALLINT, DE_DIGITS VARCHAR(18), ISDN_NATURE SMALLINT, ISDN_PLAN SMALLINT, ISDN_DIGITS VARCHAR(18), VLR_NATURE SMALLINT, VLR_PLAN SMALLINT, VLR_DIGITS VARCHAR(18), IMSI VARCHAR(100), TERMINATE_REASON VARCHAR(60), TSTAMP TIMESTAMP  NOT NULL , DIALOG_ID BIGINT, PRIMARY KEY(ID,TSTAMP));
22:23:12,135 INFO  [ServiceManagementImpl] (main) Activated ServiceID[name=mobicents-ussdgateway,vendor=org.mobicents,version=1.0]
22:23:12,395 INFO  [UssdPropertiesManagement] (main) Loading USSD Properties from /home/vinu/mobicents-ussdgateway-6.1.5.GA/jboss-5.1.0.GA/server/default/data/UssdManagement_ussdproperties.xml
22:23:12,395 WARN  [UssdPropertiesManagement] (main) Failed to load the USSD configuration file.
/home/vinu/mobicents-ussdgateway-6.1.5.GA/jboss-5.1.0.GA/server/default/data/UssdManagement_ussdproperties.xml (No such file or directory)
22:23:12,396 INFO  [ShortCodeRoutingRuleManagement] (main) Loading short code routig rule configuration from /home/vinu/mobicents-ussdgateway-6.1.5.GA/jboss-5.1.0.GA/server/default/data/UssdManagement_scroutingrule.xml
22:23:12,397 WARN  [ShortCodeRoutingRuleManagement] (main) Failed to load the short code routig rule configuration file.
/home/vinu/mobicents-ussdgateway-6.1.5.GA/jboss-5.1.0.GA/server/default/data/UssdManagement_scroutingrule.xml (No such file or directory)
22:23:12,400 INFO  [UssdManagement] (main) Started UssdManagement
22:23:12,419 INFO  [ShellServer] (main) Starting SS7 management shell environment
22:23:12,430 INFO  [ShellServer] (main) ShellExecutor listening at /127.0.0.1:3435
22:23:12,498 INFO  [Http11Protocol] (main) Starting Coyote HTTP/1.1 on http-127.0.0.1-8080
22:23:12,529 INFO  [AjpProtocol] (main) Starting Coyote AJP/1.3 on ajp-127.0.0.1-8009
22:23:12,541 INFO  [ServerImpl] (main) JBoss (Microcontainer) [5.1.0.GA (build: SVNTag=JBoss_5_1_0_GA date=200905221634)] Started in 1m:11s:118ms</pre>
</div>
</div>
</li>
<li>
<p>If you are starting {this-application.dirname}-{project.version} for the first time, SS7 is not configured.
You can use either the Shell Client or the GUI to connect to {this-application.dirname}-{project.version} and configure the SS7 Stack, USSD parameters and Routing Rules.
Once configured, the state and configuration of SS7 and USSD are both persisted which stands a server re-start operation.
The next chapter will discuss in detail about configuring SS7 and the USSD Gateway.</p>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: Stop the Gateway</div>
<ol class="arabic">
<li>
<p>To stop the Restcomm USSD GATEWAY , you must shut down the JBoss Application Server.
To shut down the server(s) you must execute the <code>shutdown.sh -s</code> (Unix) or  <code>shutdown.bat -s</code> (Microsoft Windows) script in the installation directory <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/bin</em>.</p>
</li>
<li>
<p>If the server stopped properly, you will see the following three lines as the  last output in the Unix terminal or Command Prompt:</p>
<div class="listingblock">
<div class="content">
<pre>[Server] Shutdown complete
Halting VM</pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_running_the_gateway_simulator"><a class="anchor" href="#_running_the_gateway_simulator"></a>5.2. Running the Gateway - Simulator Profile</h3>
<div class="paragraph">
<p>The Restcomm USSD GATEWAY offers you an option to run the Gateway with a "simulator" profile for testing purpose.
The "simulator" profile is a pre-configured profile to work with the jss7-simulator.
Starting the Gateway with the "simulator" profile is similar to the steps explained for the "default" profile except that you must pass the string value "simulator" to the -c command line option when invoking the run script.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>[bin]$ ./run.sh -c simulator</pre>
</div>
</div>
<div class="paragraph">
<p>By default, the USSD Simulator profile is configured for use in Linux systems.
For using it in Microsoft Windows systems, you must configure the parameters as explained below.</p>
</div>
<div class="paragraph">
<p>Open the file  <em class="path">mobicents-ussdgateway-&lt;version&gt;/jboss-5.1.0.GA/server/simulator/data/SCTPManagement_sctp.xml</em> and replace in two places, the parameter <code>ipChannelType="0"</code> with <code>ipChannelType="1"</code> to enable TCP connection instead of SCTP since Windows does not support SCTP.
If you are using in a Linux system, there is no modification required to the settings.</p>
</div>
<div class="sect3">
<h4 id="_simulator_ussd_example"><a class="anchor" href="#_simulator_ussd_example"></a>5.2.1. Running USSD Examples in Simulator</h4>
<div class="paragraph">
<p>If you are not familiar with the Mobicents jss7 Simulator, you can find instructions about using the jss7-simulator in the Restcomm jSS7 User Guide.
You will also find example test cases explained in detail in the jSS7 User Guide.
In this section you will find a sample USSD Pull and USSD Push examples explained using the jSS7 Simulator.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Running Mobicents jSS7 Simulator - USSD Pull Example</div>
<ol class="arabic">
<li>
<p>Change the working directory to the bin folder in the Simulator&#8217;s installation directory.</p>
<div class="listingblock">
<div class="content">
<pre>[vinu@vinu-neha ~]$ cd Mobicents-ussd-&lt;version&gt;/tools/Mobicents-ss7-simulator/bin</pre>
</div>
</div>
</li>
<li>
<p>Ensure that the <em class="path">run.sh</em> start script is executable.</p>
<div class="listingblock">
<div class="content">
<pre>bin$ chmod +x run.sh</pre>
</div>
</div>
</li>
<li>
<p>Execute the <em class="path">run.sh</em> Bourne shell script with the command <code>./run.sh gui</code>.</p>
<div class="listingblock">
<div class="content">
<pre>bin$ ./run.sh gui</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>This will launch the Simulator GUI Application.</pre>
</div>
</div>
</li>
<li>
<p>When the GUI shows up, select "main" (default) as host name [or type "win" as host name under Windows] and press the 'Start' button.
The Simulator is already pre-configured to connect to the USSD Gateway (running in simulator profile). Press 'Run test' and again click on 'Start' in the next screen.
The Simulator will connect to USSD (via m3ua protocol). The Low level part is configured to SCTP (not TCP) protocol and hence you can test the USSD in a Linux environment.
To test under Windows OS, you must change the SS7 simulator settings to TCP.</p>
</li>
<li>
<p>After approximately 30 seconds you will see the state of the Simulator change to "M3UA connection is active" as in figure below:</p>
<div class="imageblock">
<div class="content">
<img src="./images/USSD_SS7_Simulator_ACTIVE.png" alt="USSD SS7 Simulator ACTIVE">
</div>
<div class="title">Figure 1. USSD SS7 Simulator - Active</div>
</div>
</li>
<li>
<p>Restcomm USSD GATEWAY is configured with a routing rule for *519#. Dial *519# in your Simulator GUI and press 'Send ProcessUnstructuredRequest'. The example will respond to you with the message "Hello World 1.
Balance 2.
Texts Remaining".</p>
<div class="imageblock">
<div class="content">
<img src="./images/USSD_SS7_Simulator_Process_Unst_request.png" alt="USSD SS7 Simulator Process Unst request">
</div>
<div class="title">Figure 2. USSD SS7 Simulator - Process Unstructured Request</div>
</div>
</li>
<li>
<p>Now Dial 1 in your Simulator GUI and press 'Send UnstructuredResponse'. You should get a response "Thank you!".</p>
<div class="imageblock">
<div class="content">
<img src="./images/USSD_SS7_Simulator_Unstruc_request.png" alt="USSD SS7 Simulator Unstruc request">
</div>
<div class="title">Figure 3. USSD SS7 Simulator - Unstructured Request</div>
</div>
</li>
</ol>
</div>
<div class="olist arabic">
<div class="title">Procedure: Running Restcomm USSD Simulator (HLR) - USSD Push Example</div>
<ol class="arabic">
<li>
<p>You must first start the Restcomm USSD GATEWAY in simulator profile.</p>
<div class="listingblock">
<div class="content">
<pre>[vinu@vinu-neha ~]$ cd mobicents-ussdgateway-&lt;version&gt;/jboss-5.1.0.GA/bin
[vinu@vinu-neha bin]$./run.sh -b 127.0.0.1 -c simulator</pre>
</div>
</div>
</li>
<li>
<p>To send a PUSH request go to <a href="http://localhost:8080/jmx-console/" class="bare">http://localhost:8080/jmx-console/</a> and click the link <code>org.mobicents.ussdgateway.example</code> in the left menu.
Then open the MBean <code>'name=HttpPush'</code>.</p>
</li>
<li>
<p>MBean provides two operations: 1) <code>sendNotify</code> to push Notification and 2) <code>sendRequest</code> to push USSD menu based tree.
The parameter <code>Isdn</code> is the MSISDN to which Notify or Request is to be sent.</p>
<div class="imageblock">
<div class="content">
<img src="./images/Restcomm-ussd-simulator_Notify.png" alt="Restcomm ussd simulator Notify">
</div>
<div class="title">Figure 4. Mobicents USSD Simulator - Notify</div>
</div>
<div class="paragraph">
<p>You can simulate a simple Notify dialog by following the below steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Fill the ISDN field with a preferred ISDN number, for example "1111" is good for SS7 Simulator.
Now press "Apply changes".</p>
</li>
<li>
<p>Perform "reset" operation.
Perform "sendNotify" operation with parameters: String=&lt;Text of your notification&gt;, boolean=false, int=60000 and String=&lt;any random string&gt;. Parameters definition is as below</p>
</li>
<li>
<p>1st String is USSD message that you want to push to mobile</p>
</li>
<li>
<p>2nd Boolean if set to true means USSD Gw will send empty TCAP Begin and try to establish dialog before sending actual message.</p>
</li>
<li>
<p>3rd Int is custom invoke timeout.
User must respond within this period else USSD Gw will terminate Dialog and Application will get appropriate error message</p>
</li>
<li>
<p>4th String is random string that is stored at USSD Gw side as custom object.</p>
</li>
<li>
<p>When ever response comes back, USSD Gw will include this custom string in XML Payload.</p>
</li>
<li>
<p>Perform "close" operation.
You will now find a notification at the SS7 Simulator.</p>
<div class="paragraph">
<p>You can also simulate more complicated scenarios like pushing the tree based menu to user and expecting some input from users by calling <code>sendRequest</code>.
The below Class provides more explanation for attributes and operations of HttpPush.</p>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">/**
 * Simple MBean interface. This MBean is front end of simple example for ussd
 * push via HTTP.
 *
 */
public interface HTTPPushMBean {

	/**
	 * The URI where HTTP Post request is to be submitted. This should point the
	 * USSD Gateway. Basically http://USSD-IP:8080/mobicents
	 *
	 * @param uri
	 */
	public void setTargetUri(String uri);

	/**
	 * Get the URI pointing to USSD Gateway for push
	 *
	 * @return
	 */
	public String getTargetUri();

	/**
	 * Set the MSISDN where USSD Push is to be sent
	 *
	 * @param isdn
	 */
	public void setIsdn(String isdn);

	/**
	 * Get the MSISDN where USSD request is to be pushed
	 *
	 * @return
	 */
	public String getIsdn();

	/**
	 * Reset( remove local dialog ) in case something goes wrong
	 */
	public void reset();

	/**
	 * Starts dialog if not already started. Sends Unstructured Request. It can
	 * be sent multiple times in the same dialog
	 *
	 * @param ussdRequest
	 *            The actual USSD String request
	 * @param emptyDialogHandshake
	 *            If true, USSD Gateway will first establish Dialog by doing
	 *            handshake before sending USSD request. If false the USSD
	 *            request will be added in Dialog begin message
	 * @param invokeTimeout
	 *            Time in milliseconds USSD gateway will wait for user to
	 *            respond, if user doesn't respond back within specified time,
	 *            USSD Gateway will abort the dialog and send back Abort error
	 *            to HTTP App
	 * @param userData
	 * 			  User Data to be sent with every request to USSD Gateway which will be
	 * 			  returned back with response from USSD Gw. This is just in case if
	 * 			  application wants to keep some data at Dialog level, for example MSISDN
	 *
	 *
	 * @throws Exception
	 */
	public void sendRequest(String ussdRequest, boolean emptyDialogHandshake, int invokeTimeout, String userData) throws Exception;

	/**
	 * Starts dialog if not already started. Sends Notify Request. It can be
	 * sent multiple times in the same dialog
	 *
	 * @param ussdRequest
	 *            The actual USSD String request
	 * @param emptyDialogHandshake
	 *            If true, USSD Gateway will first establish Dialog by doing
	 *            handshake before sending USSD request. If false the USSD
	 *            request will be added in Dialog begin message
	 * @param invokeTimeout
	 *            Time in milliseconds USSD gateway will wait for user to
	 *            respond, if user doesn't respond back within specified time,
	 *            USSD Gateway will abort the dialog and send back Abort error
	 *            to HTTP App
	 * @param userData
	 * 			  User Data to be sent with every request to USSD Gateway which will be
	 * 			  returned back with response from USSD Gw. This is just in case if
	 * 			  application wants to keep some data at Dialog level, for example MSISDN
	 * @throws Exception
	 */
	public void sendNotify(String ussdRequest, boolean emptyDialogHandshake, int invokeTimeout, String userData) throws Exception;

	/**
	 * USER Abort the underlying MAP Dialog
	 *
	 * @throws Exception
	 */
	public void abort() throws Exception;

	/**
	 * Close the underlying MAP Dialog. This will send TCAP End to peer
	 *
	 * @throws Exeption
	 */
	public void close() throws Exception;

	/**
	 * Return current status of service - what has been sent, what has been
	 * received etc.
	 *
	 * @return
	 */
	public String getStatus();
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_shell"><a class="anchor" href="#_running_shell"></a>5.3. Running the Shell</h3>
<div class="paragraph">
<p>You must start the Shell client and connect to the managed instance prior to executing commands to configure the Gateway.
Shell can be started by issuing the following command from <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/bin</em> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code>[$] ./ss7-cli.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>Once console starts, it will print following information and await further commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>version=2.0.0-SNAPSHOT,name=mobicents CLI,prefix=mobicents,vendor=TeleStax
mobicents&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Before issuing further commands you must connect to a managed instance.
For more details on connecting to an instance and for a list of all supported commands and details on configuring the SS7 stack refer to the Mobicents SS7 Stack User Guide.</p>
</div>
</div>
<div class="sect2">
<h3 id="_using_gui"><a class="anchor" href="#_using_gui"></a>5.4. Running the Graphical User Interface</h3>
<div class="paragraph">
<p>Open a Web Browser and navigate to <a href="http://localhost:8080/mobicents-management/" class="bare">http://localhost:8080/mobicents-management/</a>. This will launch the Restcomm GUI Management Console which is horizontally segregated into multiple tabs, one tab for each product in the Restcomm Suite.
You will notice that only the tabs of products whose binaries are installed already will be shown enabled and active in the GUI.
If you have successfully installed the Restcomm USSD GATEWAY you will find the tabs for JAIN-SLEE, JMX, SS7 and USSD GW active and enabled.
For more details on using the GUI for SS7 or JAIN-SLEE please refer to their respective user guides.
This document only provides instructions for using the GUI to configure the USSD Gateway.</p>
</div>
<div class="paragraph">
<p>Switch to the USSD GW tab and you will find that the window will look similar to the figure below.
The GUI is divided into three sections:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A left panel listing the management and monitoring units (Server Settings, Routing Rules, Metrics). You can click on any of these to select and navigate to the specific management unit.</p>
</li>
<li>
<p>A main panel displaying the currently selected management unit. The main view is categorized into multiple tabs to manage different aspects of the selected layer.</p>
</li>
<li>
<p>A bottom panel displaying the log data.
You can clear the log anytime by clicking on the trash icon at the top right corner of this panel.
You can also minimize or maximize this panel to suit your needs.</p>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/GUI-USSD-GW-main.png" alt="GUI USSD GW main">
</div>
<div class="title">Figure 5. GUI - Restcomm USSD GATEWAY</div>
</div>
<div class="sect3">
<h4 id="_connect_gui"><a class="anchor" href="#_connect_gui"></a>5.4.1. Connect to a new Instance</h4>
<div class="paragraph">
<p>You can connect to a new instance by entering the IP:Port values and the login credentials in the top left corner of the GUI.
However please note that this feature is not available in this release but will be fully functional in the next release.</p>
</div>
</div>
<div class="sect3">
<h4 id="_gui_security"><a class="anchor" href="#_gui_security"></a>5.4.2. Authentication</h4>
<div class="paragraph">
<p>Restcomm USSD GATEWAY GUI Management Security is based on the JBoss Security Framework.
However please note that the feature is not fully functional yet and you will not be able to sign-out or sign-in using the login panel at the top right corner of the GUI.
Future releases will offer a full implementation.</p>
</div>
<div class="paragraph">
<p>As of now, there is basic authentication offered (which is based on the JBoss Security framework). When you try to start the Web Console, you will be prompted to enter login credentials.
These credentials can be configured in the files <em class="path">jmx-console-roles.properties</em> and <em class="path">jmx-console-users.properties</em> located at <em class="path">mobicents-ussdgateway-&lt;version&gt;/jboss-5.1.0.GA/server/&lt;profile&gt;/conf/props/</em>.</p>
</div>
<div class="paragraph">
<p>You can also change the authentication from flat file system to database by making necessary configurations in the file <em class="path">mobicents-ussdgateway-&lt;version&gt;/jboss-5.1.0.GA/server/&lt;profile&gt;/conf/login-config.xml</em>.</p>
</div>
<div class="paragraph">
<p>For detailed instructions and to know more about JBoss Security Framework please refer to the JBoss Installation Guide  <a href="http://docs.jboss.org/jbossas/docs/Installation_And_Getting_Started_Guide/5/html_single/index.html#Basic_Configuration_Issues-Security_Service">here</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Deafult user-id and password for GUI Management Console is admin and admin.
You can change the user-id and password in files  <em class="path">jmx-console-roles.properties</em> and <em class="path">jmx-console-users.properties</em>  located at <em class="path">mobicents-ussdgateway-&lt;version&gt;/jboss-5.1.0.GA/server/&lt;profile&gt;/conf/props/</em>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="configuring"><a class="anchor" href="#configuring"></a>6. Configuring</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You must fine-tune Memory and Database settings for better performance before using Restcomm USSD GATEWAY in production.
Once you complete setting up the Gateway you must configure the SS7 Stack, USSD routing rules and USSD paramters. Restcomm USSD GATEWAY comes with a convenient user-friendly Graphical User Interface (GUI) and a Command Line Interface (CLI) that will allow you to configure, monitor and manage the Gateway.
While the CLI tool allows complete configuration and control of the Gateway, the GUI-based management enhances the usability of the Gateway and gives you the ability to configure and manage the USSD Gateway dynamically.
This chapter will explain how to manage the Gateway effectively using both the GUI and the CLI.</p>
</div>
<div class="sect2">
<h3 id="memory-settings"><a class="anchor" href="#memory-settings"></a>6.1. Memory Settings</h3>
<div class="paragraph">
<p>You should fine tune the JVM memory settings based on your needs but we recommend you allocate a minimum of 3 GB for initial and maximum heap size.
These settings are specified in the file[path]<em>mobicents-ussdgateway-/jboss-5.1.0.GA/bin/run.conf</em>.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">-Xms3072m</dt>
<dd>
<p>Initial heap size, set in megabytes</p>
</dd>
<dt class="hdlist1">-Xmx3072m</dt>
<dd>
<p>Maximum heap size, set in megabytes</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="cdr-logging-settings"><a class="anchor" href="#cdr-logging-settings"></a>6.2. CDR Logging Settings</h3>
<div class="paragraph">
<p>Every transaction in the Restcomm USSD GATEWAY is logged either in a Textfile or a Database as per the configuration.
By default, transactions are logged in a plain text file.
Alternatively, you can choose to have CDR logged in a Database instead of a plain text file.
You will find instructions for both in the sections below.</p>
</div>
<div class="paragraph">
<p>If you change the configuration to log CDR in a Database, then you must be aware that transactions are logged into the default Database HSQLDB that comes bundled with JBoss AS and leverages the JBoss AS DataSource.
However this is only made available to allow the platform to run "out of the box". You must configure a production ready Database prior to using the Gateway in a production environment. Restcomm USSD GATEWAY has been tested with PostgreSQL and MySQL.</p>
</div>
<div class="paragraph">
<p>To switch between Database and plain text file, you can make use of the CLI command <code>ussd set cdrloggingto &lt;Database|Textfile&gt;</code> or configure this in the GUI.
Refer to  <a href="#_set_cdrlogging">CDR logging - Database / Textfile</a> for more details.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
HSQLDB must not be used in a production environment.
You must ensure that you delete this datasource and configure a production-friendly Database like PostgreSQL or MySQL.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_configure_datasource"><a class="anchor" href="#_configure_datasource"></a>6.2.1. Configuring an Alternate DataSource</h4>
<div class="paragraph">
<p>The example HSQLDB DataSource is bound to the JNDI name java:/DefaultDS and its descriptor is available in the file <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/hsqldb-ds.xml</em>.
You must delete this datasource and configure the Platform to use your choice of Database.
For instructions on configuring an alternate DataSource with an example, please refer to <a href="#_configuring_mysql">Configuring MySQL as datasource</a>.
For detailed instructions and explanation please refer to the JBoss AS Getting Started Guide available <a href="https://community.jboss.org/wiki/JBossAS5InstallationAndGettingStartedGuide">here</a>.
You will also find a lot of examples in the folder <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/docs/examples/jca/</em>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_configure_jslee_jdbc_ra"><a class="anchor" href="#_configure_jslee_jdbc_ra"></a>6.2.2. Configuring JSLEE JDBC RA</h4>
<div class="paragraph">
<p>Restcomm USSD GATEWAY leverages JSLEE JDBC RA for persistence.
Detailed JSLEE JDBC RA documentation is available in <em class="path">mobicents-ussdgateway-/docs/slee/Mobicents_SLEE_RA_JDBC_User_Guide.pdf</em> that explains how to point to the new DataSource.
An example configuration is explained in this admin guide in the section <a href="#_configuring_mysql">Configuring MySQL as datasource</a>.
When you have completed configuring an alternate DataSource in JBoss AS, you can proceed to modify JSLEE configurations accordingly.
You must change the Dialect in the file <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/mobicents-slee/META-INF/jboss-beans.xml</em> to reflect your alternate DataSource.</p>
</div>
</div>
<div class="sect3">
<h4 id="_table_structure"><a class="anchor" href="#_table_structure"></a>6.2.3. CDR Table Structure</h4>
<div class="listingblock">
<div class="content">
<pre>CREATE TABLE USSD_GW_CDRS (ID VARCHAR(150) NOT NULL, L_SPC INT, L_SSN SMALLINT, L_RI SMALLINT, L_GT_I SMALLINT, L_GT_DIGITS VARCHAR(18), R_SPC INT, R_SSN SMALLINT, R_RI SMALLINT, R_GT_I SMALLINT, R_GT_DIGITS VARCHAR(18), SERVICE_CODE VARCHAR(50), OR_NATURE SMALLINT, OR_PLAN SMALLINT, OR_DIGITS VARCHAR(18), DE_NATURE SMALLINT, DE_PLAN SMALLINT, DE_DIGITS VARCHAR(18), ISDN_NATURE SMALLINT, ISDN_PLAN SMALLINT, ISDN_DIGITS VARCHAR(18), VLR_NATURE SMALLINT, VLR_PLAN SMALLINT, VLR_DIGITS VARCHAR(18), IMSI VARCHAR(100), STATUS VARCHAR(30) NOT NULL , TYPE VARCHAR(30) NOT NULL , TSTAMP TIMESTAMP NOT NULL , LOCAL_DIALOG_ID BIGINT, REMOTE_DIALOG_ID BIGINT, PRIMARY KEY(ID,TSTAMP));

where

ID : Primary unique key

L_SPC : Local Signaling Pointcode

L_SSN : Local Subsystem Number

L_RI : Local Routing Indicator

L_GT_I : Local Global Title Indicator whose values are
NO_GLOBAL_TITLE_INCLUDED(0)
GLOBAL_TITLE_INCLUDES_NATURE_OF_ADDRESS_INDICATOR_ONLY(1)
GLOBAL_TITLE_INCLUDES_TRANSLATION_TYPE_ONLY(2)
GLOBAL_TITLE_INCLUDES_TRANSLATION_TYPE_NUMBERING_PLAN_AND_ENCODING_SCHEME(3)
GLOBAL_TITLE_INCLUDES_TRANSLATION_TYPE_NUMBERING_PLAN_ENCODING_
					     SCHEME_AND_NATURE_OF_ADDRESS(4)

L_GT_DIGITS : Local Global Title Digits

R_SPC : Remote Signaling Pointcode

R_SSN : Remote Subsystem Number

R_RI : Remote Routing Indicator

R_GT_I : Remote Global Title Indicator

R_GT_DIGITS : Remote Global Title Digits

SERVICE_CODE : The short code dialed by user, for example *519#

OR_NATURE : AddressNature of origination
If the MAP Dialog carries Originating Address Reference this is captured in this column
Possible values are:
unknown(0), international_number(1), national_significant_number(2), network_specific_number(3),
subscriber_number(4), reserved( 5), abbreviated_number(6) and reserved_for_extension(7)

OR_PLAN : Numbering Plan of origination.
Possible values are:
unknown(0), ISDN(1), spare_2(2), data(3), telex(4), spare_5(5), land_mobile(6),
spare_7(7), national(8), private_plan(9), reserved(15);

OR_DIGITS : Digits of origination

DE_NATURE : AddressNature of Destination

DE_PLAN : Numbering Plan of Destination

DE_DIGITS : Digits of destination

ISDN_NATURE : AddressNature
The incoming MAP Dialog carries ISDN Address of mobile that dialed this shortcode.
The column ISDN_NATURE captures ISDN details.

ISDN_PLAN : Numbering Plan as explained above

ISDN_DIGITS : Digits of MSISDN

VLR_NATURE : AddressNature
If MAP version is Ericsson MAP (E-MAP), it carries VLR address and IMSI

VLR_PLAN : Numbering Plan as explained above

VLR_DIGITS : Digits of VLR

IMSI : IMSI

STATUS : Final status of Dialog. Possible values are explained below:


TYPE : If the USSD request is pull, its value is PULL or its PUSH

TSTAMP : Time stamp when this request was executed

LOCAL_DIALOG_ID : Local Transaction Id of TCAP Dialog

REMOTE_DIALOG_ID : Remote Transaction Id of TCAP Dialog</pre>
</div>
</div>
<div class="paragraph">
<p>Status : Final status of Dialog can be</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">SUCCESS</dt>
<dd>
<p>Dialog ended successfully</p>
</dd>
<dt class="hdlist1">FAILED_INVOKE_TIMEOUT</dt>
<dd>
<p>Invoke (TCAP) sent from USSD Gateway to peer timed out.</p>
</dd>
<dt class="hdlist1">FAILED_DIALOG_TIMEOUT</dt>
<dd>
<p>Dialog (TCAP) timed out as there is no activity on Dialog.
The default dialog timeout is 60 seconds which can be configured on TCAP stack.</p>
</dd>
<dt class="hdlist1">FAILED_APP_TIMEOUT</dt>
<dd>
<p>Request sent by USSD Gateway to Application timed out.
Application took longer than configured <code>dialogtimeout</code>.</p>
</dd>
<dt class="hdlist1">FAILED_CORRUPTED_MESSAGE</dt>
<dd>
<p>Message received by USSD Gateway from HTTP/SIP Application is corrupted.
Usually this will also create some ERROR traces in server.log</p>
</dd>
<dt class="hdlist1">FAILED_TRANSPORT_ERROR</dt>
<dd>
<p>Used only for SIP transport for now.
Indicates transportation error</p>
</dd>
<dt class="hdlist1">FAILED_TRANSPORT_FAILURE</dt>
<dd>
<p>In case of USSD PULL if Application sennds back non OK (200) response</p>
</dd>
<dt class="hdlist1">FAILED_PROVIDER_ABORT</dt>
<dd>
<p>Dialog (TCAP) was aborted by peer</p>
</dd>
<dt class="hdlist1">FAILED_DIALOG_USER_ABORT</dt>
<dd>
<p>Dialog (TCAP) was aborted by user</p>
</dd>
<dt class="hdlist1">FAILED_DIALOG_REJECTED</dt>
<dd>
<p>Dialog (TCAP) was rejected by user</p>
</dd>
<dt class="hdlist1">FAILED_SYSTEM_FAILURE</dt>
<dd>
<p>Error happened while parsing the received USSD/SS7 messsage from SS7 peer.
Usually this will also create some ERROR traces in server.log</p>
</dd>
<dt class="hdlist1">FAILED_ABSENT_SUBSCRIBER</dt>
<dd>
<p>Subscriber is absent (sent by HLR). Only for USSD PUSH and after MAP SRI is successful</p>
</dd>
<dt class="hdlist1">FAILED_ILLEGAL_SUBSCRIBER</dt>
<dd>
<p>Subscriber is illegal (sent by HLR). Only for USSD PUSH when MAP SRI is sent</p>
</dd>
<dt class="hdlist1">FAILED_USSD_BUSY</dt>
<dd>
<p>Subscriber is busy (sent by HLR). Only for USSD PUSH when MAP SRI is sent</p>
</dd>
<dt class="hdlist1">FAILED_MAP_ERROR_COMPONENT</dt>
<dd>
<p>Some error sent by HLR.</p>
</dd>
<dt class="hdlist1">FAILED_MAP_REJECT_COMPONENT</dt>
<dd>
<p>Component (Invoke) rejected by HLR.</p>
</dd>
<dt class="hdlist1">ABORT_APP</dt>
<dd>
<p>Application requested to Abort the Dialog (TCAP)</p>
</dd>
<dt class="hdlist1">SRI_DIALOG_REJECTED</dt>
<dd>
<p>Dialog (TCAP) was rejected by HLR specifcally when MAP SRI request was sent</p>
</dd>
<dt class="hdlist1">SRI_PROVIDER_ABORT</dt>
<dd>
<p>Dialog (TCAP) was aborted by peer specifcally when MAP SRI request was sent</p>
</dd>
<dt class="hdlist1">SRI_DIALOG_USER_ABORT</dt>
<dd>
<p>Dialog (TCAP) was aborted by user specifcally when MAP SRI request was sent</p>
</dd>
<dt class="hdlist1">SRI_DIALOG_TIMEOUT</dt>
<dd>
<p>Dialog (TCAP) was timedout specifcally MAP SRI Dialog</p>
</dd>
<dt class="hdlist1">SRI_MAP_REJECT_COMPONENT</dt>
<dd>
<p>Component (Invoke) rejected by HLR specifcally for MAP SRI request</p>
</dd>
<dt class="hdlist1">SRI_ABSENT_SUBSCRIBER</dt>
<dd>
<p>Subscriber is absent (sent by HLR) specifcally for MAP SRI request</p>
</dd>
<dt class="hdlist1">SRI_CALL_BARRED</dt>
<dd>
<p>Call is bared (sent by HLR) specifcally for MAP SRI request</p>
</dd>
<dt class="hdlist1">SRI_TELESERVICE_NOT_PROVISIONED</dt>
<dd>
<p>Teleservice no provisioned (sent by HLR) specifcally for MAP SRI request</p>
</dd>
<dt class="hdlist1">SRI_UNKNOWN_SUBSCRIBER</dt>
<dd>
<p>Unknown subscriber (sent by HLR) specifcally for MAP SRI request</p>
</dd>
<dt class="hdlist1">SRI_MAP_ERROR_COMPONENT</dt>
<dd>
<p>Some error (sent by HLR) specifcally for MAP SRI request</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_http_client_ra"><a class="anchor" href="#_http_client_ra"></a>6.3. Configuring JSLEE http-client RA</h3>
<div class="paragraph">
<p>Restcomm USSD GATEWAY acts as a HTTP Client to achieve USSD pull by sending a HTTP POST request to third party applications (HTTP Server) for every dialled short code.
You must configure the HTTP Client JSLEE Resource Adaptor&#8217;s properties to suit your requirements.
Please refer to the SLEE RA HTTP Client User Guide available in <em class="path">mobicents-ussdgateway-/docs/slee/Mobicents_SLEE_RA_HTTP_Client_User_Guide.pdf</em>.</p>
</div>
<div class="paragraph">
<p>For every Short Code Routing rule added in the USSD Gateway, you must ensure that there is a corresponding <code>MAX_CONNECTIONS_FOR_ROUTES</code> property appropriately configured in the HTTP Client JSLEE RA.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
HTTP Client JSLEE RA&#8217;s default configuration allows the http-client to handle only two concurrent connections at a time.
You must modify the <code>MAX_CONNECTIONS_FOR_ROUTES</code> property to meet your Short Code Routing Rules requirements in production.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_logging"><a class="anchor" href="#_logging"></a>6.4. Configuring log4j Logging Service</h3>
<div class="paragraph">
<p>Restcomm USSD GATEWAY uses <code>Apache log4j</code> for logging.
If you are not familiar with the <code>log4j</code> package, you can read more about it at the Jakarta <a href="http://jakarta.apache.org/log4j/">website</a>.</p>
</div>
<div class="paragraph">
<p>Logging is controlled from a central configuration file located at <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/conf/jboss-log4j.xml</em>, one for each JBoss AS configuration profile.
This file defines a set of appenders specifying the log files, what categories of messages should go there, the message format and the level of filtering.
For more details, please refer to Section 9.6.3, "Logging Service" in the JBoss AS Getting Started Guide available <a href="https://community.jboss.org/wiki/JBossAS5InstallationAndGettingStartedGuide">here</a>.</p>
</div>
<div class="paragraph">
<p>You must make sure <code>log4j</code> is fine tuned for optimal performance in production.
We recommend that you set logging threshold to <code>WARN</code> and let the CDR appender be <code>DEBUG</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_ss7"><a class="anchor" href="#_configuring_ss7"></a>6.5. Configuring the SS7 Stack</h3>
<div class="paragraph">
<p>You must configure the SS7 Stack prior to configuring USSD.
For details on configuring the SS7 Stack please refer to the Mobicents SS7 Stack User Guide.
The Mobicents SS7 Stack User Guide lists all available Shell commands and GUI operations to configure SS7.
In addition, help files are also available for every Shell command providing all details relevant to the command.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_ussd_gw"><a class="anchor" href="#_configuring_ussd_gw"></a>6.6. Configuring the USSD Gateway</h3>
<div class="paragraph">
<p>Once you have configured the SS7 Stack you can continue with USSD configuration using the CLI tool or the GUI.
In order to use the CLI you must follow the instructions specified in <a href="#_running_shell">Running the Shell</a> to run the shell and connect to the managed instance.
Alternatively you can use the GUI to configure the USSD Gateway through simple GUI operations.
The GUI will allow you to manage your USSD Gateway efficiently using an user-friendly interface.
Open a Web Browser, navigate to <a href="http://localhost:8080/mobicents-management/" class="bare">http://localhost:8080/mobicents-management/</a> and switch to the 'USSD GW' tab.</p>
</div>
<div class="paragraph">
<p>You must first set appropriate values for the below USSD parameters and then configure USSD Routing Rules for short codes.
You can do these using the CLI tool or the GUI.</p>
</div>
<div class="dlist">
<div class="title">USSD Parameters</div>
<dl>
<dt class="hdlist1">noroutingruleconfigerrmssg</dt>
<dd>
<p>Message shown to end user if USSD Gateway is not configured for the dialed shortcode.</p>
</dd>
<dt class="hdlist1">dialogtimeouterrmssg</dt>
<dd>
<p>Error message shown to user when request timesout.</p>
</dd>
<dt class="hdlist1">servererrmssg</dt>
<dd>
<p>The error message shown to user when something goes wrong on the USSD gateway.</p>
</dd>
<dt class="hdlist1">dialogtimeout</dt>
<dd>
<p>The maximum time allowed by the Gateway for the	application to respond.</p>
</dd>
<dt class="hdlist1">cdrloggingto</dt>
<dd>
<p>If CDR should be logged to Database or Textfile</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>If the USSD Gateway will be used for network push as well, the following parameters should also be configured:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ussdgt</dt>
<dd>
<p>USSD Gateway Global Title.</p>
</dd>
<dt class="hdlist1">ussdssn</dt>
<dd>
<p>Sub-System Number (SSN) for USSD Gateway.</p>
</dd>
<dt class="hdlist1">hlrssn</dt>
<dd>
<p>HLR&#8217;s Sub-System Number (SSN).</p>
</dd>
<dt class="hdlist1">mscssn</dt>
<dd>
<p>MSC&#8217;s Sub-System Number (SSN).</p>
</dd>
<dt class="hdlist1">maxmapv</dt>
<dd>
<p>Value of MAP Application Context version (for SendRoutingInfo operation).</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_set_noroutingruleconfigerrmssg"><a class="anchor" href="#_set_noroutingruleconfigerrmssg"></a>6.6.1. No Routing Rule Configured Error Message</h4>
<div class="sect4">
<h5 id="_set_noroutingruleconfigerrmssg_cli"><a class="anchor" href="#_set_noroutingruleconfigerrmssg_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'No Routing Rule Configured Error Message' by issuing the command <code>ussd set noroutingruleconfigerrmssg</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set noroutingruleconfigerrmssg

SYNOPSIS
	ussd set noroutingruleconfigerrmssg &lt;message&gt;

DESCRIPTION
	This command is used to set the message to be displayed to the end user if the
	USSD Gateway is not configured for the dialled short code. For example, if the
	dialled short code is *345#, but the USSD Gateway is not configured with an
	appropriate routing rule for this code, then the message displayed to the
	end user will be the value set for the parameter 'noroutingruleconfigerrmssg'.

EXAMPLES
	ussd set noroutingruleconfigerrmssg Not valid short code. Please dial valid
	short code.

	The above command will set the value of the parameter
	'noroutingruleconfigerrmssg' as "Not valid short code. Please dial valid short
	code." and the terminal will display the message "Parameter has been successfully
	set".

	You can verify this by issuing the 'ussd get noroutingruleconfigerrmssg' command
	whose output will be as below:

	ussd get noroutingruleconfigerrmssg
	noroutingruleconfigerrmssg = Not valid short code. Please dial valid short code</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_noroutingruleconfigerrmssg_gui"><a class="anchor" href="#_set_noroutingruleconfigerrmssg_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set No Routing Rule Configured Error Message using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'Error Messages' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'No routing rule configured error message', you can enter any message to be displayed to the end user if the USSD Gateway is not configured for the dialled short code.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_dialogtimeouterrmssg"><a class="anchor" href="#_set_dialogtimeouterrmssg"></a>6.6.2. Dialog Timeout Error Message</h4>
<div class="sect4">
<h5 id="_set_dialogtimeouterrmssg_cli"><a class="anchor" href="#_set_dialogtimeouterrmssg_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'Dialog Timeout Error Message' by issuing the command <code>ussd set dialogtimeouterrmssg</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set dialogtimeouterrmssg

SYNOPSIS
	ussd set dialogtimeouterrmssg &lt;message&gt;

DESCRIPTION
	This command is used to set the error message to be displayed to the end user
	when a request timeout occurs. For example, if the dialed short code is *123#, and
	the USSD Gateway is configured to route this request to a third party application
	'xyz' but the application 'xyz' takes longer than the time specified by the
	value of the parameter 'dialogtimeout' to respond, then the USSD Gateway will kill
	the session and send an error message to be displayed to the user. This error
	message displayed to the end user will be the value set for the parameter
	'dialogtimeouterrmssg'.

EXAMPLES
	ussd set dialogtimeouterrmssg Request timedout please try again after
	sometime.

	The above command will set the value of the parameter 'dialogtimeouterrmssg' as
	"Request timedout please try again after sometime." and the terminal will display
	the message "Parameter has been successfully set".

	You can verify this by issuing
	the 'ussd get dialogtimeouterrmssg' command whose output will be as below:

	ussd get dialogtimeouterrmssg
	dialogtimeouterrmssg = Request timedout please try again after sometime</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_dialogtimeouterrmssg_gui"><a class="anchor" href="#_set_dialogtimeouterrmssg_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set Dialog Timeout Error Message using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'Error Messages' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'Dialog timeout error message', you can set the error message to be displayed to the end user when a request timeout occurs.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_servererrmssg"><a class="anchor" href="#_set_servererrmssg"></a>6.6.3. Server Error Message</h4>
<div class="sect4">
<h5 id="_set_servererrmssg_cli"><a class="anchor" href="#_set_servererrmssg_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'Server Error Message' by issuing the command <code>ussd set servererrmssg</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set servererrmssg

SYNOPSIS
	ussd set servererrmssg &lt;message&gt;

DESCRIPTION
	This command is used to set the message to be displayed to the end user when there
	is an error in the USSD Gateway. For example if the application server
	responds to the Gateway's request with a NOT OK (200) response or with an OK
	response but the XML Payload is corrupt, then the USSD Gateway will kill the
	session and send a Server error message to be displayed to the end user specified
	by the value of this paramter 'servererrmssg'.

EXAMPLES
	ussd set servererrmssg Server error, please try again after sometime

	The above command will set the value for the parameter 'servererrmssg' to "Server
	error, please try again after sometime" and the terminal will display the message
	"Parameter has been successfully set".

	You can verify this by issuing the
	'ussd get servererrmssg' command whose output will be as below:

	ussd get servererrmssg
	servererrmssg = Server error, please try again after sometime</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_servererrmssg_gui"><a class="anchor" href="#_set_servererrmssg_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set Server Error Message using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'Error Messages' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'Server error message', you can set the message to be displayed to the end user when there is an error in the USSD Gateway.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_dialogtimeout"><a class="anchor" href="#_set_dialogtimeout"></a>6.6.4. Dialog Timeout</h4>
<div class="sect4">
<h5 id="_set_dialogtimeout_cli"><a class="anchor" href="#_set_dialogtimeout_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'Dialog Timeout' value by issuing the command <code>ussd set dialogtimeout</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set dialogtimeout

SYNOPSIS
	ussd set dialogtimeout &lt;timeout-value&gt;

DESCRIPTION
	This command is used to set the request timeout duration in milliseconds.
	For	example, the end user dials the short code *123#, and the USSD
	Gateway is configured to route this request to a third party application
	'xyz'. The value of the parameter 'dialogtimeout' is the maximum time
	allowed by the Gateway for the application 'xyz' to respond. If the
	application 'xyz' takes longer than the time specified by the value of
	the parameter 'dialogtimeout' to respond, then the USSD Gateway will kill
	the session and send an error message to be displayed to the user.
	Pay attention that "Dialog Timeout" can not be bigger than TCAP Dialog
	timeout value (that equals by default 1 minute by default). If you want to
	setup "Dialog Timeout" value you have to care also for TCAP Dialog timeout.
	Look at "TCAP" chapture of Mobicents jSS7 Stack User Guide.

EXAMPLES
	ussd set dialogtimeout 25000

	The above command will set the value of the parameter 'dialogtimeout' to  25000
	milliseconds and the terminal will display the message "Parameter has been
	successfully set".

	You can verify this by issuing the 'ussd get dialogtimeout' command whose
	output will be as below:

	ussd get dialogtimeout
	dialogtimeout = 25000</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_dialogtimeout_gui"><a class="anchor" href="#_set_dialogtimeout_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set Dialog Timeout using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'Various' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'Dialog Timeout', you can set the request timeout duration in milliseconds.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_hrhlrnumber"><a class="anchor" href="#_set_hrhlrnumber"></a>6.6.5. Special HLR addressing</h4>
<div class="sect4">
<h5 id="_set_hrhlrnumber_cli"><a class="anchor" href="#_set_hrhlrnumber_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'HLR address' (for SRI) to be used if SMSC is also present and configured in Home Routing mode, by issuing the command <code>ussd set hrhlrnumber</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set hrhlrnumber

SYNOPSIS
	ussd set hrhlrnumber &lt;hlr GT digits&gt;

DESCRIPTION
	This command is used to set the HLR address to be used, instead of MSISDN, to
	be included in the 'calledPartyAddress' field of the SCCP address in the
	'SendRoutingInfo' message (PUSH mode). This parameter is required in scenarios
	when the SMSC GW is also configured, specifically in Home Routing mode.
	If this parameter is not set the default value is '-1' implying MSISDN address
	will be used.

EXAMPLES
	ussd set hrhlrnumber 9823232322

	The above command will set the value of the parameter 'hrhlrnumber' to
	9823232322. You can verify this by issuing the 'ussd get hrhlrnumber' command.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_hrhlrnumber_gui"><a class="anchor" href="#_set_hrhlrnumber_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set HLR (for SRI) using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'Various' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'HLR Address', you can set the HLR GT digits to be used instead of MSISDN.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_set_cdrlogging"><a class="anchor" href="#_set_cdrlogging"></a>6.6.6. CDR logging - Database / Textfile</h4>
<div class="sect4">
<h5 id="_set_cdrlogging_cli"><a class="anchor" href="#_set_cdrlogging_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can switch between Database and Textfile for CDR logging, by setting the 'cdrloggingto' value issuing the command <code>ussd set cdrloggingto</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set cdrloggingto

SYNOPSIS
	ussd set cdrloggingto &lt;Database | Textfile&gt;

DESCRIPTION
	This command is used to set CDR logging to either Database or Textfile.
	By default, the value is Textfile and all transactions are logged to a
	plain text file.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_set_cdrlogging_gui"><a class="anchor" href="#_set_cdrlogging_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set CDR logging using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'Various' tab in the GUI.</p>
</li>
<li>
<p>You can set the 'CDR logging to' value as required.
You can switch between Database and plain Textfile by setting this parameter appropriately.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_gt"><a class="anchor" href="#_setting_ussd_gt"></a>6.6.7. USSD Global Title</h4>
<div class="sect4">
<h5 id="_setting_ussd_gt_cli"><a class="anchor" href="#_setting_ussd_gt_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'USSD Global Title' by issuing the command <code>ussd set ussdgt</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set ussdgt

SYNOPSIS
	ussd set ussdgt &lt;globalTitle&gt; networkid &lt;networkId&gt;

DESCRIPTION
	This command is used to set a value for USSD Global Title.

	networkId - a specifies Global Title for a virtual SS7
	subnetwork (this is for Multi-tenancy support). By using of
	this command with different networkIds you can specify
	Global Titles for several subnetworks.
	If this parameter is skipped - networkId will be set to "0"
	when Global Title creation (master networkId).
	When we do not specify Global Title for some networkid -
	Global Title for master networkId will be used. When we
	use "0" as Global Title value
	(like "ussd set ussdgt 0 networkid &lt;xxx&gt;") -
	this will just clear Global Title for an specified networkid.

EXAMPLES
	ussd set ussdgt 912020015
	ussd set ussdgt 912020015 networkid 2

	The above command will set the value for the parameter 'globalTitle' to
	'912020015'and the terminal will display the message
	"Parameter has been successfully set".
	The first command assigns ussdgt for networkId=0,
	the second command assigns ussdgt for networkId=2

	You can verify this by issuing the 'ussd get ussdgt' command.

	ussd get ussdgt
	ussdgt = 912020015</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_gt_gui"><a class="anchor" href="#_setting_ussd_gt_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set USSD Gateway Global Title using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'SS7 Settings' tab in the GUI.</p>
</li>
<li>
<p>You can specify the USSD Global Title by entering values into fields pair 'USSD Gateway Global Title Indicator Network Id' and 'USSD Gateway Global Title'. You are able to set Global Title for definite networkId.
Setting of Global Title for networkId to "0" leads clearing of Global Title for networkId.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_ssn"><a class="anchor" href="#_setting_ussd_ssn"></a>6.6.8. USSD Sub System Number</h4>
<div class="sect4">
<h5 id="_setting_ussd_ssn_cli"><a class="anchor" href="#_setting_ussd_ssn_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'USSD Sub System Number' by issuing the command <code>ussd set ussdssn</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set ussdssn

SYNOPSIS
	ussd set ussdssn &lt;ussdSubSystemNumber&gt;

DESCRIPTION
	This command is used to set the value for USSD Sub System Number (SSN). Issuing
	this command in CLI will set the SSN value but you must ensure that the SSN value
	is properly configured in the TCAP Stack in the xml descriptor file
	'mobicents-ussdgateway-version/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/
	 mobicents-ussd-gateway/META-INF/jboss-beans.xml'

EXAMPLES
	ussd set ussdssn 6

	The above command will set the value for the parameter 'ussdSubSystemNumber' to
	'6'and the terminal will display the message
	"Parameter has been successfully set".

	You can verify this by issuing the 'ussd get ussdssn' command.

	ussd get ussdssn
	ussdssn = 6</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_ssn_gui"><a class="anchor" href="#_setting_ussd_ssn_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set USSD Sub System Number (SSN) using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'SS7 Settings' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'USSD Gateway subsystem number', you can set a value for USSD Sub System Number (SSN). Issuing this command in CLI will set the SSN value but you must ensure that the SSN value is properly configured in the TCAP Stack in the xml descriptor file <em class="path">mobicents-ussdgateway-version/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/mobicents-ussd-gateway/META-INF/jboss-beans.xml</em>.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_hlrssn"><a class="anchor" href="#_setting_ussd_hlrssn"></a>6.6.9. HLR Sub System Number</h4>
<div class="sect4">
<h5 id="_setting_ussd_hlrssn_cli"><a class="anchor" href="#_setting_ussd_hlrssn_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'HLR Sub System Number' by issuing the command <code>ussd set hlrssn</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set hlrssn

SYNOPSIS
	ussd set hlrssn &lt;hlrSubSystemNumber&gt;

DESCRIPTION
	This command is used to set the value for HLR Sub System Number (SSN).

EXAMPLES
	ussd set hlrssn 7

	The above command will set the value for the parameter 'hlrSubSystemNumber' to
	'7'and the terminal will display the message
	"Parameter has been successfully set".

	You can verify this by issuing the 'ussd get hlrssn' command.

	ussd get hlrssn
	hlrssn = 7</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_hlrssn_gui"><a class="anchor" href="#_setting_ussd_hlrssn_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set HLR Sub System Number (SSN) using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'SS7 Settings' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'HLR subsystem number', you can set a value for HLR Sub System Number (SSN). For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_mscssn"><a class="anchor" href="#_setting_ussd_mscssn"></a>6.6.10. MSC Sub System Number</h4>
<div class="sect4">
<h5 id="_setting_ussd_mscssn_cli"><a class="anchor" href="#_setting_ussd_mscssn_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'MSC Sub System Number' by issuing the command <code>ussd set mscssn</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set mscssn

SYNOPSIS
	ussd set mscssn &lt;mscSubSystemNumber&gt;

DESCRIPTION
	This command is used to set the value for MSC Sub System Number (SSN).

EXAMPLES
	ussd set mscssn 8

	The above command will set the value for the parameter 'mscSubSystemNumber' to
	'8'and the terminal will display the message
	"Parameter has been successfully set".

	You can verify this by issuing the 'ussd get mscssn' command.

	ussd get mscssn
	mscssn = 8</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_mscssn_gui"><a class="anchor" href="#_setting_ussd_mscssn_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set MSC Sub System Number (SSN) using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'SS7 Settings' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'MSC subsystem number', you can set a value for MSC Sub System Number (SSN). For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_maxmapv"><a class="anchor" href="#_setting_ussd_maxmapv"></a>6.6.11. MAP Application Context version</h4>
<div class="sect4">
<h5 id="_setting_ussd_maxmapv_cli"><a class="anchor" href="#_setting_ussd_maxmapv_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can set the 'MAP Application Context version' by issuing the command <code>ussd set maxmapv</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd set maxmapv

SYNOPSIS
	ussd set maxmapv &lt;version-number&gt;

DESCRIPTION
	This command is used to set the value for MAP Application Context version. The
	version number set here will be used for SendRoutingInfo operation.
	Mobicents USSD Gateway supports version negotiation.  So if you set this to a
	higher version (say for example version 2, however your network only understands
	version 1), the ussd Gateway will automatically do the version negotiation and
	exchange V1 messages when V2 exchange fails. However this causes additional
	messages to be exchanged and increases the overall load on the system.
	Therefore it is advisable to always set the correct version.

EXAMPLES
	ussd set maxmapv 3

	The above command will set the value for the parameter 'version-number' to
	'3'and the terminal will display the message
	"Parameter has been successfully set".

	You can verify this by issuing the 'ussd get maxmapv' command.

	ussd get maxmapv
	maxmapv = 3</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_maxmapv_gui"><a class="anchor" href="#_setting_ussd_maxmapv_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Set MAP Application Context version using the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Server Settings' in the left panel.</p>
</li>
<li>
<p>The main panel will display the existing Server Settings (if any), segregated into three tabs: Error Messages, SS7 Settings, Various.
Switch to the 'SS7 Settings' tab in the GUI.</p>
</li>
<li>
<p>In the text field 'MAP version supported', you can set a value for MAP Application Context version.
The version number set here will be used for USSD messages exchanged.
For more details of this parameter, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>You must click on the button 'Apply Changes' to save your settings.
If there is an error in setting the value, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_routing_rules_show"><a class="anchor" href="#_setting_ussd_routing_rules_show"></a>6.6.12. View USSD Rules</h4>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_show_cli"><a class="anchor" href="#_setting_ussd_routing_rules_show_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can view the details of all or specified configured routing rules in the USSD Gateway by issuing the command <code>ussd scrule show</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd scrule show

SYNOPSIS
	ussd scrule show &lt;short-code&gt; &lt;networkid&gt;

DESCRIPTION
	This command is used to view the details of all or specified configured
	routing rules in the USSD Gateway.
	If you run a CLI command without &lt;short-code&gt; and &lt;networkid&gt; parameters,
	then all rules will be displayed. If you specify both &lt;short-code&gt; and
	&lt;networkid&gt; parameters, then the rule for the specified short code and
	the networkid if such rule is configured. If you specify only
	&lt;short-code&gt; parameter, then the rule for the specified short code and
	networkid==0 if such rule is configured.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_show_gui"><a class="anchor" href="#_setting_ussd_routing_rules_show_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: View USSD Routing Rule</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Routing Rule' in the left panel.
The main panel will display the existing Short Code Routing Rules (if any) in a tabular format.</p>
</li>
<li>
<p>To refresh the Short Code list, you must click on the green 'refresh' button at the top.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_routing_rules_create"><a class="anchor" href="#_setting_ussd_routing_rules_create"></a>6.6.13. Create new USSD Rule</h4>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_create_cli"><a class="anchor" href="#_setting_ussd_routing_rules_create_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can create a new USSD Routing Rule for every possible short code by issuing the command <code>ussd scrule create</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd scrule create

SYNOPSIS
	ussd scrule create &lt;short-code&gt; &lt;url&gt; &lt;flag&gt; &lt;protocol&gt; &lt;network-id&gt;

DESCRIPTION
	This command is used to create a new routing rule for a short code for
	PULL case only. This is not applicable for PUSH case.
	You can create a separate routing rule for an equal short code for each
	networkId. This means that a short code and networkId pair is used as a
	routing rule identifier.

PARAMETERS
	Standard Parameters

	short-code  - USSD short code which when dialed by user and received
				by USSD Gw, will forward request to configured URL

	url			- If rule is configured as HTTP, this should be the URL
				where HTTP POST with XML payload should be forwarded to.
				If rule is configured as SIP, INVITE will be sent to this
				ip:port

    Optional Parameters

	flag		- flag is either true or false, default is true. If true that
				means this is exact match between the configured short code and the
				dialed by subscriber value. If false, that means the dialed
				short-code begins with configured short-code. For example
				if you created below rule, and user dials *123*7776543*223#,
				it will match the rule and request will be forwarded to the
				URL http://myip:8080/mobiussd/recharge.

				ussd scrule create *123* http://myip:8080/mobiussd/recharge false

	protocol	- USSD Gateway supports 2 protocols - HTTP and SIP (3GPP
				Specification 24.390). If not specified default is HTTP.
				If protocol is HTTP, gateway will forward request as HTTP POST.
				If its SIP, INVITE will be sent SIP Client.

	networkid	- USSD Gateway can be connected to multiple operators/network
				at same time and each operator exposing same or different short-code.
				Each operator (jSS7 stack configured) has its unique networkid assigned
				and incoming request can be matched with configured networkid here.
				Only if short-code and networkid match's, request is forwarded to
				corresponding url. Default value is 0.

EXAMPLES
    ussd scrule create *519# http://localhost:8080/ussddemo/test

	The above command will create a new routing rule in the USSD Gateway for
	the short code *519#. When the user dials the short code *519#, the USSD
	Gateway will direct the HTTP POST request to the URL
	http://localhost:8080/ussddemo/test as specified by the routing rule.
	This rule will belong to the default networkId 0.

    ussd scrule create *916* http://localhost:8080/ussddemo/test2 true HTTP 2

	The above command will create a new routing rule in the USSD Gateway for
	the short codes that are started from *916*.
	Gateway will direct the HTTP POST request to the URL
	http://localhost:8080/ussddemo/test2 as specified by the routing rule.
	This rule will belong to the networkId 2.

    ussd scrule create *123* 127.0.0.1:5065 true SIP

	The above command will create a new routing rule in the USSD Gateway for
	the short codes that are started from *123*.
	Gateway will direct the SIP INVITE request to 127.0.0.1:5065.
	This rule will belong to the default networkId 0.

    ussd scrule create *321# 127.0.0.1:5066 SIP 4

	The above command will create a new routing rule in the USSD Gateway for
	the short code *321#.
	Gateway will direct the SIP INVITE request to 127.0.0.1:5066.
	This rule will belong to the networkId 4.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_create_gui"><a class="anchor" href="#_setting_ussd_routing_rules_create_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Create new USSD Routing Rule</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Routing Rule' in the left panel.
The main panel will display the existing Short Code Routing Rules (if any) in a tabular format.</p>
</li>
<li>
<p>To create a new Routing Rule, click on the 'Create Rule' button.</p>
</li>
<li>
<p>Enter the values for Short Code, Rule Type (HTTP / SIP), URL or SIP Proxy, Exact Match (Yes/No) and Network ID.
For more details of these parameters, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>Click on the 'Create' button to create a new USSD Routing Rule with values as specified.
If there is an error in creating the Rule, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_routing_rules_modify"><a class="anchor" href="#_setting_ussd_routing_rules_modify"></a>6.6.14. Modify an existing USSD Rule</h4>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_modify_cli"><a class="anchor" href="#_setting_ussd_routing_rules_modify_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can modify an existing USSD Routing Rule for by issuing the command <code>ussd scrule modify</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd scrule modify

SYNOPSIS
    ussd scrule modify &lt;short-code&gt; &lt;url&gt; &lt;flag&gt; &lt;protocol&gt; &lt;network-id&gt;

DESCRIPTION
	This command is used to modify a new routing rule for a short code for
	PULL case only. This is not applicable for PUSH case.
	A short code and networkId pair is used as a unique routing rule identifier.

PARAMETERS
	Standard Parameters

	short-code	- USSD short code which when dialed by user and received
				by USSD Gw, will forward request to configured URL

	url			- If rule is configured as HTTP, this should be the URL
				where HTTP POST with XML payload should be forwarded to.
				If rule is configured as SIP, INVITE will be sent to this
				ip:port

    Optional Parameters

	flag		- flag is either true or false, default is true. If true that
				means this is exact match between the configured short code and the
				dialed by subscriber value. If false, that means the dialed
				short-code begins with configured short-code. For example
				if you created below rule, and user dials *123*7776543*223#,
				it will match the rule and request will be forwarded to the
				URL http://myip:8080/mobiussd/recharge.

				ussd scrule create *123* http://myip:8080/mobiussd/recharge false

	protocol	- USSD Gateway supports 2 protocols - HTTP and SIP (3GPP
				Specification 24.390). If not specified default is HTTP. If
				protocol is HTTP, gateway will forward request as HTTP POST.
				If its SIP, INVITE will be sent SIP Client.

    networkid	- USSD Gateway can be connected to multiple operators/network at same time
				and each operator exposing same or different short-code. Each operator
				(jSS7 stack configured) has its unique networkid assigned and incoming
				request can be matched with configured networkid here. Only if short-code
				and networkid match's, request is forwarded to corresponding url. Default
				value is 0.

EXAMPLES
    ussd scrule modify *519# http://localhost:8080/ussddemo/test

    Above rule will update the routing rule for the short code *519# and
    networkId 0 for HTTP url http://localhost:8080/ussddemo/test and the
    matching flag "false".

    ussd scrule modify *916* http://localhost:8080/ussddemo/test2 true HTTP 2

    Above rule will update the routing rule for the short code *916* and
    networkId 2 for HTTP url http://localhost:8080/ussddemo/test2 and the
    matching flag "true".

    ussd scrule modify *123* 127.0.0.1:5065 true SIP

    Above rule will update the routing rule for the short code *123* and
    networkId 0 for SIP destination 127.0.0.1:5065 and the matching flag
    "true".

    ussd scrule modify *321# 127.0.0.1:5066 SIP 4

    Above rule will update the routing rule for the short code *321# and
    networkId 4 for SIP destination 127.0.0.1:5066 and the matching flag
    "false".</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_modify_gui"><a class="anchor" href="#_setting_ussd_routing_rules_modify_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Modify an existing USSD Routing Rule</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Routing Rule' in the left panel.
The main panel will display the existing Short Code Routing Rules (if any) in a tabular format.</p>
</li>
<li>
<p>To modify an existing Routing Rule, click on the 'Modify Rule' button (blue button).</p>
</li>
<li>
<p>Enter the values for Rule Type (HTTP / SIP), URL or SIP Proxy, Exact Match (Yes/No) and Network Id.
For more details of these parameters, please refer to the description of the CLI command for the same in the preceding section.</p>
</li>
<li>
<p>Click on the 'Modify' button to create a new USSD Routing Rule with values as specified.
If there is an error in creating the Rule, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_setting_ussd_routing_rules_delete"><a class="anchor" href="#_setting_ussd_routing_rules_delete"></a>6.6.15. Delete USSD Rule</h4>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_delete_cli"><a class="anchor" href="#_setting_ussd_routing_rules_delete_cli"></a>Using CLI</h5>
<div class="paragraph">
<p>You can delete an existing USSD Routing Rule by issuing the command <code>ussd scrule delete</code> with appropriate parameters as described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>Name
	ussd scrule delete

SYNOPSIS
	ussd scrule delete &lt;short-code&gt; &lt;networkid&gt;

DESCRIPTION
	This command is used to delete an existing routing rule for a short code .
	A short code and networkId pair is used as a unique routing rule identifier.

	Standard Parameters

	short-code	- USSD short code which when dialed by user and received
				by USSD Gw, will forward request to configured URL

	Optional Parameters

	networkid	- USSD Gateway can be connected to multiple operators/network at
				same time and each operator exposing same or different short-code.
				Each operator (jSS7 stack configured) has its unique networkid assigned
				and incoming request can be matched with configured networkid here.
				Only if short-code and networkid match's, request is forwarded to
				corresponding url. Default value is 0.

EXAMPLES
	ussd scrule delete *519#

	The above command will delete the routing rule in the USSD Gateway for the
	short code *519# and network-id 0.

	ussd scrule delete *519# 1

	The above command will delete the routing rule in the USSD Gateway for the
	short code *519# and network-id 1.</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_setting_ussd_routing_rules_delete_gui"><a class="anchor" href="#_setting_ussd_routing_rules_delete_gui"></a>Using GUI</h5>
<div class="olist arabic">
<div class="title">Procedure: Delete USSD Routing Rule</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Routing Rule' in the left panel.
The main panel will display the existing Short Code Routing Rules (if any) in a tabular format.</p>
</li>
<li>
<p>Locate the row corresponding to the Short Code Routing Rule you wish to delete.</p>
</li>
<li>
<p>Click on the 'x' (delete) button in the Actions column of the row corresponding to the Rule you wish to delete.
If there is an error in deleting the Rule, then you will find the details of the error in the Management Console Log section below.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_configuring_ussd_simulator_profile"><a class="anchor" href="#_configuring_ussd_simulator_profile"></a>6.7. Simulator Profile</h3>
<div class="paragraph">
<p>The Restcomm USSD GATEWAY offers you an option to run the Gateway with a "simulator" profile for testing purpose.
The "simulator" profile is a pre-configured profile to work with the jss7-simulator.
The USSD GATEWAY in a Simulator profile is pre-configured as if you have configured it using the following CLI commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>sctp server create serv1 127.0.0.1 8012 sockettype SCTP
sctp server start serv1
sctp association create ass1 SERVER serv1 127.0.0.1 8011 sockettype SCTP

m3ua as create as1 IPSP mode SE ipspType server rc 101 traffic-mode loadsharing network-appearance 102
m3ua asp create asp1 ass1
m3ua as add as1 asp1
m3ua asp start asp1
m3ua route add as1 1 2 3

sccp sap create 1 1 2 2
sccp dest create 1 1 1 1 0 255 255
sccp address create 1 82 1 8 0 1 4 000
sccp address create 2 82 2 8 0 1 4 000
sccp rule create 1 K 82 0 8 0 1 4 * solitary 1 origination-type localOriginated
sccp rule create 2 K 82 0 8 0 1 4 * solitary 2 origination-type remoteOriginated
sccp rsp create 1 1 0 0
sccp rss create 1 1 8 0

ussd set dialogtimeout 25000
ussd set ussdgt 923330053058
ussd set ussdssn 8
ussd set hlrssn 6
ussd set mscssn 8
ussd set maxmapv 3

ussd scrule create *519# http://127.0.0.1:8080/ussddemo/test true HTTP
ussd scrule create *518# http://127.0.0.1:5080 true SIP</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_http_architecture"><a class="anchor" href="#_http_architecture"></a>7. HTTP Transfer Mechanism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Restcomm USSD GATEWAY supports implementation of HTTP 1.1 standards and acts as a HTTP Client invoking the HTTP Application deployed on the third-party Application Server.
The <code>HTTP Request/Response</code> carries XML payload with USSD specific information.</p>
</div>
<div class="paragraph">
<p>The HTTP callback mechanism allows the third-party Application to be agnostic to Operating System, Programming Language and Framework.
The third-party Application could be one of the following technologies on any Operating System:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Apache Tomcat, JBoss AS, Oracle Application Server, IBM Websphere etc for JSP/Servlet on Java</p>
</li>
<li>
<p>PHP</p>
</li>
<li>
<p>Microsoft IIS for ASP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>HTTP errors are supported and recognized by the USSD GATEWAY</p>
</div>
<div class="sect2">
<h3 id="http_messages_ussd_pull"><a class="anchor" href="#http_messages_ussd_pull"></a>7.1. HTTP Message Structure - USSD Pull</h3>
<div class="paragraph">
<p>The diagram below depicts an example message sequence for interacting with the Restcomm USSD GATEWAY HTTP API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/http-call-flow-USSD-Pull.png" alt="http call flow USSD Pull">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When the subscriber initiates a USSD Request, the HLR sends a <code>MAP_PROCESS_UNSTRUCTURED_SS_REQUEST</code> to the USSD Gateway.</p>
</li>
<li>
<p>Upon receipt of the <code>MAP_PROCESS_UNSTRUCTURED_SS_REQUEST</code> of type <code>Begin</code>, USSD GATEWAY  invokes the third-party Application through a <code>HTTP POST Request</code>, carrying an XML Payload with USSD specific information.
The XML Structure of this payload is explained in the sections below.</p>
</li>
<li>
<p>The third-party Application will now get a new Session and maintain it till the last response.
The Application will send a <code>HTTP Response</code>, carrying an XML Payload, to the USSD GATEWAY .</p>
</li>
<li>
<p>The USSD GATEWAY will send a <code>MAP_UNSTRUCTURED_SS_REQUEST</code> of type <code>Continue</code> to the HLR.</p>
</li>
<li>
<p>The Subscriber will receive a menu to choose from and reply.
When the subscriber replies, the HLR will send a <code>MAP_UNSTRUCTURED_SS_RESPONSE</code> of type <code>Continue</code> to the USSD GATEWAY .</p>
</li>
<li>
<p>The USSD GATEWAY will send a <code>HTTP POST Request</code>, carrying an XML Payload, to the third-party Application in the same session.</p>
</li>
<li>
<p>Based on the input from the subscriber, the third-party Application will send a final response (<code>HTTP Response</code>, carrying an XML Payload) and invalidate the session.</p>
</li>
<li>
<p>The USSD GATEWAY will send a <code>MAP_PROCESS_UNSTRUCTURED_SS_RESPONSE</code> of type <code>End</code> to the HLR.
Consequently, the subscriber will receive a final response.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_http_messages_ussd_push"><a class="anchor" href="#_http_messages_ussd_push"></a>7.2. HTTP Message Structure - USSD Push</h3>
<div class="paragraph">
<p>For USSD PUSH, the third party application should send a HTTP POST request to the Restcomm USSD GATEWAY .
The URL for sending this is <a href="http://&lt;bind" class="bare">http://&lt;bind</a> address of JBoss&gt;:8080/mobicents.
The diagram below depicts an example message sequence (USSD Push) for interacting with the Restcomm USSD GATEWAY HTTP API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/http-call-flow-USSD-Push.png" alt="http call flow USSD Push">
</div>
</div>
</div>
<div class="sect2">
<h3 id="http-payload"><a class="anchor" href="#http-payload"></a>7.3. HTTP Payload</h3>
<div class="sect3">
<h4 id="xml-structure"><a class="anchor" href="#xml-structure"></a>7.3.1. XML Structure</h4>
<div class="paragraph">
<p>The <code>HTTP Request</code>/<code>Response</code> carries XML Payload with USSD specific information as defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dialog type="Begin" appCntx="networkUnstructuredSsContext_version2"
	networkId="0" localId="1" remoteId="1" mapMessagesSize="1"
	returnMessageOnError="false"&gt;
	....
	....
	....
&lt;/dialog&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_attributes"><a class="anchor" href="#_attributes"></a>7.3.2. Dialog Attributes</h4>
<div class="paragraph">
<p>The XML element <code>&lt;dialog&gt;</code> contains various attributes to represent the state and the parameters of the Dialog.
Some of them are mandatory while others are optional.
This section explains in detail all possible attributes and what they represent.
The list of mandatory attributes that a USSD application must supply will be described for an each concrete response.</p>
</div>
<div class="dlist">
<div class="title">Parameters</div>
<dl>
<dt class="hdlist1">type</dt>
<dd>
<p>Represents the state of the Dialog.
This parameter is for information only and is not used by the USSD GATEWAY to take any decision on the fate of the underlying MAP Dialog.
The possible values for 'type' are: <code>Unidirectional, Begin, End, Continue, Abort, Unknown.</code>				You do not need to supply this parameter in payload from HTTP App.</p>
</dd>
<dt class="hdlist1">appCntx</dt>
<dd>
<p>Represents the MAP Application Context for USSD GW request.
Now it always "networkUnstructuredSsContext_version2". You do not need to supply this parameter in payload from HTTP App.
For outgoung USSD operations it is always networkUnstructuredSsContext version 2.
For outgoing SRI request an initial MAP operation version is defined by the 'maxmapv' parameter configured in <a href="#_setting_ussd_maxmapv">MAP Application Context version</a>.</p>
</dd>
<dt class="hdlist1">networkId</dt>
<dd>
<p>Represents a networkId value.
USSD Gateway can be connected to multiple operators/network at same time.
For each operator unique networkId is assigned.
In the initial PUSH (unstructuredSS-Request or unstructuredSS-Notify) message HTTP app can specify networkId parameter for forsing of usage of desired network operator.
If this value is missed then the default value ("0") will be used.</p>
</dd>
<dt class="hdlist1">localId</dt>
<dd>
<p>Represents the local TCAP transaction ID.
You do not need to supply this parameter in payload from HTTP App because localId values for all outgoing MAP dialogs is assigned by TCAP stack itself.
All subsequent messages from the USSD Gateway will have the actual value.</p>
</dd>
<dt class="hdlist1">remoteId</dt>
<dd>
<p>Represents the remote TCAP transaction ID.
You do not need to supply this parameter in payload from HTTP App.</p>
</dd>
<dt class="hdlist1">mapMessagesSize</dt>
<dd>
<p>Represents the actual number of MAP messages carried in the &lt;dialog&gt;. This value can be 0 if no MAP messages are carried or 1 when a USSD message is present.
This parameter is mandatory in payload from HTTP App and is usually "1" when you are sending a message or "0" for an empty TC-END response in PUSH case.</p>
</dd>
<dt class="hdlist1">returnMessageOnError</dt>
<dd>
<p>For USSD GW originated XMP payload this parameter corresponds to SCCP message returnMessageOnError parameter.
You can supply this parameter in payload from HTTP App.
This will affect to outgoing SCCP messages.
(SCCP will return the notification is the message has non been delivered to the peer). Mostly we do not need to specify this parameter.
By default this is true.</p>
</dd>
<dt class="hdlist1">prearrangedEnd</dt>
<dd>
<p>This parameter can only be present in payload from HTTP App.
If this parameter is present, it means the underlying TCAP Dialog will be closed.
The value can be true or false.
If it is false, the messages will be sent to peer and the TCAP dialog ended.
If it is true, all the messages in the Dialog are dropped and the Dialog is closed without informing peer.
If this parameter is not present, all the messages in the Dialog are sent to peer as TCAP Continue.
If you do not want to close dialog this step do not include this parameter.
If you want to close dialog this step include this parameter with value "false".</p>
</dd>
<dt class="hdlist1">mapAbortProviderReason</dt>
<dd>
<p>If this parameter is present, it means the underlying Dialog is Provider Aborted.
The example below will describe in detail:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dialog type="Unknown" localId="12" remoteId="13" mapMessagesSize="0"
mapAbortProviderReason="SupportingDialogueTransactionReleased"
returnMessageOnError="false"&gt;
	&lt;errComponents/&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The possible values for <code>mapAbortProviderReason</code> are <code>ProviderMalfunction, SupportingDialogueTransactionReleased, ResourceLimitation, MaintenanceActivity, VersionIncompatibility, AbnormalMAPDialogueLocal, AbnormalMAPDialogueFromPeer</code> and <code>InvalidPDU</code>.
  You do not need to supply this parameter in payload from HTTP App.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">mapRefuseReason</dt>
<dd>
<p>If this parameter is present, it means the underlying Dialog is refused by peer.
The example below will describe in detail:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dialog type="Unknown" localId="12" remoteId="13" mapMessagesSize="0"
mapRefuseReason="NoReasonGiven" returnMessageOnError="false"&gt;
	&lt;errComponents/&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The possible values for <code>mapRefuseReason</code> are <code>ApplicationContextNotSupported, InvalidDestinationReference, InvalidOriginatingReference, NoReasonGiven, RemoteNodeNotReachable</code> and <code>PotentialVersionIncompatibility</code>.
  You do not need to supply this parameter in payload from HTTP App.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">mapUserAbortChoice</dt>
<dd>
<p>If this parameter is present, it means peer user has aborted Dialog.
The example below will describe in detail:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dialog type="Unknown" localId="12" remoteId="13" mapMessagesSize="0"
mapUserAbortChoice="isUserSpecificReason" returnMessageOnError="false"&gt;
	&lt;errComponents/&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The possible values for <code>mapUserAbortChoice</code> are <code>isProcedureCancellationReason_handoverCancellation, isProcedureCancellationReason_radioChannelRelease, isProcedureCancellationReason_networkPathRelease, isProcedureCancellationReason_callRelease,
  isProcedureCancellationReason_associatedProcedureFailure, isProcedureCancellationReason_tandemDialogueRelease, isProcedureCancellationReason_remoteOperationsFailure, isResourceUnavailableReason_shortTermResourceLimitation, isResourceUnavailableReason_longTermResourceLimitation, isUserResourceLimitation</code> and <code>isUserSpecificReason</code>.
  Even the HTTP App can Abort a specific Dialog by setting this value and sending it to the USSD Gateway.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">dialogTimedOut</dt>
<dd>
<p>If this parameter is present, it means the underlying TCAP Dialog has timedout.
The deafult value of TCAP Dialog timeout should always be greater than USSD Timeout value set in <a href="#_set_dialogtimeout">Dialog Timeout</a>.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;dialog type="Unknown" localId="12" remoteId="13" mapMessagesSize="0" dialogTimedOut="true"
returnMessageOnError="false"&gt;
	&lt;errComponents/&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You do not need to supply this parameter in payload from HTTP App.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">emptyDialogHandshake</dt>
<dd>
<p>This parameter can only be present in payload from HTTP App.
This is used only when USSD gateway is initiating Dialog (Push case).  This parameter indicates that USSD Gateway should firstly send empty dialog  (without USSD Payload) and only once dialog is accepted by peer,  USSD message should be sent.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dialog mapMessagesSize="1" emptyDialogHandshake="true"&gt;
...
...
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">customInvokeTimeOut</dt>
<dd>
<p>This parameter can only be present in payload from HTTP App.
Each MAP operation has its own default invoke timeout, for example for the unstructuredSS-Request MAP operation default invoke timeout is 10 min.
HTTP App can set custom invoke timeout for each USSD message it sends to other end by using of this parameter (value is in milliseconds).</p>
</dd>
<dt class="hdlist1">invokeTimedOut</dt>
<dd>
<p>This parameter indicates the invoke sent by USSD Gw has timed out.
This generally means user has taken longer than expected to respond to USSD message.
HTTP App can set custom invoke timeout for each ussd message by setting  customInvokeTimeOut explained above.
Once invoke timesout, USSD gateway will  automatically abort the Dialog and send corresponding message to HTTP App.
You do not need to supply this parameter in payload from HTTP App.</p>
</dd>
<dt class="hdlist1">userObject</dt>
<dd>
<p>Application can set some user specific String value that the USSD gateway  will always send back in corresponding messages exchanged:</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dialog type="Continue" appCntx="networkUnstructuredSsContext_version2"
localId="12" remoteId="13" mapMessagesSize="1" returnMessageOnError="false"
userObject="123456789"&gt;
....
....
&lt;/dialog&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="child-elements"><a class="anchor" href="#child-elements"></a>7.3.3. Child Elements</h4>
<div class="paragraph">
<p>The element &lt;dialog&gt; may contain any of these child elements but the order has to be respected.
The possible child elements and the order to be followed, if present, must be as in the below list:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>SCCP Address</p>
</li>
<li>
<p>AddressString</p>
</li>
<li>
<p>Error Components</p>
</li>
<li>
<p>processUnstructuredSSRequest_Request</p>
</li>
<li>
<p>processUnstructuredSSRequest_Response</p>
</li>
<li>
<p>unstructuredSSRequest_Request</p>
</li>
<li>
<p>unstructuredSSRequest_Response</p>
</li>
<li>
<p>unstructuredSSNotify_Request</p>
</li>
<li>
<p>unstructuredSSNotify_Response</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_child_sccp_address"><a class="anchor" href="#_child_sccp_address"></a>SCCP Address</h5>
<div class="paragraph">
<p>Dialog carries SCCP information like &lt;localAddress&gt;, which is the SCCP Address of USSD gateway and &lt;remoteAddress&gt;, which is the SCCP address from where the Dialog is initiated, in case if this Dialog is received from other side (USSD Pull) or SCCP Address of remote side, incase of USSD Gateway acting as Proxy.</p>
</div>
<div class="paragraph">
<p>Both the elements are optional and if they are not passed, the USSD Gateway will get the values from the Global Title configured from <a href="#_setting_ussd_gt">USSD Global Title</a> for &lt;localAddress&gt;. If the USSD Gateway is acting as proxy, it mandatory to set the &lt;remoteAddress&gt;, else this parameter is ignored.</p>
</div>
<div class="paragraph">
<p>Attributes of SCCP (localAddress and remoteAddress) address are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>pc: Mandatory parameter.
Represents the point code.</p>
</li>
<li>
<p>ssn: Mandatory parameter.
Represents the Sub System Number.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Child elements of SCCP Address are &lt;ai&gt; and &lt;gt&gt;, where &lt;ai&gt; is Address indicator and suggests if routing is based on PC + SSN or GT.
If it is based on GT, include &lt;gt&gt; element.</p>
</div>
<div class="paragraph">
<p>Please refer to the examples below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>a) Routing based on PC + SSN

	&lt;localAddress pc="1" ssn="8"&gt;
		&lt;ai value="67"/&gt;
	&lt;/localAddress&gt;

b) Routing based on GT
	&lt;localAddress pc="0" ssn="146"&gt;
		&lt;ai value="18"/&gt;
		&lt;gt type="GlobalTitle0100" tt="0" es="2" np="1" nai="4" digits="9960639902"/&gt;
	&lt;/localAddress&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Different Gloabl Titles are <code>GlobalTitle0001</code>, <code>GlobalTitle0010</code>, <code>GlobalTitle0011</code> and <code>GlobalTitle0100</code>.
For more details about SCCP, please refer to the jSS7 Admin Guide included in the documentation.</p>
</div>
</div>
<div class="sect4">
<h5 id="_child_address_string"><a class="anchor" href="#_child_address_string"></a>AddressString</h5>
<div class="paragraph">
<p>Dialog carries the AddressString information like &lt;destinationReference&gt; and &lt;originationReference&gt;. The attributes of AddressString are defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>"nai" : nature of address indicator. The values are
	0 : unknown
	1 : international_number
	2 : national_significant_number
	3 : network_specific_number
	4 : subscriber_number
	5 : reserved
	6 : abbreviated_number
	7 : reserved_for_extension

"npi" : Numbering plan. The values are
	0 : unknown
	1 : ISDN
	2 : spare_2
	3 : data
	4 : telex
	5 : spare_5
	6 : land_mobile
	7 : spare_7
	8 : national
	9 : private_plan
	15 : reserved

"number" : The actual number

The XML example is
&lt;destinationReference number="204208300008002" nai="international_number" npi="land_mobile"/&gt;
&lt;originationReference number="204208300008002" nai="international_number" npi="ISDN"/&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_errorcomponents"><a class="anchor" href="#_errorcomponents"></a>Error Components</h5>
<div class="paragraph">
<p>If peer reports <code>ErrorComponents</code>, same is forwarded to the Application through the child element <code>&lt;errComponents/&gt;</code>.
The example of payload is:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;dialog type="End" networkId="0" localId="0" remoteId="0" mapMessagesSize="0" sriPart="true" emptyDialogHandshake="true" returnMessageOnError="false"&gt;
	&lt;errComponents&gt;
		&lt;invokeId value="1"/&gt;
		&lt;errorComponent type="MAPErrorMessageAbsentSubscriberSM" errorCode="6"&gt;
			&lt;absentSubscriberDiagnosticSM value="IMSIDetached"/&gt;
		&lt;/errorComponent&gt;
	&lt;/errComponents&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="processunstructuredssrequest_request"><a class="anchor" href="#processunstructuredssrequest_request"></a>processUnstructuredSSRequest_Request</h5>
<div class="paragraph">
<p>This message is always sent by the USSD Gateway to the Application as a HTTP POST request or from the Application to the USSD Gateway if it is acting as Proxy.
The Application should always send back <code>processUnstructuredSSResponse</code> indicating that it is the last message of this dialog or can also send <code>unstructuredSSRequest</code> indicating that the Application is expecting more response from the user (menu structure).</p>
</div>
<div class="paragraph">
<p>The Attributes of <code>processUnstructuredSSRequest_Request</code> are defined below:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>"invokeId" : All message types have the mandatory <code>invokeId</code> attribute helping to relate the response to request.
For example, <code>processUnstructuredSSResponse</code> will have the same <code>invokeId</code> as carried by <code>processUnstructuredSSRequest</code>.
Hence if the Application has a multi-level menu, it should store the <code>invokeId</code>, received in the <code>processUnstructuredSSRequest</code> in a HTTP Session, for later use.
Also for every new request in the same dialog, <code>invokeId</code> should be incremented by 1.
For example when the Application sends <code>unstructuredSSRequest</code> to a received <code>processUnstructuredSSRequest</code> with <code>invokeId</code> equal to zero, it should set the <code>invokeId</code> equal to 1 in <code>unstructuredSSRequest</code>.</p>
</li>
<li>
<p>"dataCodingScheme" : The Attribute <code>dataCodingScheme</code> is mandatory and represents the actual USSD Message. <code>dataCodingScheme</code> is the encoding parameter of the USSD Message.</p>
</li>
<li>
<p>"string" : The Attribute <code>string</code> is mandatory and represents the USSD String length.
In GSM 0902 160, octets are stated as the maximum length for the USSD String.
However due to underlying signalling layers the maximum length of the USSD string depends on the message and can be less than 160.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The XML structure is defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;processUnstructuredSSRequest_Request invokeId="0" dataCodingScheme="15" string="*234#"&gt;
	&lt;msisdn nai="international_number" npi="ISDN" number="79273605819"/&gt;
	&lt;alertingPattern size="1"&gt;
		&lt;value value="6"/&gt;
	&lt;/alertingPattern&gt;
&lt;/processUnstructuredSSRequest_Request&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Child elements of <code>processUnstructuredSSRequest_Request</code> are &lt;msisdn&gt; and &lt;alertingPattern&gt;. The child element &lt;msisdn&gt; is optional and included only if the actual MAP message received by the USSD Gateway carries this value.
This is MSISDN of the user who originated this request.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If &lt;msisdn&gt; is not included in processUnstructuredSSRequest, originationReference will be included in the dialog and this will be the MSISDN of the user originating the request.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>&lt;alertingPattern&gt; is also an optional attribute.</p>
</div>
</div>
<div class="sect4">
<h5 id="processunstructuredssrequest_response"><a class="anchor" href="#processunstructuredssrequest_response"></a>processUnstructuredSSRequest_Response</h5>
<div class="paragraph">
<p>This message is always sent by the Application to the USSD GateWay as a response to the received <code>processUnstructuredSSRequest</code> or <code>unstructuredSSResponse</code>.
If the USSD Gateway is acting as Proxy, this message is sent from the USSD Gateway to the Application.
This should always be the last message in the dialog.</p>
</div>
<div class="paragraph">
<p>The XML structure is defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;processUnstructuredSSRequest_Response invokeId="0" dataCodingScheme="15" string="Thank You!"/&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="unstructuredssrequest_request"><a class="anchor" href="#unstructuredssrequest_request"></a>unstructuredSSRequest_Request</h5>
<div class="paragraph">
<p>This message is sent by the Application to the USSD GateWay in response to the received <code>processUnstructuredSSRequest</code> or <code>unstructuredSSResponse</code> in case of USSD Pull.
In case of USSD Push, the Application can send this message to initiate a tree based menu push.
This indicates that the Application is expecting some response from the user.
If the USSD Gateway is acting as Proxy, this message is sent by the USSD Gateway to the Application.</p>
</div>
<div class="paragraph">
<p>The XML structure is defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;unstructuredSSRequest_Request invokeId="0" dataCodingScheme="15" string="USSD String : Hello World&amp;#10; 1. Balance&amp;#10; 2. Texts Remaining"/&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="unstructuredssrequest_response"><a class="anchor" href="#unstructuredssrequest_response"></a>unstructuredSSRequest_Response</h5>
<div class="paragraph">
<p>This message is sent by the USSD GateWay to the Application in HTTP POST request.
This is a response to <code>unstructuredSSRequest</code> sent by the Application earlier.
If the USSD Gateway acts as proxy, this message is sent by the Application to the USSD Gateway in response to <code>unstructuredSSRequest_Request</code> received by the Application.</p>
</div>
<div class="paragraph">
<p>The XML structure is defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;unstructuredSSRequest_Response invokeId="0" dataCodingScheme="15" string="1"/&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="unstructuredssnotify_request"><a class="anchor" href="#unstructuredssnotify_request"></a>unstructuredSSNotify_Request</h5>
<div class="paragraph">
<p>This message is sent by the Application to the USSD GateWay to initiate USSD Push.
This is just to notify the user and no input is expected back from the user.
If the USSD Gateway is acting as proxy, this message is sent by USSD Gateway to the Application.</p>
</div>
<div class="paragraph">
<p>The XML structure is defined below:</p>
</div>
</div>
<div class="sect4">
<h5 id="unstructuredssnotify_response"><a class="anchor" href="#unstructuredssnotify_response"></a>unstructuredSSNotify_Response</h5>
<div class="paragraph">
<p>This message is sent by the USSD Gateway to the Application in response to <code>unstructuredSSNotify_Request</code> sent by the Application.
If the USSD Gateway is acting as proxy, the Application will send this message to the USSD Gateway.</p>
</div>
<div class="paragraph">
<p>The XML structure is defined below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;unstructuredSSRequest_Response invokeId="0"/&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="using-non-latin-menu"><a class="anchor" href="#using-non-latin-menu"></a>Using non-Latin menu</h5>
<div class="paragraph">
<p>If you wish to send non-Latin text (example, Cyrillic, Arabic, etc) then you must set the value of the attribute <code>dataCodingScheme</code> to "72" (unlike the case of latin/digits where this is set to 15). You must ensure that any message text that contains non-Latin symbols must be UTF-8 encoded.
The entire length of the message (in characters) must be less because this uses 2-byte encoding per character.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xml_payload_examples"><a class="anchor" href="#_xml_payload_examples"></a>7.3.4. Typical usage of USSD application originated XML payload.</h4>
<div class="paragraph">
<p>For USSD PULL case, a USSD application can usually issue following messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PROCESS_UNSTRUCTURED_SS_RESPONSE</p>
</li>
<li>
<p>UNSTRUCTURED_SS_REQUEST</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For USSD PUSH case, a USSD application can usually issue following messages:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>UNSTRUCTURED_NOTIFY_REQUEST</p>
</li>
<li>
<p>UNSTRUCTURED_SS_REQUEST</p>
</li>
<li>
<p>RELEASE COMPLETE - finishing of a dialog</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>We will discuss few payload examples in this section.</p>
</div>
<div class="sect4">
<h5 id="_xml_payload_examples_process_unstructured_ss_response"><a class="anchor" href="#_xml_payload_examples_process_unstructured_ss_response"></a>PULL case - PROCESS_UNSTRUCTURED_SS_RESPONSE</h5>
<div class="paragraph">
<p>Payload example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;dialog mapMessagesSize="1" prearrangedEnd="false"&gt;
  &lt;processUnstructuredSSRequest_Response invokeId="1" dataCodingScheme="15" string="Your balance is 1 USD"/&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This message must finish PULL Dialog so we set "prearrangedEnd="false"". For USSD GW a count of internal messages is always 1, but this field is mandatory and we have to include it into a payload: mapMessagesSize="1". You have to also set "invokeId="1"" record which must be equal invokeId from processUnstructuredSSRequest_Request.
"dataCodingScheme" value is usually "15" (GSM7 encoding) or "72" (USC2 encoding). "string" is USSD string value.
Pay attention that as for GSM specification USSD string length has maximum length 182 characters for GSM7 coding and 80 characters for USC2 encoding.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xml_payload_examples_unstructured_ss_request"><a class="anchor" href="#_xml_payload_examples_unstructured_ss_request"></a>PULL case - UNSTRUCTURED_SS_REQUEST</h5>
<div class="paragraph">
<p>Payload example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;dialog mapMessagesSize="1"&gt;
  &lt;unstructuredSSRequest_Request dataCodingScheme="15" string="Press 1 for paying or press 2 for aborting"/&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>This message will continue PULL Dialog.
"userObject" attribute is optional.
You can use it for identification puposes.
This value will be return to USSD application with the all next xml payloads.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xml_payload_examples_unstructured_notify_request"><a class="anchor" href="#_xml_payload_examples_unstructured_notify_request"></a>PUSH case - UNSTRUCTURED_NOTIFY_REQUEST</h5>
<div class="paragraph">
<p>Payload example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;dialog mapMessagesSize="1"&gt;
  &lt;unstructuredSSNotify_Request dataCodingScheme="15" string="Your new balance is 34.38 AFN and expires on 30.07.2012. Cost of last event was 0.50 AFN."&gt;
    &lt;msisdn nai="international_number" npi="ISDN" number="11111111111111"/&gt;
  &lt;/unstructuredSSNotify_Request&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>You are initiating a PUSH dialog.
We need to include "msisdn" parameter which identifies a destination subscriber phone number (nai is "Nature of address", npi means "Numeric plan"). "msisdn" parameter must be included only in the first unstructuredSSNotify_Request or unstructuredSSRequest_Request of the PUSH dialog.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xml_payload_examples_push_unstructured_ss_request"><a class="anchor" href="#_xml_payload_examples_push_unstructured_ss_request"></a>PUSH case - UNSTRUCTURED_SS_REQUEST</h5>
<div class="paragraph">
<p>Payload example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;dialog mapMessagesSize="1"&gt;
  &lt;unstructuredSSRequest_Request dataCodingScheme="15" string="Press 1 for paying or press 2 for aborting"&gt;
    &lt;msisdn nai="international_number" npi="ISDN" number="5444444444"/&gt;
  &lt;/unstructuredSSRequest_Request&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_xml_payload_examples_release_complete"><a class="anchor" href="#_xml_payload_examples_release_complete"></a>PUSH case - RELEASE COMPLETE - finishing dialog</h5>
<div class="paragraph">
<p>Payload example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;dialog mapMessagesSize="0" prearrangedEnd="false"&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>PUSH dialog can include one or more UNSTRUCTURED_NOTIFY_REQUEST or UNSTRUCTURED_SS_REQUEST.
After this USSD application must finish the dialog by this payload.
PUSH dialog always uses several HTTP request to create, continue and terminatie it.
For successfull processing it is needed to use a http cookie JSESSIONID.
First http response contains a session cookie like "Set-Cookie: JSESSIONID=1379BF8AF4DB8CACF444AEA6375AD85E; Path=/mobicents". Every next request must contain a tag like: "Cookie: JSESSIONID=1379BF8AF4DB8CACF444AEA6375AD85E" Every request (UNSTRUCTURED_SS_REQUEST and UNSTRUCTURED_NOTIFY_REQUEST) can contain extra parameter "customInvokeTimeout" in the dialog section to set up a custom invoke timeout (in milliseconds). For example (for 10 minutes invoke timeout):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;dialog mapMessagesSize="1" customInvokeTimeout="600000"&gt;
  &lt;unstructuredSSRequest_Request dataCodingScheme="15" string="Press 1 for paying or press 2 for aborting"&gt;
    &lt;msisdn nai="international_number" npi="ISDN" number="5444444444"/&gt;
  &lt;/unstructuredSSRequest_Request&gt;
&lt;/dialog&gt;</pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sip_architecture"><a class="anchor" href="#_sip_architecture"></a>8. SIP Transfer Mechanism</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Restcomm USSD GATEWAY supports implementation of Session Initiation Protocol (SIP) for using Unstructured Supplementary Service Data (USSD) operations for mobile initiated MMI mode over IP Multimedia Core Network Subsystem (IMS). 3GPP Specification 24.390 "Unstructured Supplementary Service Data (USSD) using IP  Multimedia (IM) Core Network (CN) subsystem IMS" further explains flow of USSD over IMS leveraging SIP.</p>
</div>
<div class="paragraph">
<p>Restcomm USSD GATEWAY can easily be integarted with Restcomm RestComm via SIP to enable developers to rapidly build voice, video, WebRTC, USSD, SMS, fax and rich messaging applications.
More details about RestComm can be obtained from <a href="http://www.telestax.com/restcomm/">here</a></p>
</div>
<div class="paragraph">
<p>Following sections shows SIP flow and integration with RestComm.
Instead of RestComm, user can easily integrate SIP phone that supports USSD.</p>
</div>
<div class="sect2">
<h3 id="_sip_messages_ussd_pull"><a class="anchor" href="#_sip_messages_ussd_pull"></a>8.1. SIP Message Structure - USSD Pull</h3>
<div class="paragraph">
<p>The diagram below depicts an example message sequence for interacting with the Restcomm USSD GATEWAY SIP API.
Belowflow assumes that third-party application sends back tree based menu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/SIP-RestComm-Flow-Pull-Case1.png" alt="SIP RestComm Flow Pull Case1">
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When the subscriber initiates a USSD Request, the HLR sends a <code>MAP_PROCESS_UNSTRUCTURED_SS_REQUEST</code> to the USSD Gateway.</p>
</li>
<li>
<p>Upon receipt of the <code>MAP_PROCESS_UNSTRUCTURED_SS_REQUEST</code> of type <code>Begin</code>, USSD GATEWAY  invokes the third-party Application through a <code>SIP INVITE Request</code>, carrying an XML Payload with USSD specific information.
The XML Structure of this payload is explained in the sections below.</p>
<div class="listingblock">
<div class="content">
<pre>					&lt;ussd-data&gt;
    					&lt;language&gt;en&lt;/language&gt;
    					&lt;ussd-string&gt;*123#&lt;/ussd-string&gt;
    					&lt;anyExt&gt;
       						&lt;message-type&gt;processUnstructuredSSRequest_Request&lt;/message-type&gt;
     					&lt;/anyExt&gt;
					&lt;/ussd-data&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>The <code>To</code> Header of <code>SIP INVITE Request</code> carries MSISDN from where the USSD request is initiated.</p>
</div>
</li>
<li>
<p>The third-party Application will send SIP OK and after receiving SIP ACK, SIP Dialog is established between USSD Gateway and Application</p>
<div class="paragraph">
<p>The third-party Application will then send <code>SIP INFO Request</code>, carrying an XML Payload with USSD specific information.
The XML Structure of this payload is explained in the sections below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>					&lt;ussd-data&gt;
    					&lt;language&gt;en&lt;/language&gt;
    					&lt;ussd-string&gt;Press 1 for SMS Credit and 2 for Call Credit&lt;/ussd-string&gt;
    					&lt;anyExt&gt;
       						&lt;message-type&gt;unstructuredSSRequest_Request&lt;/message-type&gt;
     					&lt;/anyExt&gt;
					&lt;/ussd-data&gt;</pre>
</div>
</div>
</li>
<li>
<p>The USSD GATEWAY will send a <code>MAP_UNSTRUCTURED_SS_REQUEST</code> of type <code>Continue</code> to the HLR.</p>
</li>
<li>
<p>The Subscriber will receive a menu to choose from and reply.
When the subscriber replies, the HLR will send a <code>MAP_UNSTRUCTURED_SS_RESPONSE</code> of type <code>Continue</code> to the USSD GATEWAY .</p>
</li>
<li>
<p>The USSD GATEWAY will send a <code>SIP INFO Request</code>, carrying an XML Payload, to the third-party Application in the same session.
The XML Structure of this payload is explained in the sections below.</p>
<div class="listingblock">
<div class="content">
<pre>					&lt;ussd-data&gt;
    					&lt;language&gt;en&lt;/language&gt;
    					&lt;ussd-string&gt;1&lt;/ussd-string&gt;
    					&lt;anyExt&gt;
       						&lt;message-type&gt;unstructuredSSRequest_Response&lt;/message-type&gt;
     					&lt;/anyExt&gt;
					&lt;/ussd-data&gt;</pre>
</div>
</div>
</li>
<li>
<p>Based on the input from the subscriber, the third-party Application will send a final (<code>SIP BYE Request</code>, carrying an XML Payload) and invalidate the session.</p>
<div class="listingblock">
<div class="content">
<pre>					&lt;ussd-data&gt;
    					&lt;language&gt;en&lt;/language&gt;
    					&lt;ussd-string&gt;Balance is 87 sms's&lt;/ussd-string&gt;
    					&lt;anyExt&gt;
       						&lt;message-type&gt;processUnstructuredSSRequest_Response&lt;/message-type&gt;
     					&lt;/anyExt&gt;
					&lt;/ussd-data&gt;</pre>
</div>
</div>
</li>
<li>
<p>The USSD GATEWAY will send a <code>MAP_PROCESS_UNSTRUCTURED_SS_RESPONSE</code> of type <code>End</code> to the HLR.
Consequently, the subscriber will receive a final response.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_sip_messages_ussd_pull_notree"><a class="anchor" href="#_sip_messages_ussd_pull_notree"></a>8.2. SIP Message Structure - USSD Pull - Without Tree Menu</h3>
<div class="paragraph">
<p>The diagram below depicts an example message sequence (USSD PULL) without tree based menu for interacting with the Restcomm USSD GATEWAY SIP API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/SIP-RestComm-Flow-Pull-Case2.png" alt="SIP RestComm Flow Pull Case2">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_sip_messages_ussd_push_case3"><a class="anchor" href="#_sip_messages_ussd_push_case3"></a>8.3. SIP Message Structure - USSD Push - With Tree Menu</h3>
<div class="paragraph">
<p>The diagram below depicts an example message sequence (USSD Push) for interacting with the Restcomm USSD GATEWAY SIP API.
Below example initiate USSD Tree based menu.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/SIP-RestComm-Flow-Push-Case3.png" alt="SIP RestComm Flow Push Case3">
</div>
</div>
<div class="paragraph">
<p>The <code>To</code> Header of <code>SIP INVITE Request</code> carries MSISDN to which the USSD PUSH request is initiated.</p>
</div>
</div>
<div class="sect2">
<h3 id="_sip_messages_ussd_push_case4"><a class="anchor" href="#_sip_messages_ussd_push_case4"></a>8.4. SIP Message Structure - USSD Push - Without Tree Menu</h3>
<div class="paragraph">
<p>The diagram below depicts an example message sequence (USSD Push) for interacting with the Restcomm USSD GATEWAY SIP API for USSD Notify.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="./images/SIP-RestComm-Flow-Push-Case4.png" alt="SIP RestComm Flow Push Case4">
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_xml_parser"><a class="anchor" href="#_xml_parser"></a>9. XML Parser API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Restcomm USSD GATEWAY exposes easy to use Java framework to serialize and deserialize the MAP messages.
So if you are using Java Servlets for your business logic, this framework will make it very easy to compose your business logic.
However using this framework is not mandatory and you are free to create your own XML parser.</p>
</div>
<div class="sect2">
<h3 id="_mvn_dependency"><a class="anchor" href="#_mvn_dependency"></a>9.1. Maven dependency</h3>
<div class="paragraph">
<p>If you are using maven to build your project define following dependencies to use XML Framework in your project</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">		&lt;dependency&gt;
			&lt;groupId&gt;org.mobicents.ussd&lt;/groupId&gt;
			&lt;artifactId&gt;xml&lt;/artifactId&gt;
			&lt;version&gt;6.1.5.GA&lt;/version&gt;
		&lt;/dependency&gt;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Note</div>
<div class="paragraph">
<p>Mobicents maintains the archieve in private repository.
please add the following in your pom&#8217;s repositories tag</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml">		&lt;repository&gt;
		  &lt;id&gt;mobicents-releases-repository&lt;/id&gt;
		  &lt;name&gt;Mobicents Releases Repository&lt;/name&gt;
		  &lt;url&gt;http://telestax.artifactoryonline.com/telestax/releases&lt;/url&gt;
		  &lt;releases&gt;
		    &lt;enabled&gt;true&lt;/enabled&gt;
		    &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
		  &lt;/releases&gt;
		  &lt;snapshots&gt;
		    &lt;enabled&gt;false&lt;/enabled&gt;
		    &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
		  &lt;/snapshots&gt;
		&lt;/repository&gt;
		&lt;repository&gt;
		  &lt;id&gt;mobicents-snapshots-repository&lt;/id&gt;
		  &lt;name&gt;Mobicents Snapshots Repository&lt;/name&gt;
		  &lt;url&gt;http://telestax.artifactoryonline.com/telestax/snapshots&lt;/url&gt;
		  &lt;releases&gt;
		    &lt;enabled&gt;false&lt;/enabled&gt;
		    &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
		  &lt;/releases&gt;
		  &lt;snapshots&gt;
		    &lt;enabled&gt;true&lt;/enabled&gt;
		    &lt;updatePolicy&gt;never&lt;/updatePolicy&gt;
		  &lt;/snapshots&gt;
		&lt;/repository&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">Important</div>
<div class="paragraph">
<p>Mobicents Releases and Snapshots Repository are password protected.
Ask support to get your password.</p>
</div>
<div class="paragraph">
<p>Once you have user name and password add following to your servers definition in your maven settings located in M2_HOME/conf/settings.xml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-xml" data-lang="xml"> 	&lt;server&gt;
      &lt;id&gt;mobicents-releases-repository&lt;/id&gt;
      &lt;username&gt;xxx&lt;/username&gt;
      &lt;password&gt;xxx&lt;/password&gt;
    &lt;/server&gt;
    &lt;server&gt;
      &lt;id&gt;mobicents-snapshots-repository&lt;/id&gt;
      &lt;username&gt;xxx&lt;/username&gt;
      &lt;password&gt;xxx&lt;/password&gt;
    &lt;/server&gt;</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_simple_tree_based_example"><a class="anchor" href="#_simple_tree_based_example"></a>9.2. Simple example - Tree based Menu</h3>
<div class="paragraph">
<p>Below is the simple <code class="class">HttpServlet</code> example to create a tree based menu structure.
The flow of message is same as shown in  <a href="#http_messages_ussd_pull">Restcomm  HTTP message flow</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">	public class TestServlet extends HttpServlet {

	private static final Logger logger = Logger.getLogger(TestServlet.class);

	private EventsSerializeFactory factory = null;

	@Override
	public void init() {
			factory = new EventsSerializeFactory();
	}

	@Override
	public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException {

	}

	@Override
	public void doPost(HttpServletRequest request, HttpServletResponse response) throws IOException {
		ServletInputStream is = request.getInputStream();
		try {
			Dialog original = factory.deserialize(is);
			HttpSession session = request.getSession(true);
			if (logger.isInfoEnabled()) {
				logger.info("doPost. HttpSession=" + session.getId() + " Dialog = " + original);
			}

			USSDString ussdStr = null;
			byte[] data = null;
			final FastList&lt;MAPMessage&gt; capMessages = original.getMAPMessages();

			MessageType messageType = original.getTCAPMessageType();

			// This is initial request, if its not NTFY, we need session
			for (FastList.Node&lt;MAPMessage&gt; n = capMessages.head(), end = capMessages
					.tail(); (n = n.getNext()) != end;) {
				final MAPMessage rawMessage = n.getValue();
				final MAPMessageType type = rawMessage.getMessageType();

				switch (messageType) {

					case Begin:
					switch (mapMessage.getMessageType()) {
						case processUnstructuredSSRequest_Request:
							ProcessUnstructuredSSRequest processUnstructuredSSRequest = (ProcessUnstructuredSSRequest) mapMessage;
							CBSDataCodingScheme cbsDataCodingScheme = processUnstructuredSSRequest
								.getDataCodingScheme();
							if (logger.isInfoEnabled()) {
								logger.info("Received ProcessUnstructuredSSRequestIndication USSD String="
										+ processUnstructuredSSRequest.getUSSDString().getString());
							}

							session.setAttribute(
								"ProcessUnstructuredSSRequest_InvokeId",
								processUnstructuredSSRequest.getInvokeId());

							//You business logic here and finally send back response

							//Urdu
							//CBSDataCodingScheme cbsDataCodingSchemeUrdu = new  CBSDataCodingSchemeImpl(72);
							//ussdStr = new USSDStringImpl("\u062C\u0645\u064A\u0639 \u0627\u0644\u0645\u0633\u062A\u0639\u0645\u0644\u064A\u0646 \u0627\u0644\u0622\u062E\u0631\u064A\u0646 \u062A\u0645 \u0625\u0636\u0627\u0641\u062A\u0647\u0645",
							//		cbsDataCodingSchemeUrdu, null);
							//UnstructuredSSRequest unstructuredSSRequestIndication = new UnstructuredSSRequestImpl(
							//		cbsDataCodingSchemeUrdu, ussdStr, null, null);

							//English

							ussdStr = new USSDStringImpl(
								"USSD String : Hello World\n 1. Balance\n 2. Texts Remaining",
								cbsDataCodingScheme, null);
							UnstructuredSSRequest unstructuredSSRequestIndication = new UnstructuredSSRequestImpl(
								cbsDataCodingScheme, ussdStr, null, null);

							original.reset();
							original.setTCAPMessageType(MessageType.Continue);
							original.addMAPMessage(unstructuredSSRequestIndication);

							data = factory.serialize(copy);

							response.getOutputStream().write(data);
							response.flushBuffer();

							break;
						default:
							// This is error. If its begin it should be only Process
							// Unstructured SS Request
							logger.error("Received Dialog BEGIN but message is not ProcessUnstructuredSSRequestIndication. Message="
									+ mapMessage);
							break;
						}

					break;
					case Continue:
					switch (type) {
					case unstructuredSSRequest_Response:
						UnstructuredSSResponse unstructuredSSResponse = (UnstructuredSSResponseImpl) rawMessage;

						CBSDataCodingScheme cbsDataCodingScheme = unstructuredSSResponse
								.getDataCodingScheme();

						long invokeId = (Long) session
								.getAttribute("ProcessUnstructuredSSRequest_InvokeId");

						USSDString ussdStringObj = unstructuredSSResponse
								.getUSSDString();
						String ussdString = null;
						if (ussdStringObj != null) {
							ussdString = ussdStringObj.getString(null);
						}

						logger.info("Received UnstructuredSSResponse USSD String="
								+ ussdString
								+ " HttpSession="
								+ session.getId() + " invokeId=" + invokeId);

						cbsDataCodingScheme = new CBSDataCodingSchemeImpl(0x0f);
						ussdStr = new USSDStringImpl("Thank You!", null, null);
						ProcessUnstructuredSSResponse processUnstructuredSSResponse = new ProcessUnstructuredSSResponseImpl(
								cbsDataCodingScheme, ussdStr);
						processUnstructuredSSResponse.setInvokeId(invokeId);

						original.reset();
						original.setTCAPMessageType(MessageType.End);
						original.addMAPMessage(processUnstructuredSSResponse);
						original.close(false);

						data = factory.serialize(original);

						response.getOutputStream().write(data);
						response.flushBuffer();

						try {
							session.invalidate();
						} catch (Exception e) {
							session.invalidate();
							logger.error("Error while invalidating HttpSession="
									+ session.getId());
						}
						break;
					default:
						// This is error. If its begin it should be only Process
						// Unstructured SS Request
						logger.error("Received Dialog CONTINUE but message is not UnstructuredSSResponseIndication. Message="
								+ rawMessage);
						break;
					}

					break;

				case ABORT:
					// The Dialog is aborted, lets do cleaning here

					try {
						session.invalidate();
					} catch (Exception e) {
						session.invalidate();
						logger.error("Error while invalidating HttpSession=" + session.getId());
					}
					break;
			}

		} catch (XMLStreamException e) {
			logger.error("Error while processing received XML", e);
		}

	}
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="eventsserializefactory"><a class="anchor" href="#eventsserializefactory"></a>9.3. EventsSerializeFactory</h3>
<div class="paragraph">
<p>This section provides the details for <code class="class">EventsSerializeFactory</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class EventsSerializeFactory {

	private static final String DIALOG = "dialog";
	private static final String TYPE = "type";
	private static final String TAB = "\t";

	final XMLBinding binding = new XMLBinding();

	public EventsSerializeFactory() {
		binding.setAlias(Dialog.class, DIALOG);
		binding.setClassAttribute(TYPE);
	}

	/**
	 * Serialize passed {@link Dialog} object
	 *
	 * @param dialog
	 * @return serialized byte array
	 * @throws XMLStreamException
	 *             Exception if serialization fails
	 */
	public byte[] serialize(Dialog dialog) throws XMLStreamException {

		final ByteArrayOutputStream baos = new ByteArrayOutputStream();
		final XMLObjectWriter writer = XMLObjectWriter.newInstance(baos);

		try {

			writer.setBinding(binding);
			writer.setIndentation(TAB);

			writer.write(dialog, DIALOG, Dialog.class);
			writer.flush();
			byte[] data = baos.toByteArray();

			return data;
		} finally {
			writer.close();
		}
	}

	/**
	 * De-serialize the byte[] into {@link Dialog} object
	 *
	 * @param data
	 * @return de-serialized Dialog Object
	 * @throws XMLStreamException
	 *             Exception if de-serialization fails
	 */
	public Dialog deserialize(byte[] data) throws XMLStreamException {
		final ByteArrayInputStream bais = new ByteArrayInputStream(data);
		final XMLObjectReader reader = XMLObjectReader.newInstance(bais);
		try {
			Dialog dialog = reader.read(DIALOG, Dialog.class);
			return dialog;
		} finally {
			reader.close();
		}
	}

	/**
	 * De-serialize passed {@link InputStream} into {@link Dialog} object
	 *
	 * @param is
	 * @return de-serialized Dialog Object
	 * @throws XMLStreamException
	 *             Exception if de-serialization fails
	 */
	public Dialog deserialize(InputStream is) throws XMLStreamException {
		final XMLObjectReader reader = XMLObjectReader.newInstance(is);
		try {
			Dialog dialog = reader.read(DIALOG, Dialog.class);
			return dialog;
		} finally {
			reader.close();
		}
	}
}</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code class="method">serialize</code> method serializes Dialog and retruns back byte array.</p>
</li>
<li>
<p>The <code class="method">deserialize</code> is overloaded method.
Application can either pass <code class="class">byte[]</code> or <code class="class">InputStream</code>  and de-serializes the stream of data to Dialog object.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="dialog"><a class="anchor" href="#dialog"></a>9.4. Dialog</h3>
<div class="paragraph">
<p>This section provides the details for <code class="class">XmlMAPDialog</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">public class XmlMAPDialog implements Serializable {

	.....
	.....

	public XmlMAPDialog() {
		super();
	}

	/**
	 *
	 */
	public XmlMAPDialog(MAPApplicationContext appCntx, SccpAddress localAddress, SccpAddress remoteAddress,
			Long localId, Long remoteId, AddressString destReference, AddressString origReference) {
		this.appCntx = appCntx;
		this.localAddress = localAddress;
		this.remoteAddress = remoteAddress;
		this.localId = localId;
		this.remoteId = remoteId;

		this.destReference = destReference;
		this.origReference = origReference;
	}

	@Override
	public void abort(MAPUserAbortChoice mapUserAbortChoice) throws MAPException {
		this.mapUserAbortChoice = mapUserAbortChoice;
	}

	@Override
	public void addEricssonData(IMSI arg0, AddressString arg1) {
		// TODO Auto-generated method stub

	}

	@Override
	public boolean cancelInvocation(Long arg0) throws MAPException {
		throw new MAPException(new OperationNotSupportedException());
	}

	@Override
	public void close(boolean prearrangedEnd) throws MAPException {
		this.prearrangedEnd = prearrangedEnd;
	}

	@Override
	public void closeDelayed(boolean arg0) throws MAPException {
		throw new MAPException(new OperationNotSupportedException());
	}

	@Override
	public MAPApplicationContext getApplicationContext() {
		return this.appCntx;
	}

	@Override
	public SccpAddress getLocalAddress() {
		return this.localAddress;
	}

	@Override
	public Long getLocalDialogId() {
		return this.localId;
	}

	@Override
	public int getMaxUserDataLength() {
		return 0;
	}

	@Override
	public int getMessageUserDataLengthOnClose(boolean arg0) throws MAPException {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public int getMessageUserDataLengthOnSend() throws MAPException {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public AddressString getReceivedDestReference() {
		return this.destReference;
	}

	@Override
	public MAPExtensionContainer getReceivedExtensionContainer() {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public AddressString getReceivedOrigReference() {
		return this.origReference;
	}

	@Override
	public SccpAddress getRemoteAddress() {
		return this.remoteAddress;
	}

	@Override
	public Long getRemoteDialogId() {
		return this.remoteId;
	}

	@Override
	public boolean getReturnMessageOnError() {
		return this.returnMessageOnError;
	}

	@Override
	public MAPServiceBase getService() {
		return null;
	}

	@Override
	public MAPDialogState getState() {
		return this.state;
	}

	@Override
	public MessageType getTCAPMessageType() {
		return this.messageType;
	}

	@Override
	public Object getUserObject() {
		return this.userObject;
	}

	@Override
	public void keepAlive() {
		// TODO Auto-generated method stub

	}

	@Override
	public void processInvokeWithoutAnswer(Long invokeId) {
		this.processInvokeWithoutAnswerIds.add(invokeId);
	}

	@Override
	public void refuse(Reason refuseReason) throws MAPException {
		this.refuseReason = refuseReason;
	}

	@Override
	public void release() {
		// TODO Auto-generated method stub

	}

	@Override
	public void resetInvokeTimer(Long arg0) throws MAPException {
		throw new MAPException(new OperationNotSupportedException());
	}

	@Override
	public void send() throws MAPException {
		throw new MAPException(new OperationNotSupportedException());
	}

	@Override
	public void sendDelayed() throws MAPException {
		throw new MAPException(new OperationNotSupportedException());
	}

	@Override
	public void sendErrorComponent(Long invokeId, MAPErrorMessage mapErrorMessage) throws MAPException {
		this.errorComponents.put(invokeId, mapErrorMessage);
	}

	@Override
	public void sendInvokeComponent(Invoke arg0) throws MAPException {
		throw new MAPException(new OperationNotSupportedException());
	}

	@Override
	public void sendRejectComponent(Long arg0, Problem arg1) throws MAPException {
		// TODO Auto-generated method stub

	}

	@Override
	public void sendReturnResultComponent(ReturnResult arg0) throws MAPException {
		// TODO Auto-generated method stub

	}

	@Override
	public void sendReturnResultLastComponent(ReturnResultLast arg0) throws MAPException {
		throw new MAPException(new OperationNotSupportedException());

	}

	@Override
	public void setExtentionContainer(MAPExtensionContainer arg0) {
		// TODO Auto-generated method stub

	}

	@Override
	public void setLocalAddress(SccpAddress origAddress) {
		this.localAddress = origAddress;
	}

	@Override
	public void setRemoteAddress(SccpAddress destAddress) {
		this.remoteAddress = destAddress;
	}

	@Override
	public void setReturnMessageOnError(boolean returnMessageOnError) {
		this.returnMessageOnError = returnMessageOnError;

	}

	@Override
	public void setUserObject(Object obj) {
		this.userObject = obj.toString();
	}

	/**
	 * Non MAPDialog methods
	 */

	public void addMAPMessage(MAPMessage mapMessage) {
		this.mapMessages.add(mapMessage);
	}

	public boolean removeMAPMessage(MAPMessage mapMessage) {
		return this.mapMessages.remove(mapMessage);
	}

	public FastList&lt;MAPMessage&gt; getMAPMessages() {
		return this.mapMessages;
	}

	public FastList&lt;Long&gt; getProcessInvokeWithoutAnswerIds() {
		return this.processInvokeWithoutAnswerIds;
	}

	public ErrorComponentMap&lt;Long, MAPErrorMessage&gt; getErrorComponents() {
		return errorComponents;
	}

	public MAPUserAbortChoice getMAPUserAbortChoice() {
		return this.mapUserAbortChoice;
	}

	public MAPAbortProviderReason getMapAbortProviderReason() {
		return mapAbortProviderReason;
	}

	public void setMapAbortProviderReason(MAPAbortProviderReason mapAbortProviderReason) {
		this.mapAbortProviderReason = mapAbortProviderReason;
	}

	public MAPRefuseReason getMapRefuseReason() {
		return mapRefuseReason;
	}

	public void setMapRefuseReason(MAPRefuseReason mapRefuseReason) {
		this.mapRefuseReason = mapRefuseReason;
	}

	public Boolean getDialogTimedOut() {
		return dialogTimedOut;
	}

	public void setDialogTimedOut(Boolean dialogTimedOut) {
		this.dialogTimedOut = dialogTimedOut;
	}

	public Boolean getPrearrangedEnd() {
		return this.prearrangedEnd;
	}

	public void setTCAPMessageType(MessageType messageType) {
		this.messageType = messageType;
	}

	public boolean isRedirectRequest() {
		return redirectRequest;
	}

	public void setRedirectRequest(boolean redirectRequest) {
		this.redirectRequest = redirectRequest;
	}

	public void reset() {
		this.mapMessages.clear();
		this.processInvokeWithoutAnswerIds.clear();
		this.errorComponents.clear();
	}

}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_logging_traces_and_alarms"><a class="anchor" href="#_logging_traces_and_alarms"></a>10. Monitoring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="tracers"><a class="anchor" href="#tracers"></a>10.1. Tracers</h3>
<div class="paragraph">
<p>USSD GATEWAY USSD GATEWAY Application creates following tracers:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. USSD GATEWAY  Application Tracer and Log Categories</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Sbb</th>
<th class="tableblock halign-left valign-top">Tracer name</th>
<th class="tableblock halign-left valign-top">LOG4J category</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ParentSbb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USSD-Parent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.slee.SbbNotification [service=ServiceID[name=mobicents-ussdgateway,vendor=org.mobicents, version=1.0],sbb=SbbID[name=ParentSbb, vendor=org.mobicents,version=1.0]].USSD-Parent</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SipSbb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USSD-CHILD-SipSbb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.slee.SbbNotification [service=ServiceID[name=mobicents-ussdgateway,vendor=org.mobicents, version=1.0],sbb=SbbID[name=SipSbb, vendor=org.mobicents,version=1.0]].USSD-CHILD-SipSbb</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">HttpClientSbb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">USSD-CHILD-HttpClientSbb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">javax.slee.SbbNotification [service=ServiceID[name=mobicents-ussdgateway,vendor=org.mobicents, version=1.0],sbb=SbbID[name=HttpClientSbb,vendor=org.mobicents,version=1.0]].USSD-CHILD-HttpClientSbb</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Spaces where introduced in <code>LOG4J category</code>  column values, to correctly render the table.
Please remove them when using copy/paste.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="statistics"><a class="anchor" href="#statistics"></a>10.2. Statistics</h3>
<div class="sect3">
<h4 id="_view_stats"><a class="anchor" href="#_view_stats"></a>10.2.1. View USSD Statistics using the GUI</h4>
<div class="paragraph">
<p>You can view USSD statistics in the GUI Management Console by following the procedure below.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: View USSD Statistics in the GUI</div>
<ol class="arabic">
<li>
<p>In the GUI Management Console for USSD Gateway, click on 'Manage Campaigns' in the left panel.</p>
</li>
<li>
<p>If there are no statistics campaigns created yet, press the "Create Statistics Campaign" button.</p>
</li>
<li>
<p>Set the value of "Counter Definition Set Name" to "USSD GW-USSD-Main". You can set the 'Duration' value to any desired statistic interval as required.
USSD Gateway will collect statistics for selected duration and then reset all to zero and start over again.
However stats of type cumulative will not be reset to 0.
Enter any unique name for "Campaign Name" (eg.
"camp1").</p>
</li>
<li>
<p>Open the newly created campaign and click on the tag "Counter value". You will now be able to observe the current set of counter values.
Whenever you wish to see the current counter values set, you can view them here by clicking on the tag "Counter value".</p>
</li>
<li>
<p>For multiple counters, you can also view in the form of time histograms.
To view this, you must click on "Metrics" in the left panel of the GUI.</p>
</li>
<li>
<p>The main panel will display the current statistics and the details of the parameters.
This page get auto-refreshed for every "Refresh Rate" seconds and therefore the statistics are refreshed automatically.
It makes sense to select refresh rate same as duration value for which USSD Gateway is collecting stats.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Statistics info is also written by default into the log file (<em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/default/log/stats.log</em>). File format is plain text and easy to understand.
This log file can achieve a big size if your statistic duration is short.
If you do not need that statistic data will be written into stats.log file, you can remove the section from <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/default/conf/jboss-log4j.xml</em>	 | That contains the appender:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>	&lt;appender name="STATS" class="org.jboss.logging.appender.DailyRollingFileAppender"&gt;
		......
		......
		......
	&lt;/appender&gt;</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="ussd-counters"><a class="anchor" href="#ussd-counters"></a>10.2.2. USSD Counters</h4>
<div class="paragraph">
<p>The table below lists the USSD counters along with their description.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. USSD Counters</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MinDialogsInProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A minimal count of dialogs that are in progress during a statistic period.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MaxDialogsInProcess</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A maximum count of dialogs that are in progress during a statistic period.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsAllEstablished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of successfully established Dialogs for all dialog cases. A PULL Dialog is established if ProcessUnstructuredSSRequest has come to the USSD Gateway and a Short Code from the request is configured as USSD GW side and USSD request has routed to a HTTP or SIP application. A PUSH Dialog is established if the USSD Gateway has sent an UnstructuredSSRequest or UnstructuredSSNotifyRequest to the SS7 network and a non-error response from a mobile station has been received.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsAllFailed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of the Dialogs failed at establishing or established phases for all dialog cases. The most common case of failure at establishing phases is in the PUSH case when a USSD request has failed due to bad subscriber number, absent or busy subscriber. If there is an incoming ProcessUnstructuredSSRequest with a wrong short code, this Dialog is not registerd into the DialogsAllFailed counter. Instead it is registered into the UssdPullNoRoutingRule counter. A Dialog can be registered in the DialogsAllFailed counter only if it failed at establishing phase. It can be registered in both DialogsAllEstablished and DialogsAllFailed counters if it failed in the established phase.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsPullEstablished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of successfully established PULL Dialogs. It is similar to the counter DialogsAllEstablished but used only for PULL dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsPullFailed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of the PULL Dialogs failed at establishing or established phases. It is similar to the counter DialogsAllFailed but used only for PULL dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsPushEstablished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of successfully established PUSH Dialogs. It is similar to the counter DialogsAllEstablished but used only for PUSH dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsPushFailed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of the PUSH Dialogs failed at establishing or established phases. It is similar to the counter DialogsAllFailed but used only for PUSH dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsHttpEstablished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of successfully established HTTP Dialogs. It is similar to the counter DialogsAllEstablished but used only for HTTP dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsHttpFailed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of the HTTP Dialogs failed at establishing or established phases. It is similar to the counter DialogsAllFailed but used only for HTTP dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsSipEstablished</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of successfully established SIP Dialogs. It is similar to the counter DialogsAllEstablished but used only for SIP dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsSipFailed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of the SIP Dialogs failed at establishing or established phases. It is similar to the counter DialogsAllFailed but used only for SIP dialogs.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsAllEstablishedCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of DialogsAllEstablished counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsAllFailedCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of DialogsAllFailed counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsAllEstablishedPerSec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of the successfully established Dialogs per second, for all dialog cases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DialogsAllFailedPerSec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of the Dialogs failed per second at establishing or established phases, for all dialog cases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProcessUssdRequestOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of all requested ProcessUnstructuredSSRequest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ProcessUssdRequestOperationsCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of ProcessUssdRequestOperations counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UssdRequestOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of all requested UnstructuredSSRequest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UssdRequestOperationsCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of UssdRequestOperations counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UssdNotifyOperations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of all requested UnstructuredSSNotifyRequest.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UssdNotifyOperationsCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of UssdNotifyOperations counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UssdPullNoRoutingRule</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of incoming PULL requests for Short Codes that are not configured in the USSD GW and are therefore rejected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UssdPullNoRoutingRuleCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of UssdPullNoRoutingRule counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorAbsentSubscribers</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of MAP error message AbsentSubscribers received from the HLR/MSC (PUSH case).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorAbsentSubscribersCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapErrorAbsentSubscribers counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorCallBarred</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of MAP error message CallBarred received from the HLR (PUSH case).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorCallBarredCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapErrorCallBarred counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorTeleserviceNotProvisioned</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of MAP error message TeleserviceNotProvisioned received from the HLR (PUSH case).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorTeleserviceNotProvisionedCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapErrorTeleserviceNotProvisioned counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorUnknownSubscriber</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of MAP error message UnknownSubscriber received from the HLR (PUSH case).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorUnknownSubscriberCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapErrorUnknownSubscriber counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorUssdBusy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of MAP error message UssdBusy received from the MSC (PUSH case).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorUssdBusyCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapErrorUssdBusy counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorComponentOther</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of all other MAP error messages received from the HRL/MSC (PUSH case).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapErrorComponentOtherCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapErrorComponentOther counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapDialogTimeouts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of all MAP Dialog timeouts. This is the case when a mobile subscriber does not respond for a long time after the MAP Dialog is established.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapDialogTimeoutsCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapDialogTimeouts counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapInvokeTimeouts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of all MAP Invoke timeouts. This is the case when a mobile subscriber does not respond for a long time for the Invoke from USSD GW.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MapInvokeTimeoutsCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of MapInvokeTimeouts counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppTimeouts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of all HTTP / SIP Application timeouts. This is the case when a HTTP / SIP application does not respond for a long time (PULL cases only).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppTimeoutsCumulative</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This counter contains a cumulative value of AppTimeouts counter from the time the USSD GW was started.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RequestsPerUssdCode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A count of ProcessUnstructuredSSRequest requests per Short Code. This value is a complex value and there may be several values for several Short Codes inside the counter. Only the Short Codes for which there were requests during this time interval are present.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_configuring_mysql"><a class="anchor" href="#_configuring_mysql"></a>Appendix A: Configuring MySQL as datasource</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you configure the Gateway to log CDR to a Database, then every transaction of the Gateway is logged in the HSQLDB that comes bundled with JBoss AS and leverages the JBoss AS DataSource.
However this is only made available to allow the platform to run "out of the box". You must configure a production ready Database prior to using the Gateway in a production environment.</p>
</div>
<div class="paragraph">
<p>Restcomm USSD GATEWAY has been tested with PostgreSQL and MySQL.
In this section, you will find instructions for configuring MySQL database for CDR logging.</p>
</div>
<div class="olist arabic">
<div class="title">Procedure: Configuring MySQL as datasource for CDR logging</div>
<ol class="arabic">
<li>
<p>Install MySQL and create a database where CDR data will be stored.
In this example, a database named "test" is assumed to have been created.</p>
</li>
<li>
<p>Copy the MySQL connector library (<em class="path">mysql-connector-java-5.1.27-bin.jar</em>) from "Connector/J" in the MySQL library into library folder of the JBoss Server (<em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/lib</em>).</p>
</li>
<li>
<p>The example HSQLDB DataSource is bound to the JNDI name java:/DefaultDS and its descriptor is available in the file <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/hsqldb-ds.xml</em>.
You must delete this datasource by removing this descriptor file.</p>
</li>
<li>
<p>Copy the descriptor file for MySQL, <em class="path">mysql-ds.xml</em>, from <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/docs/examples/jca/</em> into  <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/</em>.</p>
</li>
<li>
<p>Update the MySQL descriptor file, <em class="path">mysql-ds.xml</em>, as required to suit your configuration.
Below is an example configuration.
You must update the tags &lt;connection-url&gt; with the host where a database can be found ('localhost' in this example) and the database name ('test' in this example). You must also update the username and password tags ('root' and '111111' in this example).</p>
<div class="listingblock">
<div class="content">
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- See http://www.jboss.org/community/wiki/Multiple1PC for information about local-tx-datasource --&gt;
&lt;!-- $Id: mysql-ds.xml 88948 2009-05-15 14:09:08Z jesper.pedersen $ --&gt;
&lt;!-- Datasource config for MySQL using 3.0.9 available from:
http://www.mysql.com/downloads/api-jdbc-stable.html
--&gt;
&lt;datasources&gt;
&lt;local-tx-datasource&gt;
&lt;jndi-name&gt;MySqlDS&lt;/jndi-name&gt; &lt;!-- DefaultDS MySqlDS--&gt;
&lt;connection-url&gt;jdbc:mysql://localhost:3306/test&lt;/connection-url&gt;
&lt;driver-class&gt;com.mysql.jdbc.Driver&lt;/driver-class&gt;
&lt;user-name&gt;root&lt;/user-name&gt;
&lt;password&gt;111111&lt;/password&gt;
&lt;exception-sorter-class-name&gt;org.jboss.resource.adapter.jdbc.vendor.MySQLExceptionSorter&lt;/exception-sorter-class-name&gt;
&lt;valid-connection-checker-class-name&gt;org.jboss.resource.adapter.jdbc.vendor.MySQLValidConnectionChecker&lt;/valid-connection-checker-class-name&gt;
&lt;!-- should only be used on drivers after 3.22.1 with "ping" support
--&gt;
&lt;!-- sql to call when connection is created
&lt;new-connection-sql&gt;some arbitrary sql&lt;/new-connection-sql&gt;
--&gt;
&lt;!-- sql to call on an existing pooled connection when it is obtained from pool - MySQLValidConnectionChecker is preferred for newer drivers
&lt;check-valid-connection-sql&gt;some arbitrary sql&lt;/check-valid-connection-sql&gt;
--&gt;
&lt;!-- corresponding type-mapping in the standardjbosscmp-jdbc.xml (optional) --&gt;
&lt;metadata&gt;
&lt;type-mapping&gt;mySQL&lt;/type-mapping&gt;
&lt;/metadata&gt;
&lt;/local-tx-datasource&gt;
&lt;/datasources&gt;</pre>
</div>
</div>
</li>
<li>
<p>Delete the HSQLDB file for messaging persistence <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/messaging/hsqldb-persistence-service.xml</em>.</p>
</li>
<li>
<p>Copy the MySQL file for messaging persistence, <em class="path">mysql-persistence-service.xml</em>, from <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/docs/examples/jms/</em> into  <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/messaging</em>.</p>
</li>
<li>
<p>Update the below files to replace all "DefaultDS" values with "MySqlDS" in all occurrences in all these files.</p>
<div class="ulist">
<ul>
<li>
<p><em class="path">messaging/mysql-persistence-service.xml</em></p>
</li>
<li>
<p><em class="path">messaging/messaging-jboss-beans.xml</em></p>
</li>
<li>
<p><em class="path">ejb2-timer-service.xml</em></p>
</li>
<li>
<p><em class="path">schedule-manager-service.xml</em></p>
</li>
<li>
<p><em class="path">uuid-key-generator.sar/META-INF/jboss-service.xml</em></p>
</li>
</ul>
</div>
</li>
<li>
<p>Open the file <em class="path">messaging/mysql-persistence-service.xml</em>, go the mbean definition &lt;mbean code="org.jboss.messaging.core.jmx.MessagingPostOfficeService"&gt; and locate the line &lt;attribute name="Clustered"&gt;false&lt;/attribute&gt;. Leave this attribute and comment out or remove all the lines after this till the end of this bean.
Save all changes.</p>
</li>
<li>
<p>Open the file <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/mobicents-slee/META-INF/jboss-beans.xml</em> and locate the following bean:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;bean name="Mobicents.JAINSLEE.Profiles.JPA.PostgreSQLConfig" class="org.mobicents.slee.container.deployment.profile.jpa.Configuration"&gt;
.....
.....
&lt;/bean&gt;</pre>
</div>
</div>
</li>
<li>
<p>Add the following bean with properties as specified below:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;bean name="Mobicents.JAINSLEE.Profiles.JPA.MySQLDBConfig" class="org.mobicents.slee.container.deployment.profile.jpa.Configuration"&gt;
&lt;property name="persistProfiles"&gt;true&lt;/property&gt;
&lt;property name="clusteredProfiles"&gt;false&lt;/property&gt;
&lt;property name="hibernateDatasource"&gt;java:/MySqlDS&lt;/property&gt;
&lt;property name="hibernateDialect"&gt;org.hibernate.dialect.MySQLDialect&lt;/property&gt;
&lt;/bean&gt;</pre>
</div>
</div>
</li>
<li>
<p>In the <em class="path">jboss-beans.xml</em>, comment out or remove the following blocks:</p>
<div class="listingblock">
<div class="content">
<pre>&lt;bean name="Mobicents.JAINSLEE.Profiles.JPA.HSQLDBConfig" class="org.mobicents.slee.container.deployment.profile.jpa.Configuration"&gt;
................
&lt;/bean&gt;
&lt;bean name="Mobicents.JAINSLEE.Profiles.JPA.PostgreSQLConfig" class="org.mobicents.slee.container.deployment.profile.jpa.Configuration"&gt;
................
&lt;/bean&gt;</pre>
</div>
</div>
</li>
<li>
<p>In the <em class="path">jboss-beans.xml</em>, go to the Profile Management section and replace HSQLDBConfig with MySQLDBConfig as shown below.</p>
<div class="listingblock">
<div class="content">
<pre>&lt;bean name="Mobicents.JAINSLEE.ProfileManagement"&gt;
....replace
&lt;inject bean="Mobicents.JAINSLEE.Profiles.JPA.HSQLDBConfig" /&gt;
....with
&lt;inject bean="Mobicents.JAINSLEE.Profiles.JPA.MySQLDBConfig" /&gt;</pre>
</div>
</div>
</li>
<li>
<p>You must note that <code>mobicents-slee-ra-jdbc-DU-6.1.1.GA-Mobicents.jar</code> also refers to DataSource name.
You must change the value of <code>DATASOURCE_JNDI_NAME</code> (which is hardcoded in the library) in the file <em class="path">mobicents-ussdgateway-/jboss-5.1.0.GA/server/&lt;profile&gt;/deploy/mobicents-slee-ra-jdbc-DU-6.1.1.GA-Mobicents.jar/jars/mobicents-slee-ra-jdbc-ra-6.1.1.GA-Mobicents.jar/META-INF/resource-adaptor-jar.xml</em> to <code>java:MySqlDS</code>.</p>
</li>
<li>
<p>Delete all tables from the MySql database you wish to use.</p>
</li>
<li>
<p>When you run the Gateway now, you will find the <code>ussd_gw_cdrs</code> tables where all CDR will be stored.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="revision-history"><a class="anchor" href="#revision-history"></a>Appendix B: Revision History</h2>
<div class="sectionbody">

</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2016-05-03 10:58:06 WEST
</div>
</div>
</body>
</html>